<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>XWOS API: 内存池分配器</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<a href="/" class="github-corner" title="返回首页">
  <svg viewBox="0 0 250 250" style="position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <path
      d="M 0 0 L 250 250 L 250 0 L 0 0 z M 181.19336 6.25 A 18.281986 19.638775 0 0 1 192.79297 10.798828 L 241.54492 54.201172 A 6.0939954 6.5462585 0 0 1 237.64453 65.787109 L 233.13477 65.787109 A 3.0469979 3.2731292 0 0 0 230.08789 69.060547 L 230.08789 111.61133 A 18.281986 19.638775 0 0 1 211.80664 131.25 L 205.71289 131.25 A 12.187991 13.092517 0 0 1 193.52344 118.1582 L 193.52344 98.519531 A 12.187991 13.092517 0 0 0 181.33594 85.425781 A 12.187991 13.092517 0 0 0 169.14844 98.519531 L 169.14844 118.1582 A 12.187991 13.092517 0 0 1 156.95898 131.25 L 150.86523 131.25 A 18.281986 19.638775 0 0 1 132.58398 111.61133 L 132.58398 68.994141 A 3.0469979 3.2731292 0 0 0 129.29297 65.722656 L 124.7832 65.722656 A 6.0939954 6.5462585 0 0 1 120.88281 54.201172 L 169.39258 10.798828 A 18.281986 19.638775 0 0 1 181.19336 6.25 z "/>
  </svg>
</a>
<style>.github-corner:hover</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XWOS API
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">XWOS API参考手册</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__xwmm__mempool.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">结构体</a> &#124;
<a href="#define-members">宏定义</a> &#124;
<a href="#func-members">函数</a>  </div>
  <div class="headertitle"><div class="title">内存池分配器<div class="ingroups"><a class="el" href="group__xwos.html">XWOS内核</a> &raquo; <a class="el" href="group__xwmm.html">XWOS内存管理</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
内存池分配器 的协作图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool.png" border="0" usemap="#agroup____xwmm____mempool" alt=""/></div>
<map name="agroup____xwmm____mempool" id="agroup____xwmm____mempool">
<area shape="rect" href="group__xwmm.html" title=" " alt="" coords="5,5,120,31"/>
<area shape="rect" title=" " alt="" coords="168,5,268,31"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
结构体</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structxwmm__mempool.html">xwmm_mempool</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">内存池  <a href="structxwmm__mempool.html#details">更多...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structxwmm__mempool__i__allocator.html">xwmm_mempool_i_allocator</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">interface：分配器  <a href="structxwmm__mempool__i__allocator.html#details">更多...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">对象缓存  <a href="structxwmm__mempool__objcache.html#details">更多...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structxwmm__mempool__page.html">xwmm_mempool_page</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">内存页  <a href="structxwmm__mempool__page.html#details">更多...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structxwmm__mempool__page__odrbtree.html">xwmm_mempool_page_odrbtree</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">阶红黑树  <a href="structxwmm__mempool__page__odrbtree.html#details">更多...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">页分配器  <a href="structxwmm__mempool__page__allocator.html#details">更多...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
宏定义</h2></td></tr>
<tr class="memitem:gad29bb2a3d87539c205b4d0d51f37ce84"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gad29bb2a3d87539c205b4d0d51f37ce84">XWMM_MEMPOOL_PAGE_SIZE</a>&#160;&#160;&#160;(4096U)</td></tr>
<tr class="separator:gad29bb2a3d87539c205b4d0d51f37ce84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabeceac7e5b816ad958870372ffb95b7f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gabeceac7e5b816ad958870372ffb95b7f">XWMM_MEMPOOL_OC_8_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:gabeceac7e5b816ad958870372ffb95b7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga655e461fb32ab02e97bdfe97e74e1ff4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga655e461fb32ab02e97bdfe97e74e1ff4">XWMM_MEMPOOL_OC_16_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:ga655e461fb32ab02e97bdfe97e74e1ff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae3ab9842daa4494115b91a1c9a211eaf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gae3ab9842daa4494115b91a1c9a211eaf">XWMM_MEMPOOL_OC_32_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:gae3ab9842daa4494115b91a1c9a211eaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8f409a6ce2c2b794e5e0195c149727e6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga8f409a6ce2c2b794e5e0195c149727e6">XWMM_MEMPOOL_OC_64_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:ga8f409a6ce2c2b794e5e0195c149727e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacd0d06d72077a3cb482d7313336a641b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gacd0d06d72077a3cb482d7313336a641b">XWMM_MEMPOOL_OC_96_PAGE_ODR</a>&#160;&#160;&#160;(1U)</td></tr>
<tr class="separator:gacd0d06d72077a3cb482d7313336a641b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga43527e6076712848f493cd7573e2ef77"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga43527e6076712848f493cd7573e2ef77">XWMM_MEMPOOL_OC_128_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:ga43527e6076712848f493cd7573e2ef77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4ca59ba13d69974d8264f4d111cffb16"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga4ca59ba13d69974d8264f4d111cffb16">XWMM_MEMPOOL_OC_160_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:ga4ca59ba13d69974d8264f4d111cffb16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab137f0879efaafd7f437f15de0550257"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gab137f0879efaafd7f437f15de0550257">XWMM_MEMPOOL_OC_192_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:gab137f0879efaafd7f437f15de0550257"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga532c27113052f38ee9b44bc780a0b7dc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga532c27113052f38ee9b44bc780a0b7dc">XWMM_MEMPOOL_OC_256_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:ga532c27113052f38ee9b44bc780a0b7dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga52c4d8202e8bd3153be20b5b4ed70a8d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga52c4d8202e8bd3153be20b5b4ed70a8d">XWMM_MEMPOOL_OC_320_PAGE_ODR</a>&#160;&#160;&#160;(1U)</td></tr>
<tr class="separator:ga52c4d8202e8bd3153be20b5b4ed70a8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga21e23da6eb1fe95f0419fbd48682f844"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga21e23da6eb1fe95f0419fbd48682f844">XWMM_MEMPOOL_OC_384_PAGE_ODR</a>&#160;&#160;&#160;(1U)</td></tr>
<tr class="separator:ga21e23da6eb1fe95f0419fbd48682f844"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeb9a6c032b909d27aee816cf58f79cf8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gaeb9a6c032b909d27aee816cf58f79cf8">XWMM_MEMPOOL_OC_512_PAGE_ODR</a>&#160;&#160;&#160;(1U)</td></tr>
<tr class="separator:gaeb9a6c032b909d27aee816cf58f79cf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac56cb33d2518180259d23367aaf485d0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gac56cb33d2518180259d23367aaf485d0">XWMM_MEMPOOL_OC_768_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:gac56cb33d2518180259d23367aaf485d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafb879eea2642fa6e80f183f5733271af"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gafb879eea2642fa6e80f183f5733271af">XWMM_MEMPOOL_OC_1024_PAGE_ODR</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:gafb879eea2642fa6e80f183f5733271af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadfca8f662972df88f92813d3ef9ca007"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gadfca8f662972df88f92813d3ef9ca007">XWMM_MEMPOOL_OC_2048_PAGE_ODR</a>&#160;&#160;&#160;(1U)</td></tr>
<tr class="separator:gadfca8f662972df88f92813d3ef9ca007"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafa28e10b27692edab7bea16e7cca94e1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gafa28e10b27692edab7bea16e7cca94e1">XWMM_MEMPOOL_TYPEDEF</a>(name,  pgodr)</td></tr>
<tr class="memdesc:gafa28e10b27692edab7bea16e7cca94e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">定义内存池结构体类型  <br /></td></tr>
<tr class="separator:gafa28e10b27692edab7bea16e7cca94e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3d3a4a522171a36b8d3b54b527765a75"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga3d3a4a522171a36b8d3b54b527765a75">XWMM_MEMPOOL_DEF</a>(name,  pgodr)&#160;&#160;&#160;        <a class="el" href="group__xwos__lib__type.html#ga4433c8b2d64a72382ab333d11bfd0093">xwu8_t</a> name[sizeof(<a class="el" href="group__xwmm__mempool.html#gafa28e10b27692edab7bea16e7cca94e1">XWMM_MEMPOOL_TYPEDEF</a>(name, pgodr))]</td></tr>
<tr class="memdesc:ga3d3a4a522171a36b8d3b54b527765a75"><td class="mdescLeft">&#160;</td><td class="mdescRight">定义内存池结构体的RAW内存空间，用于初始化内存池结构体  <br /></td></tr>
<tr class="separator:ga3d3a4a522171a36b8d3b54b527765a75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7744dc03cbec4ec5c2bf0d5122fbe7c2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga7744dc03cbec4ec5c2bf0d5122fbe7c2">XWMM_MEMPOOL_PAGE_ORDER_CMB</a>&#160;&#160;&#160;(<a class="el" href="group__xwos__lib__type.html#ga1f049855a75c1dbd5b1bfc13b60ccf42">XWSQ_MAX</a>)</td></tr>
<tr class="separator:ga7744dc03cbec4ec5c2bf0d5122fbe7c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga79a401ab2b3ed89693416cd9b770a4fe"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga79a401ab2b3ed89693416cd9b770a4fe">XWMM_MEMPOOL_PAGE_MAPPING_FREE</a>&#160;&#160;&#160;(0U)</td></tr>
<tr class="separator:ga79a401ab2b3ed89693416cd9b770a4fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabbdd8414a28105ff954a1b6d9203147b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gabbdd8414a28105ff954a1b6d9203147b">XWMM_MEMPOOL_PAGE_MAPPING_INVAILD</a>&#160;&#160;&#160;(<a class="el" href="group__xwos__lib__type.html#gab78b165375bb877144d14159deae190d">XWPTR_MAX</a>)</td></tr>
<tr class="separator:gabbdd8414a28105ff954a1b6d9203147b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
函数</h2></td></tr>
<tr class="memitem:gaad8340a12043c383e489a786788e89af"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gaad8340a12043c383e489a786788e89af">xwmm_mempool_init</a> (struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *mp, const char *name, <a class="el" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a> origin, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> size, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> pgodr, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> pre, void **membuf)</td></tr>
<tr class="memdesc:gaad8340a12043c383e489a786788e89af"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：初始化内存池  <br /></td></tr>
<tr class="separator:gaad8340a12043c383e489a786788e89af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8b258eb1da7cce5a8bb34c600dd72c11"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga8b258eb1da7cce5a8bb34c600dd72c11">xwmm_mempool_malloc</a> (struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *mp, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> size, void **membuf)</td></tr>
<tr class="memdesc:ga8b258eb1da7cce5a8bb34c600dd72c11"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：从内存池中申请内存  <br /></td></tr>
<tr class="separator:ga8b258eb1da7cce5a8bb34c600dd72c11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae8d0ab6282f0c050e0e6e37726d67e88"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gae8d0ab6282f0c050e0e6e37726d67e88">xwmm_mempool_free</a> (struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *mp, void *mem)</td></tr>
<tr class="memdesc:gae8d0ab6282f0c050e0e6e37726d67e88"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：释放内存  <br /></td></tr>
<tr class="separator:gae8d0ab6282f0c050e0e6e37726d67e88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafbd8b2e5fb3f821b9e39cd234c41173b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gafbd8b2e5fb3f821b9e39cd234c41173b">xwmm_mempool_realloc</a> (struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *mp, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> size, void **membuf)</td></tr>
<tr class="memdesc:gafbd8b2e5fb3f821b9e39cd234c41173b"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：调整内存大小  <br /></td></tr>
<tr class="separator:gafbd8b2e5fb3f821b9e39cd234c41173b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga943844e993429eb0fdf7ccc1df080296"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga943844e993429eb0fdf7ccc1df080296">xwmm_mempool_memalign</a> (struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *mp, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> alignment, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> size, void **membuf)</td></tr>
<tr class="memdesc:ga943844e993429eb0fdf7ccc1df080296"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：从内存池中申请对齐的内存  <br /></td></tr>
<tr class="separator:ga943844e993429eb0fdf7ccc1df080296"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga15d8fc6d72d2ef920927bd6702174c3a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga15d8fc6d72d2ef920927bd6702174c3a">xwmm_mempool_objcache_init</a> (struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *oc, struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *pa, const char *name, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> objsize, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> alignment, <a class="el" href="group__xwos__lib__type.html#ga59fe68c80516b22de8dccb84275d23f2">xwsq_t</a> pg_order, <a class="el" href="group__xwos__lib__type.html#gaf7d6db44108764f9cbaea53c923d2736">ctor_f</a> ctor, <a class="el" href="group__xwos__lib__type.html#gafe80dfa42b558589ad7ebce2bea43946">dtor_f</a> dtor)</td></tr>
<tr class="memdesc:ga15d8fc6d72d2ef920927bd6702174c3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：初始化对象缓存  <br /></td></tr>
<tr class="separator:ga15d8fc6d72d2ef920927bd6702174c3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga86e445faf7ecf95130e042fa9b96a41b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga86e445faf7ecf95130e042fa9b96a41b">xwmm_mempool_objcache_alloc</a> (struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *oc, void **objbuf)</td></tr>
<tr class="memdesc:ga86e445faf7ecf95130e042fa9b96a41b"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：从对象缓存中申请一个对象  <br /></td></tr>
<tr class="separator:ga86e445faf7ecf95130e042fa9b96a41b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae7d39e7ba00cc3926284e6ba8775121b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gae7d39e7ba00cc3926284e6ba8775121b">xwmm_mempool_objcache_free</a> (struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *oc, void *obj)</td></tr>
<tr class="memdesc:gae7d39e7ba00cc3926284e6ba8775121b"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：释放对象到对象缓存中  <br /></td></tr>
<tr class="separator:gae7d39e7ba00cc3926284e6ba8775121b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa72ed546dbddbbb8dd035c01c6334a24"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gaa72ed546dbddbbb8dd035c01c6334a24">xwmm_mempool_objcache_reserve</a> (struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *oc, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> reserved)</td></tr>
<tr class="memdesc:gaa72ed546dbddbbb8dd035c01c6334a24"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：预留对象到对象缓存中  <br /></td></tr>
<tr class="separator:gaa72ed546dbddbbb8dd035c01c6334a24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab664530444050735173f9bc44c32ab14"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gab664530444050735173f9bc44c32ab14">xwmm_mempool_objcache_get_capacity</a> (struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *oc, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> *capacity)</td></tr>
<tr class="memdesc:gab664530444050735173f9bc44c32ab14"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：获取对象缓存的容量  <br /></td></tr>
<tr class="separator:gab664530444050735173f9bc44c32ab14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac5da9c9562774fdac8cda7f769d60967"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967">xwmm_mempool_page_find</a> (struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *pa, void *mem, struct <a class="el" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> **pgbuf)</td></tr>
<tr class="memdesc:gac5da9c9562774fdac8cda7f769d60967"><td class="mdescLeft">&#160;</td><td class="mdescRight">依据内存地址查找页  <br /></td></tr>
<tr class="separator:gac5da9c9562774fdac8cda7f769d60967"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeac7d28f7509e0c764b9f995ebd45f12"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#gaeac7d28f7509e0c764b9f995ebd45f12">xwmm_mempool_page_allocator_init</a> (struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *pa, const char *name, <a class="el" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a> origin, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> size, <a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> pgsize, struct <a class="el" href="structxwmm__mempool__page__odrbtree.html">xwmm_mempool_page_odrbtree</a> *odrbtree, struct <a class="el" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> *pgarray)</td></tr>
<tr class="memdesc:gaeac7d28f7509e0c764b9f995ebd45f12"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：初始化页分配器  <br /></td></tr>
<tr class="separator:gaeac7d28f7509e0c764b9f995ebd45f12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7cbe7d0a7d7052c887dc7723c5010ec1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga7cbe7d0a7d7052c887dc7723c5010ec1">xwmm_mempool_page_allocate</a> (struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *pa, <a class="el" href="group__xwos__lib__type.html#ga59fe68c80516b22de8dccb84275d23f2">xwsq_t</a> order, struct <a class="el" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> **pgbuf)</td></tr>
<tr class="memdesc:ga7cbe7d0a7d7052c887dc7723c5010ec1"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：申请一页内存  <br /></td></tr>
<tr class="separator:ga7cbe7d0a7d7052c887dc7723c5010ec1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga52f11e08dc37a0cc72717169b6ae4131"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwmm__mempool.html#ga52f11e08dc37a0cc72717169b6ae4131">xwmm_mempool_page_free</a> (struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *pa, struct <a class="el" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> *pg)</td></tr>
<tr class="memdesc:ga52f11e08dc37a0cc72717169b6ae4131"><td class="mdescLeft">&#160;</td><td class="mdescRight">XWMM API：释放一页内存  <br /></td></tr>
<tr class="separator:ga52f11e08dc37a0cc72717169b6ae4131"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">详细描述</h2>
<p>内存池是结合了内存切片分配器与伙伴算法分配器的算法。内存管理的基本单位为页， 一页内存为4096字节，页内存使用伙伴算法分配器管理。 内存池还使用对象缓存算法建立各种小尺寸的块：8字节、16字节、32字节、 64字节、96字节、128字节、160字节、192字节、256字节、320字节、384字节、 512字节、768字节、1024字节、2048字节。 当申请内存大于2048字节，直接分配页内存；当申请的内存小于等于2048字节， 就从尺寸最合适的对象缓存分配器中分配一块内存。</p>
<ul>
<li>优点：<ul>
<li>支持释放操作；</li>
<li>支持大小不固定的内存申请操作；</li>
<li>反复申请与释放不会造成内存碎片；</li>
<li>小内存块不会浪费过多的内存。</li>
</ul>
</li>
<li>缺点：<ul>
<li>代码复杂；</li>
<li>申请与释放操作的所需要的时间不稳定。</li>
</ul>
</li>
<li>适用性：外接尺寸较大的SRAM或SDRAM的内存管理，C++和Lua虚拟机的对象池。</li>
<li>上下文的安全性：在任何上下文（中断、中断底半部、线程）都是安全的。 </li>
</ul>
<h2 class="groupheader">宏定义说明</h2>
<a id="ga3d3a4a522171a36b8d3b54b527765a75" name="ga3d3a4a522171a36b8d3b54b527765a75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3d3a4a522171a36b8d3b54b527765a75">&#9670;&#160;</a></span>XWMM_MEMPOOL_DEF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_DEF</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">pgodr&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;        <a class="el" href="group__xwos__lib__type.html#ga4433c8b2d64a72382ab333d11bfd0093">xwu8_t</a> name[sizeof(<a class="el" href="group__xwmm__mempool.html#gafa28e10b27692edab7bea16e7cca94e1">XWMM_MEMPOOL_TYPEDEF</a>(name, pgodr))]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>定义内存池结构体的RAW内存空间，用于初始化内存池结构体 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>内存数组名 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgodr</td><td>页的数量，以2的pgodr次方形式表示 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00091">91</a> 行定义.</p>

</div>
</div>
<a id="gafb879eea2642fa6e80f183f5733271af" name="gafb879eea2642fa6e80f183f5733271af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafb879eea2642fa6e80f183f5733271af">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_1024_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_1024_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>1024字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00065">65</a> 行定义.</p>

</div>
</div>
<a id="ga43527e6076712848f493cd7573e2ef77" name="ga43527e6076712848f493cd7573e2ef77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga43527e6076712848f493cd7573e2ef77">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_128_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_128_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>128字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00057">57</a> 行定义.</p>

</div>
</div>
<a id="ga4ca59ba13d69974d8264f4d111cffb16" name="ga4ca59ba13d69974d8264f4d111cffb16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4ca59ba13d69974d8264f4d111cffb16">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_160_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_160_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>160字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00058">58</a> 行定义.</p>

</div>
</div>
<a id="ga655e461fb32ab02e97bdfe97e74e1ff4" name="ga655e461fb32ab02e97bdfe97e74e1ff4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga655e461fb32ab02e97bdfe97e74e1ff4">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_16_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_16_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>16字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00053">53</a> 行定义.</p>

</div>
</div>
<a id="gab137f0879efaafd7f437f15de0550257" name="gab137f0879efaafd7f437f15de0550257"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab137f0879efaafd7f437f15de0550257">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_192_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_192_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>192字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00059">59</a> 行定义.</p>

</div>
</div>
<a id="gadfca8f662972df88f92813d3ef9ca007" name="gadfca8f662972df88f92813d3ef9ca007"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadfca8f662972df88f92813d3ef9ca007">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_2048_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_2048_PAGE_ODR&#160;&#160;&#160;(1U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>2048字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00066">66</a> 行定义.</p>

</div>
</div>
<a id="ga532c27113052f38ee9b44bc780a0b7dc" name="ga532c27113052f38ee9b44bc780a0b7dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga532c27113052f38ee9b44bc780a0b7dc">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_256_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_256_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>256字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00060">60</a> 行定义.</p>

</div>
</div>
<a id="ga52c4d8202e8bd3153be20b5b4ed70a8d" name="ga52c4d8202e8bd3153be20b5b4ed70a8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga52c4d8202e8bd3153be20b5b4ed70a8d">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_320_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_320_PAGE_ODR&#160;&#160;&#160;(1U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>320字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00061">61</a> 行定义.</p>

</div>
</div>
<a id="gae3ab9842daa4494115b91a1c9a211eaf" name="gae3ab9842daa4494115b91a1c9a211eaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae3ab9842daa4494115b91a1c9a211eaf">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_32_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_32_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>32字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00054">54</a> 行定义.</p>

</div>
</div>
<a id="ga21e23da6eb1fe95f0419fbd48682f844" name="ga21e23da6eb1fe95f0419fbd48682f844"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga21e23da6eb1fe95f0419fbd48682f844">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_384_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_384_PAGE_ODR&#160;&#160;&#160;(1U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>384字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00062">62</a> 行定义.</p>

</div>
</div>
<a id="gaeb9a6c032b909d27aee816cf58f79cf8" name="gaeb9a6c032b909d27aee816cf58f79cf8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaeb9a6c032b909d27aee816cf58f79cf8">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_512_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_512_PAGE_ODR&#160;&#160;&#160;(1U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>512字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00063">63</a> 行定义.</p>

</div>
</div>
<a id="ga8f409a6ce2c2b794e5e0195c149727e6" name="ga8f409a6ce2c2b794e5e0195c149727e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8f409a6ce2c2b794e5e0195c149727e6">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_64_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_64_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>64字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00055">55</a> 行定义.</p>

</div>
</div>
<a id="gac56cb33d2518180259d23367aaf485d0" name="gac56cb33d2518180259d23367aaf485d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac56cb33d2518180259d23367aaf485d0">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_768_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_768_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>768字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00064">64</a> 行定义.</p>

</div>
</div>
<a id="gabeceac7e5b816ad958870372ffb95b7f" name="gabeceac7e5b816ad958870372ffb95b7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabeceac7e5b816ad958870372ffb95b7f">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_8_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_8_PAGE_ODR&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>8字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00052">52</a> 行定义.</p>

</div>
</div>
<a id="gacd0d06d72077a3cb482d7313336a641b" name="gacd0d06d72077a3cb482d7313336a641b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacd0d06d72077a3cb482d7313336a641b">&#9670;&#160;</a></span>XWMM_MEMPOOL_OC_96_PAGE_ODR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_OC_96_PAGE_ODR&#160;&#160;&#160;(1U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>96字节分配器所使用的页的阶数 </p>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00056">56</a> 行定义.</p>

</div>
</div>
<a id="ga79a401ab2b3ed89693416cd9b770a4fe" name="ga79a401ab2b3ed89693416cd9b770a4fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga79a401ab2b3ed89693416cd9b770a4fe">&#9670;&#160;</a></span>XWMM_MEMPOOL_PAGE_MAPPING_FREE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_PAGE_MAPPING_FREE&#160;&#160;&#160;(0U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">在文件 <a class="el" href="page_8h_source.html">page.h</a> 第 <a class="el" href="page_8h_source.html#l00031">31</a> 行定义.</p>

</div>
</div>
<a id="gabbdd8414a28105ff954a1b6d9203147b" name="gabbdd8414a28105ff954a1b6d9203147b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabbdd8414a28105ff954a1b6d9203147b">&#9670;&#160;</a></span>XWMM_MEMPOOL_PAGE_MAPPING_INVAILD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_PAGE_MAPPING_INVAILD&#160;&#160;&#160;(<a class="el" href="group__xwos__lib__type.html#gab78b165375bb877144d14159deae190d">XWPTR_MAX</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">在文件 <a class="el" href="page_8h_source.html">page.h</a> 第 <a class="el" href="page_8h_source.html#l00032">32</a> 行定义.</p>

</div>
</div>
<a id="ga7744dc03cbec4ec5c2bf0d5122fbe7c2" name="ga7744dc03cbec4ec5c2bf0d5122fbe7c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7744dc03cbec4ec5c2bf0d5122fbe7c2">&#9670;&#160;</a></span>XWMM_MEMPOOL_PAGE_ORDER_CMB</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_PAGE_ORDER_CMB&#160;&#160;&#160;(<a class="el" href="group__xwos__lib__type.html#ga1f049855a75c1dbd5b1bfc13b60ccf42">XWSQ_MAX</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">在文件 <a class="el" href="page_8h_source.html">page.h</a> 第 <a class="el" href="page_8h_source.html#l00030">30</a> 行定义.</p>

</div>
</div>
<a id="gad29bb2a3d87539c205b4d0d51f37ce84" name="gad29bb2a3d87539c205b4d0d51f37ce84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad29bb2a3d87539c205b4d0d51f37ce84">&#9670;&#160;</a></span>XWMM_MEMPOOL_PAGE_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_PAGE_SIZE&#160;&#160;&#160;(4096U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section note"><dt>注解</dt><dd><ul>
<li>页的最小单位是 <a class="el" href="group__xwmm__mempool.html#gad29bb2a3d87539c205b4d0d51f37ce84">XWMM_MEMPOOL_PAGE_SIZE</a></li>
<li>页的阶数n是指，以2的n次方的形式表示的单位页的数量。n阶页的大小是(4K * pow(2, n))。 每页内存的字节数 </li>
</ul>
</dd></dl>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00051">51</a> 行定义.</p>

</div>
</div>
<a id="gafa28e10b27692edab7bea16e7cca94e1" name="gafa28e10b27692edab7bea16e7cca94e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafa28e10b27692edab7bea16e7cca94e1">&#9670;&#160;</a></span>XWMM_MEMPOOL_TYPEDEF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XWMM_MEMPOOL_TYPEDEF</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">pgodr&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>值:</b><div class="fragment"><div class="line">        <span class="keyword">struct </span>name { \</div>
<div class="line">                <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool.html">xwmm_mempool</a> mempool[1U]; \</div>
<div class="line">                <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page__odrbtree.html">xwmm_mempool_page_odrbtree</a> odrbtrees[(pgodr) + 1U]; \</div>
<div class="line">                <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> pages[1U &lt;&lt; (pgodr)]; \</div>
<div class="line">        }</div>
<div class="ttc" id="astructxwmm__mempool__page__odrbtree_html"><div class="ttname"><a href="structxwmm__mempool__page__odrbtree.html">xwmm_mempool_page_odrbtree</a></div><div class="ttdoc">阶红黑树</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00072">page.h:72</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html"><div class="ttname"><a href="structxwmm__mempool__page.html">xwmm_mempool_page</a></div><div class="ttdoc">内存页</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00037">page.h:37</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html"><div class="ttname"><a href="structxwmm__mempool.html">xwmm_mempool</a></div><div class="ttdoc">内存池</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00097">allocator.h:97</a></div></div>
</div><!-- fragment -->
<p>定义内存池结构体类型 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>结构体名 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgodr</td><td>页的数量，以2的pgodr次方形式表示 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">在文件 <a class="el" href="allocator_8h_source.html">allocator.h</a> 第 <a class="el" href="allocator_8h_source.html#l00078">78</a> 行定义.</p>

</div>
</div>
<h2 class="groupheader">函数说明</h2>
<a id="gae8d0ab6282f0c050e0e6e37726d67e88" name="gae8d0ab6282f0c050e0e6e37726d67e88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae8d0ab6282f0c050e0e6e37726d67e88">&#9670;&#160;</a></span>xwmm_mempool_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>mem</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：释放内存 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>内存池的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mem</td><td>内存的首地址 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-EFAULT</td><td>空指针 </td></tr>
    <tr><td class="paramname">-EALREADY</td><td>页内存已释放 </td></tr>
    <tr><td class="paramname">-ERANGE</td><td>内存地址不在内存池的范围内 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>同步/异步：同步</li>
<li>上下文：中断、中断底半部、线程</li>
<li>重入性：可重入</li>
</ul>
</dd></dl>
<p>此函数向内存池释放内存。内存必须是此前申请的，如果 <code>mem</code> 是错误的地址或之前被释放过， 将产生未定义的错误。 <code>mem</code> 可以为 <code>NULL</code> ，此函数什么也不做，并且返回错误码 <code>XWOK</code> 。 </p>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="allocator_8c_source.html">allocator.c</a> 第 <a class="el" href="allocator_8c_source.html#l00342">342</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  343</span>{</div>
<div class="line"><span class="lineno">  344</span>        <span class="keyword">interface </span><a class="code hl_struct" href="structxwmm__mempool__i__allocator.html">xwmm_mempool_i_allocator</a> * ia;</div>
<div class="line"><span class="lineno">  345</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> * pg;</div>
<div class="line"><span class="lineno">  346</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>        <a class="code hl_define" href="group__xwos__standard.html#ga0c63a67f52b315298e2be98f79cd0c08">XWOS_VALIDATE</a>((mp), <span class="stringliteral">&quot;nullptr&quot;</span>, -<a class="code hl_define" href="group__xwos__lib__errno.html#ga3f317946e043623f9d6b93dbf60e6316">EFAULT</a>);</div>
<div class="line"><span class="lineno">  349</span> </div>
<div class="line"><span class="lineno">  350</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> == mem) {</div>
<div class="line"><span class="lineno">  351</span>                rc = <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  352</span>                <span class="keywordflow">goto</span> do_nothing;</div>
<div class="line"><span class="lineno">  353</span>        }</div>
<div class="line"><span class="lineno">  354</span> </div>
<div class="line"><span class="lineno">  355</span>        rc = <a class="code hl_function" href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967">xwmm_mempool_page_find</a>(&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a128e5c1b3f2a3d075de1708b9257bfa1">pa</a>, mem, &amp;pg);</div>
<div class="line"><span class="lineno">  356</span>        <span class="keywordflow">if</span> (rc &lt; 0) {</div>
<div class="line"><span class="lineno">  357</span>                <span class="keywordflow">goto</span> err_pg_find;</div>
<div class="line"><span class="lineno">  358</span>        }</div>
<div class="line"><span class="lineno">  359</span> </div>
<div class="line"><span class="lineno">  360</span>        <span class="keywordflow">switch</span> (pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a92a86e9c7241aa8d80d586a6168062c4">data</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a4e0eea86b489b7969ef1d4a309f17056">value</a>) {</div>
<div class="line"><span class="lineno">  361</span>        <span class="keywordflow">case</span> 8:</div>
<div class="line"><span class="lineno">  362</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a95faf8f0948c43576b3dd0c555d12661">oc_8</a>;</div>
<div class="line"><span class="lineno">  363</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  364</span>        <span class="keywordflow">case</span> 16:</div>
<div class="line"><span class="lineno">  365</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#af94673c956897aa54efda5550fb9dfab">oc_16</a>;</div>
<div class="line"><span class="lineno">  366</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  367</span>        <span class="keywordflow">case</span> 32:</div>
<div class="line"><span class="lineno">  368</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a3e7421868bd9e1bf0b438947f5911178">oc_32</a>;</div>
<div class="line"><span class="lineno">  369</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  370</span>        <span class="keywordflow">case</span> 64:</div>
<div class="line"><span class="lineno">  371</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#aeeba70716570172e17dbbfa6708f1254">oc_64</a>;</div>
<div class="line"><span class="lineno">  372</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  373</span>        <span class="keywordflow">case</span> 96:</div>
<div class="line"><span class="lineno">  374</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a9cb37a0576bc1e6c50a17751f7d4eb9c">oc_96</a>;</div>
<div class="line"><span class="lineno">  375</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  376</span>        <span class="keywordflow">case</span> 128:</div>
<div class="line"><span class="lineno">  377</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ad922ced416de3ef8539dd7f2cc818202">oc_128</a>;</div>
<div class="line"><span class="lineno">  378</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  379</span>        <span class="keywordflow">case</span> 160:</div>
<div class="line"><span class="lineno">  380</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a8a0afacaee1b1223be08ccf6ce359b37">oc_160</a>;</div>
<div class="line"><span class="lineno">  381</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  382</span>        <span class="keywordflow">case</span> 192:</div>
<div class="line"><span class="lineno">  383</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a97c3ef398fb9f0ab8b46122af4a6bfbf">oc_192</a>;</div>
<div class="line"><span class="lineno">  384</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  385</span>        <span class="keywordflow">case</span> 256:</div>
<div class="line"><span class="lineno">  386</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ab9056367df7cbe72dd07e3cd68f609b2">oc_256</a>;</div>
<div class="line"><span class="lineno">  387</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  388</span>        <span class="keywordflow">case</span> 320:</div>
<div class="line"><span class="lineno">  389</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ae4db2c62465ba85764c5dd3f54585ee9">oc_320</a>;</div>
<div class="line"><span class="lineno">  390</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  391</span>        <span class="keywordflow">case</span> 384:</div>
<div class="line"><span class="lineno">  392</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ae4ade1db7681bd8c4086b9cf81974ed5">oc_384</a>;</div>
<div class="line"><span class="lineno">  393</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  394</span>        <span class="keywordflow">case</span> 512:</div>
<div class="line"><span class="lineno">  395</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a23363ae543f95164b3ef25bf77ad5263">oc_512</a>;</div>
<div class="line"><span class="lineno">  396</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  397</span>        <span class="keywordflow">case</span> 768:</div>
<div class="line"><span class="lineno">  398</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a50ca4020909dd2afbd5de522b5927dfb">oc_768</a>;</div>
<div class="line"><span class="lineno">  399</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  400</span>        <span class="keywordflow">case</span> 1024:</div>
<div class="line"><span class="lineno">  401</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a45dc2f129fa90ee4b52dd54ebba3ab2f">oc_1024</a>;</div>
<div class="line"><span class="lineno">  402</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  403</span>        <span class="keywordflow">case</span> 2048:</div>
<div class="line"><span class="lineno">  404</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#aacbadeb03056e73c0513fa3b373d1225">oc_2048</a>;</div>
<div class="line"><span class="lineno">  405</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  406</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  407</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a128e5c1b3f2a3d075de1708b9257bfa1">pa</a>;</div>
<div class="line"><span class="lineno">  408</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  409</span>        }</div>
<div class="line"><span class="lineno">  410</span>        rc = ia-&gt;free(ia, mem);</div>
<div class="line"><span class="lineno">  411</span> </div>
<div class="line"><span class="lineno">  412</span>err_pg_find:</div>
<div class="line"><span class="lineno">  413</span>do_nothing:</div>
<div class="line"><span class="lineno">  414</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  415</span>}</div>
<div class="ttc" id="agroup__xwmm__mempool_html_gac5da9c9562774fdac8cda7f769d60967"><div class="ttname"><a href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967">xwmm_mempool_page_find</a></div><div class="ttdeci">xwer_t xwmm_mempool_page_find(struct xwmm_mempool_page_allocator *pa, void *mem, struct xwmm_mempool_page **pgbuf)</div><div class="ttdoc">依据内存地址查找页</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00519">page.c:519</a></div></div>
<div class="ttc" id="agroup__xwos__lib__errno_html_ga3f317946e043623f9d6b93dbf60e6316"><div class="ttname"><a href="group__xwos__lib__errno.html#ga3f317946e043623f9d6b93dbf60e6316">EFAULT</a></div><div class="ttdeci">#define EFAULT</div><div class="ttdoc">Bad address</div><div class="ttdef"><b>Definition</b> <a href="errno_8h_source.html#l00044">errno.h:44</a></div></div>
<div class="ttc" id="agroup__xwos__lib__errno_html_ga6a72d49d869215a02342eb465166537b"><div class="ttname"><a href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a></div><div class="ttdeci">#define XWOK</div><div class="ttdoc">No error</div><div class="ttdef"><b>Definition</b> <a href="errno_8h_source.html#l00182">errno.h:182</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_ga06847ea8c7edb2b1f166288b230f251f"><div class="ttname"><a href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a></div><div class="ttdeci">signed long xwer_t</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00554">type.h:554</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_ga070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00028">type.h:28</a></div></div>
<div class="ttc" id="agroup__xwos__standard_html_ga0c63a67f52b315298e2be98f79cd0c08"><div class="ttname"><a href="group__xwos__standard.html#ga0c63a67f52b315298e2be98f79cd0c08">XWOS_VALIDATE</a></div><div class="ttdeci">#define XWOS_VALIDATE(exp, errstr,...)</div><div class="ttdoc">检查函数参数是否有效</div><div class="ttdef"><b>Definition</b> <a href="xwos_2standard_8h_source.html#l00076">standard.h:76</a></div></div>
<div class="ttc" id="astructxwmm__mempool__i__allocator_html"><div class="ttname"><a href="structxwmm__mempool__i__allocator.html">xwmm_mempool_i_allocator</a></div><div class="ttdoc">interface：分配器</div><div class="ttdef"><b>Definition</b> <a href="i__allocator_8h_source.html#l00027">i_allocator.h:27</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_a4e0eea86b489b7969ef1d4a309f17056"><div class="ttname"><a href="structxwmm__mempool__page.html#a4e0eea86b489b7969ef1d4a309f17056">xwmm_mempool_page::value</a></div><div class="ttdeci">xwsq_t value</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00061">page.h:61</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_a92a86e9c7241aa8d80d586a6168062c4"><div class="ttname"><a href="structxwmm__mempool__page.html#a92a86e9c7241aa8d80d586a6168062c4">xwmm_mempool_page::data</a></div><div class="ttdeci">union xwmm_mempool_page::@2 data</div></div>
<div class="ttc" id="astructxwmm__mempool_html_a128e5c1b3f2a3d075de1708b9257bfa1"><div class="ttname"><a href="structxwmm__mempool.html#a128e5c1b3f2a3d075de1708b9257bfa1">xwmm_mempool::pa</a></div><div class="ttdeci">struct xwmm_mempool_page_allocator pa</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00099">allocator.h:99</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_a23363ae543f95164b3ef25bf77ad5263"><div class="ttname"><a href="structxwmm__mempool.html#a23363ae543f95164b3ef25bf77ad5263">xwmm_mempool::oc_512</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_512</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00111">allocator.h:111</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_a3e7421868bd9e1bf0b438947f5911178"><div class="ttname"><a href="structxwmm__mempool.html#a3e7421868bd9e1bf0b438947f5911178">xwmm_mempool::oc_32</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_32</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00102">allocator.h:102</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_a45dc2f129fa90ee4b52dd54ebba3ab2f"><div class="ttname"><a href="structxwmm__mempool.html#a45dc2f129fa90ee4b52dd54ebba3ab2f">xwmm_mempool::oc_1024</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_1024</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00113">allocator.h:113</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_a50ca4020909dd2afbd5de522b5927dfb"><div class="ttname"><a href="structxwmm__mempool.html#a50ca4020909dd2afbd5de522b5927dfb">xwmm_mempool::oc_768</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_768</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00112">allocator.h:112</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_a8a0afacaee1b1223be08ccf6ce359b37"><div class="ttname"><a href="structxwmm__mempool.html#a8a0afacaee1b1223be08ccf6ce359b37">xwmm_mempool::oc_160</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_160</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00106">allocator.h:106</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_a95faf8f0948c43576b3dd0c555d12661"><div class="ttname"><a href="structxwmm__mempool.html#a95faf8f0948c43576b3dd0c555d12661">xwmm_mempool::oc_8</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_8</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00100">allocator.h:100</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_a97c3ef398fb9f0ab8b46122af4a6bfbf"><div class="ttname"><a href="structxwmm__mempool.html#a97c3ef398fb9f0ab8b46122af4a6bfbf">xwmm_mempool::oc_192</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_192</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00107">allocator.h:107</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_a9cb37a0576bc1e6c50a17751f7d4eb9c"><div class="ttname"><a href="structxwmm__mempool.html#a9cb37a0576bc1e6c50a17751f7d4eb9c">xwmm_mempool::oc_96</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_96</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00104">allocator.h:104</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_aacbadeb03056e73c0513fa3b373d1225"><div class="ttname"><a href="structxwmm__mempool.html#aacbadeb03056e73c0513fa3b373d1225">xwmm_mempool::oc_2048</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_2048</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00114">allocator.h:114</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_ab9056367df7cbe72dd07e3cd68f609b2"><div class="ttname"><a href="structxwmm__mempool.html#ab9056367df7cbe72dd07e3cd68f609b2">xwmm_mempool::oc_256</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_256</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00108">allocator.h:108</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_ad922ced416de3ef8539dd7f2cc818202"><div class="ttname"><a href="structxwmm__mempool.html#ad922ced416de3ef8539dd7f2cc818202">xwmm_mempool::oc_128</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_128</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00105">allocator.h:105</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_ae4ade1db7681bd8c4086b9cf81974ed5"><div class="ttname"><a href="structxwmm__mempool.html#ae4ade1db7681bd8c4086b9cf81974ed5">xwmm_mempool::oc_384</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_384</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00110">allocator.h:110</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_ae4db2c62465ba85764c5dd3f54585ee9"><div class="ttname"><a href="structxwmm__mempool.html#ae4db2c62465ba85764c5dd3f54585ee9">xwmm_mempool::oc_320</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_320</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00109">allocator.h:109</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_aeeba70716570172e17dbbfa6708f1254"><div class="ttname"><a href="structxwmm__mempool.html#aeeba70716570172e17dbbfa6708f1254">xwmm_mempool::oc_64</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_64</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00103">allocator.h:103</a></div></div>
<div class="ttc" id="astructxwmm__mempool_html_af94673c956897aa54efda5550fb9dfab"><div class="ttname"><a href="structxwmm__mempool.html#af94673c956897aa54efda5550fb9dfab">xwmm_mempool::oc_16</a></div><div class="ttdeci">struct xwmm_mempool_objcache oc_16</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00101">allocator.h:101</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gae8d0ab6282f0c050e0e6e37726d67e88_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_gae8d0ab6282f0c050e0e6e37726d67e88_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gae8d0ab6282f0c050e0e6e37726d67e88_cgraph" id="agroup__xwmm__mempool_gae8d0ab6282f0c050e0e6e37726d67e88_cgraph">
<area shape="rect" title="XWMM API：释放内存" alt="" coords="5,5,156,31"/>
<area shape="rect" href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967" title="依据内存地址查找页" alt="" coords="204,5,388,31"/>
<area shape="poly" title=" " alt="" coords="156,15,190,15,190,21,156,21"/>
<area shape="rect" href="page_8c.html#a601e0e3ff8fc5ad5b7348046b545062e" title="从页内存地址获得其页控制块的指针" alt="" coords="436,5,647,31"/>
<area shape="poly" title=" " alt="" coords="388,15,422,15,422,21,388,21"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gae8d0ab6282f0c050e0e6e37726d67e88_icgraph.png" border="0" usemap="#agroup__xwmm__mempool_gae8d0ab6282f0c050e0e6e37726d67e88_icgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gae8d0ab6282f0c050e0e6e37726d67e88_icgraph" id="agroup__xwmm__mempool_gae8d0ab6282f0c050e0e6e37726d67e88_icgraph">
<area shape="rect" title="XWMM API：释放内存" alt="" coords="220,5,371,31"/>
<area shape="rect" href="group__xwmm__mempool.html#gafbd8b2e5fb3f821b9e39cd234c41173b" title="XWMM API：调整内存大小" alt="" coords="5,5,172,31"/>
<area shape="poly" title=" " alt="" coords="206,21,172,21,172,15,206,15"/>
</map>
</div>

</div>
</div>
<a id="gaad8340a12043c383e489a786788e89af" name="gaad8340a12043c383e489a786788e89af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaad8340a12043c383e489a786788e89af">&#9670;&#160;</a></span>xwmm_mempool_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a>&#160;</td>
          <td class="paramname"><em>origin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>pgodr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>pre</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>membuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：初始化内存池 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>内存池的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>名字 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">origin</td><td>内存区域的起始地址 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>内存区域的总大小 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgodr</td><td>页的数量，以2的pgodr次方形式表示 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pre</td><td>预申请的内存的大小 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">membuf</td><td>指向缓冲区的指针，通过此缓冲区返回预申请内存的首地址 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-EFAULT</td><td>空指针 </td></tr>
    <tr><td class="paramname">-E2SMALL</td><td>内存区域太小 </td></tr>
    <tr><td class="paramname">-ESIZE</td><td>内存区域大小size与pgodr指明的页数量不匹配 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>同步/异步：同步</li>
<li>上下文：中断、中断底半部、线程</li>
<li>重入性：不可重入</li>
</ul>
</dd></dl>
<ul>
<li>将首地址为 <code>origin</code> ，大小为 <code>size</code> 的内存初始化为内存池：<ul>
<li>页的数量用 <code>pgodr</code> 表示，只能是2的n次方，即 <code>2, 4, 8, 16, 32, 64, 128, ...</code> ， 对应的pgodr分别为 <code>1, 2, 3, 4, 5, 6, 7, ...</code> ；</li>
<li>内存区域大小必须满足关系： <code>size == (XWMM_MEMPOOL_PAGE_SIZE * (1 &lt;&lt; pgodr))</code> 。</li>
</ul>
</li>
<li>如果在内存区域开始的地方，已经由编译器预先分配了一片内存， 用户只想将剩下的内存用作内存池，则需要将编译器预先分配的内存在内存池中申请出来， 防止内存发生重叠。参数 <code>pre</code> 以及 <code>membuf</code> 就是作为此用途而设计的。 <code>membuf</code> 可以为 <code>NULL</code> ，表示不需要返回编译器预先申请内存的首地址。 </li>
</ul>
<p>&lt; 每页内存的字节数</p>
<p>&lt;Size error</p>
<p>&lt; 每页内存的字节数</p>
<p>&lt; 每页内存的字节数</p>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="allocator_8c_source.html">allocator.c</a> 第 <a class="el" href="allocator_8c_source.html#l00200">200</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  203</span>{</div>
<div class="line"><span class="lineno">  204</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  205</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page__odrbtree.html">xwmm_mempool_page_odrbtree</a> * odrbtrees;</div>
<div class="line"><span class="lineno">  206</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> odrbtrees_size;</div>
<div class="line"><span class="lineno">  207</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> * pages;</div>
<div class="line"><span class="lineno">  208</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> pages_nr;</div>
<div class="line"><span class="lineno">  209</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> pages_size;</div>
<div class="line"><span class="lineno">  210</span>        <span class="keywordtype">void</span> * mem;</div>
<div class="line"><span class="lineno">  211</span> </div>
<div class="line"><span class="lineno">  212</span>        <a class="code hl_define" href="group__xwos__standard.html#ga0c63a67f52b315298e2be98f79cd0c08">XWOS_VALIDATE</a>((mp), <span class="stringliteral">&quot;nullptr&quot;</span>, -<a class="code hl_define" href="group__xwos__lib__errno.html#ga3f317946e043623f9d6b93dbf60e6316">EFAULT</a>);</div>
<div class="line"><span class="lineno">  213</span> </div>
<div class="line"><span class="lineno">  214</span>        pages_nr = size / <a class="code hl_define" href="group__xwmm__mempool.html#gad29bb2a3d87539c205b4d0d51f37ce84">XWMM_MEMPOOL_PAGE_SIZE</a>;</div>
<div class="line"><span class="lineno">  215</span>        <span class="keywordflow">if</span> (pages_nr != (1U &lt;&lt; pgodr)) {</div>
<div class="line"><span class="lineno">  216</span>                rc = - <a class="code hl_define" href="group__xwos__lib__errno.html#gacb09eefda9ef228712245d1104fe9c89">ESIZE</a>;</div>
<div class="line"><span class="lineno">  217</span>                <span class="keywordflow">goto</span> err_size;</div>
<div class="line"><span class="lineno">  218</span>        }</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>        odrbtrees = (<span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page__odrbtree.html">xwmm_mempool_page_odrbtree</a> *)&amp;mp[(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)1];</div>
<div class="line"><span class="lineno">  221</span>        pages = (<span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> *)&amp;odrbtrees[pgodr + (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)1];</div>
<div class="line"><span class="lineno">  222</span>        odrbtrees_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page__odrbtree.html">xwmm_mempool_page_odrbtree</a>) *</div>
<div class="line"><span class="lineno">  223</span>                         (pgodr + (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)1);</div>
<div class="line"><span class="lineno">  224</span>        pages_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a>) &lt;&lt; pgodr;</div>
<div class="line"><span class="lineno">  225</span>        rc = <a class="code hl_function" href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d">xwmm_mempool_construct</a>(mp, name, origin, size, odrbtrees, pages);</div>
<div class="line"><span class="lineno">  226</span>        <span class="keywordflow">if</span> (rc &lt; 0) {</div>
<div class="line"><span class="lineno">  227</span>                <span class="keywordflow">goto</span> err_mempool_construct;</div>
<div class="line"><span class="lineno">  228</span>        }</div>
<div class="line"><span class="lineno">  229</span> </div>
<div class="line"><span class="lineno">  230</span>        <span class="keywordflow">if</span> (pre &gt; (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)0) {</div>
<div class="line"><span class="lineno">  231</span>                rc = <a class="code hl_function" href="group__xwmm__mempool.html#ga8b258eb1da7cce5a8bb34c600dd72c11">xwmm_mempool_malloc</a>(mp, pre, &amp;mem);</div>
<div class="line"><span class="lineno">  232</span>                <span class="keywordflow">if</span> (rc &lt; 0) {</div>
<div class="line"><span class="lineno">  233</span>                        <span class="keywordflow">goto</span> err_mempool_prealloc;</div>
<div class="line"><span class="lineno">  234</span>                }</div>
<div class="line"><span class="lineno">  235</span>                <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> != membuf) {</div>
<div class="line"><span class="lineno">  236</span>                        *membuf = mem;</div>
<div class="line"><span class="lineno">  237</span>                }</div>
<div class="line"><span class="lineno">  238</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a>)mp == origin) {</div>
<div class="line"><span class="lineno">  239</span>                <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> mpsz = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool.html">xwmm_mempool</a>) + odrbtrees_size + pages_size;</div>
<div class="line"><span class="lineno">  240</span>                <span class="keywordflow">if</span> (mpsz &lt; <a class="code hl_define" href="group__xwmm__mempool.html#gad29bb2a3d87539c205b4d0d51f37ce84">XWMM_MEMPOOL_PAGE_SIZE</a>) {</div>
<div class="line"><span class="lineno">  241</span>                        mpsz = <a class="code hl_define" href="group__xwmm__mempool.html#gad29bb2a3d87539c205b4d0d51f37ce84">XWMM_MEMPOOL_PAGE_SIZE</a>;</div>
<div class="line"><span class="lineno">  242</span>                }</div>
<div class="line"><span class="lineno">  243</span>                rc = <a class="code hl_function" href="group__xwmm__mempool.html#ga8b258eb1da7cce5a8bb34c600dd72c11">xwmm_mempool_malloc</a>(mp, mpsz, &amp;mem);</div>
<div class="line"><span class="lineno">  244</span>                <span class="keywordflow">if</span> (rc &lt; 0) {</div>
<div class="line"><span class="lineno">  245</span>                        <span class="keywordflow">goto</span> err_mempool_prealloc;</div>
<div class="line"><span class="lineno">  246</span>                }</div>
<div class="line"><span class="lineno">  247</span>                <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> != membuf) {</div>
<div class="line"><span class="lineno">  248</span>                        *membuf = mem;</div>
<div class="line"><span class="lineno">  249</span>                }</div>
<div class="line"><span class="lineno">  250</span>        } <span class="keywordflow">else</span> {}</div>
<div class="line"><span class="lineno">  251</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>err_mempool_prealloc:</div>
<div class="line"><span class="lineno">  254</span>err_mempool_construct:</div>
<div class="line"><span class="lineno">  255</span>err_size:</div>
<div class="line"><span class="lineno">  256</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  257</span>}</div>
<div class="ttc" id="aallocator_8c_html_a6e1f6748cc378d09e931897b69231d0d"><div class="ttname"><a href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d">xwmm_mempool_construct</a></div><div class="ttdeci">static xwer_t xwmm_mempool_construct(struct xwmm_mempool *mp, const char *name, xwptr_t origin, xwsz_t size, struct xwmm_mempool_page_odrbtree *odrbtree, struct xwmm_mempool_page *pgarray)</div><div class="ttdoc">构建内存池</div><div class="ttdef"><b>Definition</b> <a href="allocator_8c_source.html#l00042">allocator.c:42</a></div></div>
<div class="ttc" id="agroup__xwmm__mempool_html_ga8b258eb1da7cce5a8bb34c600dd72c11"><div class="ttname"><a href="group__xwmm__mempool.html#ga8b258eb1da7cce5a8bb34c600dd72c11">xwmm_mempool_malloc</a></div><div class="ttdeci">xwer_t xwmm_mempool_malloc(struct xwmm_mempool *mp, xwsz_t size, void **membuf)</div><div class="ttdoc">XWMM API：从内存池中申请内存</div><div class="ttdef"><b>Definition</b> <a href="allocator_8c_source.html#l00260">allocator.c:260</a></div></div>
<div class="ttc" id="agroup__xwmm__mempool_html_gad29bb2a3d87539c205b4d0d51f37ce84"><div class="ttname"><a href="group__xwmm__mempool.html#gad29bb2a3d87539c205b4d0d51f37ce84">XWMM_MEMPOOL_PAGE_SIZE</a></div><div class="ttdeci">#define XWMM_MEMPOOL_PAGE_SIZE</div><div class="ttdef"><b>Definition</b> <a href="allocator_8h_source.html#l00051">allocator.h:51</a></div></div>
<div class="ttc" id="agroup__xwos__lib__errno_html_gacb09eefda9ef228712245d1104fe9c89"><div class="ttname"><a href="group__xwos__lib__errno.html#gacb09eefda9ef228712245d1104fe9c89">ESIZE</a></div><div class="ttdeci">#define ESIZE</div><div class="ttdoc">Size error</div><div class="ttdef"><b>Definition</b> <a href="errno_8h_source.html#l00202">errno.h:202</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_ga2d00153ecb0cdcc8ea0823c13ee59649"><div class="ttname"><a href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a></div><div class="ttdeci">unsigned long xwsz_t</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00339">type.h:339</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_gacef49946313c8d1985a8279bb40e31c4"><div class="ttname"><a href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a></div><div class="ttdeci">unsigned long xwptr_t</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00375">type.h:375</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gaad8340a12043c383e489a786788e89af_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_gaad8340a12043c383e489a786788e89af_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gaad8340a12043c383e489a786788e89af_cgraph" id="agroup__xwmm__mempool_gaad8340a12043c383e489a786788e89af_cgraph">
<area shape="rect" title="XWMM API：初始化内存池" alt="" coords="5,738,151,764"/>
<area shape="rect" href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d" title="构建内存池" alt="" coords="199,713,381,738"/>
<area shape="poly" title=" " alt="" coords="150,740,185,736,185,741,151,745"/>
<area shape="rect" href="group__xwmm__mempool.html#ga8b258eb1da7cce5a8bb34c600dd72c11" title="XWMM API：从内存池中申请内存" alt="" coords="207,762,373,788"/>
<area shape="poly" title=" " alt="" coords="151,757,193,761,193,767,150,762"/>
<area shape="rect" href="group__xwmm__mempool.html#ga15d8fc6d72d2ef920927bd6702174c3a" title="XWMM API：初始化对象缓存" alt="" coords="429,652,633,677"/>
<area shape="poly" title=" " alt="" coords="340,710,467,678,468,683,341,716"/>
<area shape="rect" href="group__xwmm__mempool.html#gaeac7d28f7509e0c764b9f995ebd45f12" title="XWMM API：初始化页分配器" alt="" coords="909,856,1145,881"/>
<area shape="poly" title=" " alt="" coords="358,736,948,851,947,856,357,741"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga08f9a7aec46aaeee30262e4bbdc65c0a" title="初始化一个链表头。" alt="" coords="698,702,845,728"/>
<area shape="poly" title=" " alt="" coords="593,675,698,697,697,702,592,680"/>
<area shape="rect" href="objcache_8c.html#a7214f0b448c3680b68f84d3bb6d7155a" title="i_allocator接口函数：释放内存" alt="" coords="681,396,861,436"/>
<area shape="poly" title=" " alt="" coords="543,650,740,444,743,448,547,653"/>
<area shape="rect" href="objcache_8c.html#a27d6631115c7033bfb49d22d5d3d992d" title="i_allocator接口函数：申请内存" alt="" coords="681,576,861,616"/>
<area shape="poly" title=" " alt="" coords="577,649,686,618,687,623,578,654"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#ga230119b86fd51047f83cbe1e74982892" title="XWOS API：初始化顺序锁" alt="" coords="1231,798,1339,824"/>
<area shape="poly" title=" " alt="" coords="634,664,744,672,862,687,968,710,1073,739,1237,791,1236,796,1071,744,967,715,861,692,743,677,633,670"/>
<area shape="rect" href="group__xwmm__mempool.html#gae7d39e7ba00cc3926284e6ba8775121b" title="XWMM API：释放对象到对象缓存中" alt="" coords="923,298,1132,324"/>
<area shape="poly" title=" " alt="" coords="820,394,982,327,984,331,822,399"/>
<area shape="rect" href="group__xwos__lib__lfq.html#ga1cac1b49ec185ccb135f19401e286166" title="将一个节点推入无锁队列（栈式队列）" alt="" coords="1746,29,1854,54"/>
<area shape="poly" title=" " alt="" coords="1042,296,1100,251,1191,188,1303,123,1363,94,1425,71,1506,51,1589,40,1667,36,1732,36,1732,41,1667,41,1589,46,1507,57,1426,76,1365,99,1305,128,1194,193,1103,255,1046,300"/>
<area shape="rect" href="objcache_8c.html#a21221e21cca4abbdfc36138c1cecb3f5" title="释放空闲页" alt="" coords="1195,226,1375,266"/>
<area shape="poly" title=" " alt="" coords="1078,296,1192,267,1193,272,1079,301"/>
<area shape="rect" href="objcache_8c.html#a6523b89f414d275f4c4548a684b21092" title="减少页的引用计数" alt="" coords="1195,291,1375,331"/>
<area shape="poly" title=" " alt="" coords="1132,308,1182,308,1182,314,1132,314"/>
<area shape="rect" href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967" title="依据内存地址查找页" alt="" coords="1193,482,1377,508"/>
<area shape="poly" title=" " alt="" coords="1040,322,1100,391,1145,432,1195,467,1211,475,1209,480,1192,472,1141,436,1096,395,1036,326"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab12f3ce1a4e53de3112b10c9ffb06cae" title="删除一个节点，并重新初始化它" alt="" coords="1463,281,1598,306"/>
<area shape="poly" title=" " alt="" coords="1376,261,1452,276,1451,281,1375,266"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga54d0d6c4a04b8f3c80891f7d0f5a1e62" title="测试链表是否为空。" alt="" coords="1455,232,1607,257"/>
<area shape="poly" title=" " alt="" coords="1376,243,1441,242,1441,248,1376,248"/>
<area shape="rect" href="group__xwmm__mempool.html#ga52f11e08dc37a0cc72717169b6ae4131" title="XWMM API：释放一页内存" alt="" coords="1438,497,1623,522"/>
<area shape="poly" title=" " alt="" coords="1360,264,1379,277,1399,303,1408,327,1414,353,1428,382,1469,439,1510,485,1506,489,1465,442,1423,384,1409,354,1403,329,1394,305,1375,281,1357,268"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb" title="XWOS API：开启写临界区，保存本地CPU的中断标志并关闭" alt="" coords="2251,432,2443,457"/>
<area shape="poly" title=" " alt="" coords="1300,224,1350,170,1385,142,1424,122,1496,98,1558,82,1614,75,1668,74,1722,79,1779,89,1917,122,2005,146,2071,174,2132,213,2204,269,2244,306,2280,347,2332,419,2328,422,2276,350,2241,310,2201,273,2129,217,2068,179,2003,151,1915,127,1778,95,1721,84,1668,79,1615,80,1559,87,1497,103,1426,127,1388,147,1354,174,1304,227"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8" title="XWOS API：关闭写临界区，恢复本地CPU的中断标志" alt="" coords="2271,624,2422,664"/>
<area shape="poly" title=" " alt="" coords="1361,223,1471,201,1612,185,1688,183,1766,186,1843,197,1917,217,1992,250,2062,296,2126,350,2183,408,2232,467,2273,523,2330,611,2325,614,2269,526,2228,470,2179,411,2122,353,2059,300,1990,255,1915,222,1842,202,1765,192,1688,188,1612,190,1472,206,1362,228"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab7918962f86f86d5c7049922a5173e81" title="删除prev节点与next节点之间的节点" alt="" coords="1717,232,1883,257"/>
<area shape="poly" title=" " alt="" coords="1598,279,1716,257,1717,262,1599,284"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga3286c94ae92265dea90fd52bfdb85569" title="初始化一个链表节点。" alt="" coords="1727,281,1873,306"/>
<area shape="poly" title=" " alt="" coords="1598,291,1713,291,1713,296,1598,296"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7" title="初始化红黑树节点" alt="" coords="2271,790,2422,816"/>
<area shape="poly" title=" " alt="" coords="1566,520,1634,550,1725,594,1824,652,1872,685,1918,721,1933,738,1941,755,1949,770,1965,782,2002,798,2040,809,2120,821,2197,821,2265,815,2265,820,2197,826,2119,826,2039,814,2000,803,1963,787,1945,773,1936,757,1928,741,1914,725,1869,690,1821,657,1722,599,1632,555,1563,525"/>
<area shape="rect" href="page_8c.html#a8e9302d65eea335934b13f63caea64aa" title="合并空闲的伙伴页" alt="" coords="1694,532,1906,557"/>
<area shape="poly" title=" " alt="" coords="1624,519,1688,527,1687,533,1623,524"/>
<area shape="rect" href="page_8c.html#aeea41b96161d6bab8ed17f9df7dbb2f9" title="获取页的序列值" alt="" coords="1695,482,1905,508"/>
<area shape="poly" title=" " alt="" coords="1623,502,1681,499,1682,504,1624,507"/>
<area shape="rect" href="page_8c.html#aecba66f62c5f653b61e4dd01d92bcc6c" title="找到页的伙伴页" alt="" coords="1993,503,2174,543"/>
<area shape="poly" title=" " alt="" coords="1906,534,1978,528,1979,534,1906,539"/>
<area shape="rect" href="page_8c.html#adc418491ba0dd770fa96b845e96722d9" title="增加页到阶红黑树中" alt="" coords="1964,848,2203,873"/>
<area shape="poly" title=" " alt="" coords="1812,556,1893,680,1966,783,2005,814,2046,839,2043,844,2002,819,1962,786,1889,683,1807,559"/>
<area shape="rect" href="page_8c.html#a0803eb38a9059618cf4c98136dc70033" title="从阶红黑树中删除页" alt="" coords="1978,567,2189,607"/>
<area shape="poly" title=" " alt="" coords="1885,554,1965,567,1964,572,1884,560"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa09f90f7792b00240a3cecef84946d88" title="插入一个红色节点后修正红黑树的颜色" alt="" coords="2281,840,2412,880"/>
<area shape="poly" title=" " alt="" coords="2203,858,2267,858,2267,863,2203,863"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaef7f6608cd37a0fb765adb003428ec38" title="链接节点，并设置位置及颜色信息" alt="" coords="2523,888,2642,913"/>
<area shape="poly" title=" " alt="" coords="2139,871,2251,890,2389,898,2510,899,2510,905,2388,904,2250,895,2138,876"/>
<area shape="poly" title=" " alt="" coords="2115,845,2160,820,2182,803,2201,783,2215,760,2223,740,2230,702,2234,661,2248,611,2288,531,2327,467,2332,470,2293,534,2253,613,2240,662,2236,702,2228,742,2219,763,2205,786,2185,807,2163,825,2118,850"/>
<area shape="poly" title=" " alt="" coords="2112,845,2157,820,2180,803,2201,783,2217,755,2222,728,2229,701,2249,675,2257,668,2261,672,2253,678,2234,704,2228,729,2222,757,2205,786,2184,807,2160,824,2115,850"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga3d27937625dc93286c012da5e82945b8" title="反转节点的颜色" alt="" coords="2507,805,2658,830"/>
<area shape="poly" title=" " alt="" coords="2412,846,2498,830,2499,835,2413,851"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga8e9025d3e8bade2a627001fb58251047" title="返回节点的父节点指针" alt="" coords="2503,740,2663,765"/>
<area shape="poly" title=" " alt="" coords="2411,838,2441,825,2465,808,2489,790,2534,768,2537,773,2492,795,2468,812,2444,829,2413,843"/>
<area shape="poly" title=" " alt="" coords="2110,605,2252,724,2320,779,2317,783,2249,728,2107,609"/>
<area shape="poly" title=" " alt="" coords="2189,565,2251,561,2318,564,2384,580,2415,593,2444,610,2458,623,2466,638,2471,668,2475,698,2481,712,2492,725,2501,731,2497,735,2489,729,2476,714,2469,699,2465,668,2461,640,2454,627,2441,615,2413,597,2382,585,2317,570,2251,566,2189,570"/>
<area shape="poly" title=" " alt="" coords="2173,565,2201,553,2236,533,2269,509,2321,465,2324,469,2272,514,2239,537,2204,557,2175,569"/>
<area shape="poly" title=" " alt="" coords="2176,605,2258,623,2257,628,2175,610"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gac57fdaeef6a9dc2ee2bedbf5ac885f96" title="删除一个节点，并修正红黑树的颜色" alt="" coords="2275,689,2418,714"/>
<area shape="poly" title=" " alt="" coords="2118,605,2179,640,2252,674,2277,683,2275,688,2250,679,2176,644,2115,610"/>
<area shape="poly" title=" " alt="" coords="2373,712,2492,774,2541,797,2539,802,2489,779,2370,717"/>
<area shape="poly" title=" " alt="" coords="2407,712,2510,734,2509,739,2406,717"/>
<area shape="poly" title=" " alt="" coords="2368,712,2405,740,2445,776,2468,809,2478,823,2492,840,2519,861,2546,878,2543,883,2516,865,2489,844,2474,827,2464,812,2441,780,2401,744,2365,717"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga2502fed0a895591911885bd8725de911" title="返回节点的后继节点" alt="" coords="2491,592,2675,617"/>
<area shape="poly" title=" " alt="" coords="2412,687,2441,674,2456,663,2465,651,2474,638,2489,626,2502,620,2505,624,2492,631,2478,642,2469,654,2459,667,2444,679,2415,692"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga692ff81d9c30fac79a823c5c2ff2357d" title="将节点设置为黑色" alt="" coords="2505,641,2660,666"/>
<area shape="poly" title=" " alt="" coords="2409,686,2506,667,2507,672,2410,692"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga7b281445f2079f235077400ee79f15ea" title="用新节点代替旧节点并继承它的链指针、颜色和位置信息， 但新节点并不接管旧节点的子节点" alt="" coords="2505,690,2661,716"/>
<area shape="poly" title=" " alt="" coords="2418,699,2491,700,2491,705,2418,705"/>
<area shape="poly" title=" " alt="" coords="1375,302,1449,297,1450,302,1376,307"/>
<area shape="poly" title=" " alt="" coords="1353,289,1376,276,1390,261,1398,245,1407,230,1424,217,1493,188,1555,170,1611,162,1665,162,1720,169,1778,181,1917,217,1979,235,2040,259,2155,316,2252,375,2319,421,2316,426,2249,379,2153,321,2038,264,1977,240,1915,222,1777,187,1719,174,1665,167,1612,167,1556,175,1495,193,1427,221,1411,233,1403,248,1394,264,1379,280,1355,293"/>
<area shape="poly" title=" " alt="" coords="1319,329,1368,356,1426,381,1486,397,1542,409,1644,419,1736,419,1822,414,1908,411,1998,419,2045,428,2095,442,2148,462,2204,489,2243,515,2278,547,2328,611,2324,615,2274,551,2240,519,2201,493,2146,467,2093,447,2044,433,1997,424,1908,417,1823,419,1736,424,1643,425,1541,414,1485,403,1424,386,1366,361,1317,334"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga942be8d64e19cb8efb4dd1cf10e6e706" title="将一个节点加入链表头部（链表头的后面）" alt="" coords="1455,700,1606,725"/>
<area shape="poly" title=" " alt="" coords="1314,329,1349,362,1380,404,1394,438,1400,468,1401,522,1404,575,1412,603,1428,634,1457,666,1492,691,1489,695,1454,670,1423,637,1407,605,1398,576,1396,522,1395,468,1388,439,1375,407,1345,365,1311,333"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga42c09bc0da5cac8327003314056f43b7" title="将一个新节点加入到prev与next之间" alt="" coords="1715,736,1885,761"/>
<area shape="poly" title=" " alt="" coords="1607,720,1702,733,1701,738,1606,725"/>
<area shape="rect" href="page_8c.html#a601e0e3ff8fc5ad5b7348046b545062e" title="从页内存地址获得其页控制块的指针" alt="" coords="1425,598,1636,624"/>
<area shape="poly" title=" " alt="" coords="1356,505,1379,517,1395,532,1404,548,1412,563,1427,577,1455,591,1453,596,1424,581,1408,566,1399,550,1391,535,1376,521,1353,510"/>
<area shape="rect" href="group__xwmm__mempool.html#ga86e445faf7ecf95130e042fa9b96a41b" title="XWMM API：从对象缓存中申请一个对象" alt="" coords="937,535,1117,575"/>
<area shape="poly" title=" " alt="" coords="861,579,923,569,924,574,862,585"/>
<area shape="poly" title=" " alt="" coords="1044,533,1105,470,1147,435,1192,403,1241,380,1283,368,1325,358,1376,341,1400,328,1424,317,1453,307,1455,313,1426,322,1402,333,1378,346,1326,363,1284,373,1243,385,1195,408,1150,439,1109,474,1048,537"/>
<area shape="poly" title=" " alt="" coords="1038,534,1086,448,1143,334,1155,299,1162,270,1171,243,1191,212,1247,154,1301,110,1354,79,1408,57,1466,42,1530,32,1684,14,1768,5,1843,3,1910,8,1971,22,2029,45,2086,79,2144,125,2205,184,2252,244,2291,309,2320,370,2339,418,2334,420,2315,372,2286,311,2248,247,2201,188,2140,129,2083,84,2027,50,1969,27,1909,14,1843,8,1769,11,1684,19,1531,37,1467,47,1410,62,1356,83,1304,114,1251,157,1195,215,1176,245,1167,272,1160,301,1148,336,1090,450,1043,536"/>
<area shape="poly" title=" " alt="" coords="1061,573,1121,605,1157,620,1194,631,1343,659,1496,676,1649,684,1798,685,1938,681,2064,673,2257,654,2258,659,2064,678,1938,686,1798,691,1649,690,1496,681,1342,664,1193,636,1155,625,1119,610,1059,577"/>
<area shape="poly" title=" " alt="" coords="1056,573,1135,634,1194,675,1257,694,1322,706,1385,712,1442,713,1442,719,1385,717,1321,711,1256,699,1192,680,1132,639,1052,577"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga2aa317fe5cea0989c273b3c69f69d795" title="将一个节点加入链表尾部（链表头的前面）" alt="" coords="1461,749,1600,774"/>
<area shape="poly" title=" " alt="" coords="1062,573,1104,604,1147,644,1162,665,1169,684,1178,701,1195,717,1224,733,1256,745,1322,761,1388,767,1447,767,1447,772,1388,772,1321,766,1254,750,1222,737,1192,721,1173,705,1164,686,1157,668,1143,647,1101,609,1059,577"/>
<area shape="rect" href="group__xwos__lib__lfq.html#gacbe43c237a9c7c6f21baa98daaf49e68" title="弹出无锁队列中的第一个节点（栈式队列）" alt="" coords="1235,532,1336,557"/>
<area shape="poly" title=" " alt="" coords="1118,549,1221,544,1221,550,1118,554"/>
<area shape="rect" href="objcache_8c.html#a23e4915feeaf7a05d46ec2affe504642" title="获取一页，准备从页内存中分配对象" alt="" coords="1195,418,1375,458"/>
<area shape="poly" title=" " alt="" coords="1063,533,1123,501,1192,467,1210,460,1212,465,1194,472,1125,505,1065,537"/>
<area shape="poly" title=" " alt="" coords="1600,756,1701,751,1701,756,1600,761"/>
<area shape="poly" title=" " alt="" coords="1335,415,1376,389,1390,371,1398,353,1406,334,1424,317,1449,304,1451,309,1427,321,1411,338,1403,355,1395,373,1379,393,1338,420"/>
<area shape="poly" title=" " alt="" coords="1306,416,1340,382,1375,341,1388,320,1396,301,1406,284,1424,266,1440,257,1443,262,1427,271,1410,287,1401,304,1393,323,1379,345,1344,386,1310,420"/>
<area shape="poly" title=" " alt="" coords="1376,436,2237,441,2237,446,1376,441"/>
<area shape="poly" title=" " alt="" coords="1358,456,1379,468,1395,485,1403,502,1411,517,1427,531,1462,544,1523,557,1692,583,1964,616,2120,630,2258,638,2257,643,2119,635,1964,622,1691,588,1522,562,1460,549,1424,536,1407,521,1398,504,1390,488,1376,472,1356,460"/>
<area shape="rect" href="objcache_8c.html#a75c1bbc6602c82f1cc906c65303ee59d" title="初始化新页" alt="" coords="1441,331,1621,371"/>
<area shape="poly" title=" " alt="" coords="1342,415,1459,373,1461,378,1344,420"/>
<area shape="rect" href="group__xwmm__mempool.html#ga7cbe7d0a7d7052c887dc7723c5010ec1" title="XWMM API：申请一页内存" alt="" coords="1427,828,1635,853"/>
<area shape="poly" title=" " alt="" coords="1366,456,1379,468,1404,509,1414,549,1413,588,1407,626,1400,664,1398,703,1406,743,1427,784,1448,805,1474,820,1471,824,1445,809,1423,787,1401,744,1393,703,1395,663,1402,625,1408,587,1409,549,1400,511,1375,471,1362,460"/>
<area shape="poly" title=" " alt="" coords="1614,329,1634,316,1653,293,1662,271,1669,247,1682,218,1734,132,1780,64,1784,67,1738,135,1686,220,1674,249,1667,273,1658,296,1638,320,1617,333"/>
<area shape="poly" title=" " alt="" coords="1620,329,1683,315,1724,307,1725,312,1685,320,1621,334"/>
<area shape="rect" href="group__xwos__lib__lfq.html#gac87b1137608605a80577abed410ddc1a" title="初始化无锁队列节点" alt="" coords="1751,330,1849,356"/>
<area shape="poly" title=" " alt="" coords="1621,346,1737,342,1737,348,1621,351"/>
<area shape="rect" href="page_8c.html#a6385524c294a6af40c2ea0ff315d60fd" title="将大的页拆分成小的页" alt="" coords="1684,846,1916,872"/>
<area shape="poly" title=" " alt="" coords="1635,845,1670,847,1670,853,1635,850"/>
<area shape="rect" href="page_8c.html#ab54f23d0058e1bff33377fc2d7b0a48c" title="从阶红黑树中选择一页" alt="" coords="1978,732,2189,772"/>
<area shape="poly" title=" " alt="" coords="1611,825,1964,769,1965,774,1612,830"/>
<area shape="poly" title=" " alt="" coords="1916,857,1950,857,1950,862,1916,862"/>
<area shape="poly" title=" " alt="" coords="2188,770,2268,785,2267,790,2187,775"/>
<area shape="poly" title=" " alt="" coords="2189,750,2489,750,2489,755,2189,755"/>
<area shape="poly" title=" " alt="" coords="2101,731,2201,617,2325,466,2329,470,2205,621,2105,734"/>
<area shape="poly" title=" " alt="" coords="2158,730,2201,711,2225,693,2249,674,2263,667,2266,672,2252,679,2228,697,2204,716,2160,735"/>
<area shape="poly" title=" " alt="" coords="2187,730,2267,714,2268,720,2188,735"/>
<area shape="poly" title=" " alt="" coords="1064,879,1146,906,1260,937,1393,963,1462,971,1529,974,1801,974,1919,973,2011,963,2054,953,2099,936,2147,913,2201,882,2216,869,2224,855,2233,840,2249,826,2264,818,2266,823,2252,831,2237,844,2229,858,2220,873,2204,887,2149,918,2101,941,2056,958,2012,969,1919,978,1801,979,1529,979,1461,976,1392,968,1259,942,1144,911,1062,884"/>
<area shape="poly" title=" " alt="" coords="1081,879,1135,889,1194,898,1342,903,1539,900,1744,892,1916,880,1988,872,1988,878,1916,886,1745,897,1539,906,1342,909,1193,903,1134,895,1080,884"/>
<area shape="poly" title=" " alt="" coords="1085,853,1217,823,1218,829,1086,858"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa16ae22ddc5595638dd19df6154f4bb6" title="初始化红黑树" alt="" coords="1227,1014,1343,1040"/>
<area shape="poly" title=" " alt="" coords="1044,879,1106,933,1149,964,1195,993,1227,1007,1225,1012,1192,997,1146,969,1103,937,1040,883"/>
<area shape="rect" href="page_8c.html#a4fff326383599e57562dd2d1bd8dbc2b" title="i_allocator接口函数：释放内存" alt="" coords="1202,582,1369,622"/>
<area shape="poly" title=" " alt="" coords="1039,854,1253,630,1257,634,1043,857"/>
<area shape="rect" href="page_8c.html#a4b4868cc6b3b9570ba579c040c6d11a2" title="i_allocator接口函数：申请内存" alt="" coords="1202,848,1369,888"/>
<area shape="poly" title=" " alt="" coords="1145,866,1188,866,1188,871,1145,871"/>
<area shape="poly" title=" " alt="" coords="1341,579,1376,566,1483,525,1485,530,1378,571,1343,584"/>
<area shape="poly" title=" " alt="" coords="1369,602,1412,604,1412,609,1369,608"/>
<area shape="poly" title=" " alt="" coords="1369,856,1413,851,1413,856,1369,862"/>
</map>
</div>

</div>
</div>
<a id="ga8b258eb1da7cce5a8bb34c600dd72c11" name="ga8b258eb1da7cce5a8bb34c600dd72c11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8b258eb1da7cce5a8bb34c600dd72c11">&#9670;&#160;</a></span>xwmm_mempool_malloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_malloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>membuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：从内存池中申请内存 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>内存池的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>申请的大小 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">membuf</td><td>指向缓冲区的指针，通过此缓冲区返回申请到的内存的首地址 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-EFAULT</td><td>空指针 </td></tr>
    <tr><td class="paramname">-ENOMEM</td><td>内存不足 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>同步/异步：同步</li>
<li>上下文：中断、中断底半部、线程</li>
<li>重入性：可重入</li>
</ul>
</dd></dl>
<ul>
<li>此函数向内存池申请大小为 <code>size</code> 的内存：<ul>
<li>若申请成功，通过 <code>*membuf</code> 返回申请到的内存地址 ，返回错误码为 <code>XWOK</code> ；</li>
<li>若申请失败，通过 <code>*membuf</code> 返回 <code>NULL</code> ，返回值为负的错误码。</li>
</ul>
</li>
<li>内存不会被初始化；</li>
<li>当 <code>size</code> 为 <code>0</code> ， 通过 <code>*membuf</code> 返回 <code>NULL</code> ，返回错误码为 <code>XWOK</code> ； </li>
</ul>
<p>&lt;No error</p>
<p>&lt; 内存管理对齐的字节数</p>
<p>&lt; 内存管理对齐的字节数</p>

<p class="definition">在文件 <a class="el" href="allocator_8c_source.html">allocator.c</a> 第 <a class="el" href="allocator_8c_source.html#l00260">260</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  261</span>{</div>
<div class="line"><span class="lineno">  262</span>        <span class="keyword">interface </span><a class="code hl_struct" href="structxwmm__mempool__i__allocator.html">xwmm_mempool_i_allocator</a> * ia;</div>
<div class="line"><span class="lineno">  263</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga89fd1295e4575443671eb9ae21c34567">xwssq_t</a> odr;</div>
<div class="line"><span class="lineno">  264</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  265</span> </div>
<div class="line"><span class="lineno">  266</span>        <a class="code hl_define" href="group__xwos__standard.html#ga0c63a67f52b315298e2be98f79cd0c08">XWOS_VALIDATE</a>((mp), <span class="stringliteral">&quot;nullptr&quot;</span>, -<a class="code hl_define" href="group__xwos__lib__errno.html#ga3f317946e043623f9d6b93dbf60e6316">EFAULT</a>);</div>
<div class="line"><span class="lineno">  267</span>        <a class="code hl_define" href="group__xwos__standard.html#ga0c63a67f52b315298e2be98f79cd0c08">XWOS_VALIDATE</a>((membuf), <span class="stringliteral">&quot;nullptr&quot;</span>, -<a class="code hl_define" href="group__xwos__lib__errno.html#ga3f317946e043623f9d6b93dbf60e6316">EFAULT</a>);</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>        <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)0 == size) {</div>
<div class="line"><span class="lineno">  270</span>                rc = <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  271</span>                *membuf = <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">  272</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  273</span>                size = <a class="code hl_define" href="group__xwos__lib__xwbop.html#ga9f63c663f101e3b76de2eba319247598">XWBOP_ALIGN</a>(size, (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)<a class="code hl_define" href="group__xwmm__common.html#ga5fda7561f71a27db613b7fe335ea3259">XWMM_ALIGNMENT</a>);</div>
<div class="line"><span class="lineno">  274</span>                odr = <a class="code hl_define" href="group__xwos__lib__xwbop.html#ga32ef40a92f3aa57b62af62cf69c06a75">xwbop_fls</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, size);</div>
<div class="line"><span class="lineno">  275</span>                <span class="keywordflow">while</span> (((<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)1 &lt;&lt; (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)odr) &lt; size) {</div>
<div class="line"><span class="lineno">  276</span>                        odr++;</div>
<div class="line"><span class="lineno">  277</span>                }</div>
<div class="line"><span class="lineno">  278</span>                <span class="comment">// cppcheck-suppress [misra-c2012-17.8]</span></div>
<div class="line"><span class="lineno">  279</span>                size = (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)1 &lt;&lt; (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)odr;</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>                <span class="keywordflow">switch</span> (size) {</div>
<div class="line"><span class="lineno">  282</span>                <span class="keywordflow">case</span> 8:</div>
<div class="line"><span class="lineno">  283</span>                        ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a95faf8f0948c43576b3dd0c555d12661">oc_8</a>;</div>
<div class="line"><span class="lineno">  284</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  285</span>                <span class="keywordflow">case</span> 16:</div>
<div class="line"><span class="lineno">  286</span>                        ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#af94673c956897aa54efda5550fb9dfab">oc_16</a>;</div>
<div class="line"><span class="lineno">  287</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  288</span>                <span class="keywordflow">case</span> 32:</div>
<div class="line"><span class="lineno">  289</span>                        ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a3e7421868bd9e1bf0b438947f5911178">oc_32</a>;</div>
<div class="line"><span class="lineno">  290</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  291</span>                <span class="keywordflow">case</span> 64:</div>
<div class="line"><span class="lineno">  292</span>                        ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#aeeba70716570172e17dbbfa6708f1254">oc_64</a>;</div>
<div class="line"><span class="lineno">  293</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  294</span>                <span class="keywordflow">case</span> 128:</div>
<div class="line"><span class="lineno">  295</span>                        <span class="keywordflow">if</span> (size &lt;= (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)96) {</div>
<div class="line"><span class="lineno">  296</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a9cb37a0576bc1e6c50a17751f7d4eb9c">oc_96</a>;</div>
<div class="line"><span class="lineno">  297</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  298</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ad922ced416de3ef8539dd7f2cc818202">oc_128</a>;</div>
<div class="line"><span class="lineno">  299</span>                        }</div>
<div class="line"><span class="lineno">  300</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  301</span>                <span class="keywordflow">case</span> 256:</div>
<div class="line"><span class="lineno">  302</span>                        <span class="keywordflow">if</span> (size &lt;= (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)160) {</div>
<div class="line"><span class="lineno">  303</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a8a0afacaee1b1223be08ccf6ce359b37">oc_160</a>;</div>
<div class="line"><span class="lineno">  304</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &lt;= (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)192) {</div>
<div class="line"><span class="lineno">  305</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a97c3ef398fb9f0ab8b46122af4a6bfbf">oc_192</a>;</div>
<div class="line"><span class="lineno">  306</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  307</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ab9056367df7cbe72dd07e3cd68f609b2">oc_256</a>;</div>
<div class="line"><span class="lineno">  308</span>                        }</div>
<div class="line"><span class="lineno">  309</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  310</span>                <span class="keywordflow">case</span> 512:</div>
<div class="line"><span class="lineno">  311</span>                        <span class="keywordflow">if</span> (size &lt;= (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)320) {</div>
<div class="line"><span class="lineno">  312</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ae4db2c62465ba85764c5dd3f54585ee9">oc_320</a>;</div>
<div class="line"><span class="lineno">  313</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &lt;= (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)384) {</div>
<div class="line"><span class="lineno">  314</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ae4ade1db7681bd8c4086b9cf81974ed5">oc_384</a>;</div>
<div class="line"><span class="lineno">  315</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  316</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a23363ae543f95164b3ef25bf77ad5263">oc_512</a>;</div>
<div class="line"><span class="lineno">  317</span>                        }</div>
<div class="line"><span class="lineno">  318</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  319</span>                <span class="keywordflow">case</span> 1024:</div>
<div class="line"><span class="lineno">  320</span>                        <span class="keywordflow">if</span> (size &lt;= (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)768) {</div>
<div class="line"><span class="lineno">  321</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a50ca4020909dd2afbd5de522b5927dfb">oc_768</a>;</div>
<div class="line"><span class="lineno">  322</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  323</span>                                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a45dc2f129fa90ee4b52dd54ebba3ab2f">oc_1024</a>;</div>
<div class="line"><span class="lineno">  324</span>                        }</div>
<div class="line"><span class="lineno">  325</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  326</span>                <span class="keywordflow">case</span> 2048:</div>
<div class="line"><span class="lineno">  327</span>                        ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#aacbadeb03056e73c0513fa3b373d1225">oc_2048</a>;</div>
<div class="line"><span class="lineno">  328</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  329</span>                <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  330</span>                        ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a128e5c1b3f2a3d075de1708b9257bfa1">pa</a>;</div>
<div class="line"><span class="lineno">  331</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  332</span>                }</div>
<div class="line"><span class="lineno">  333</span>                rc = ia-&gt;<a class="code hl_variable" href="structxwmm__mempool__i__allocator.html#a8338a06dc3dafd768e21d832868be524">malloc</a>(ia, size, membuf);</div>
<div class="line"><span class="lineno">  334</span>                <span class="keywordflow">if</span> (rc &lt; 0) {</div>
<div class="line"><span class="lineno">  335</span>                        *membuf = <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">  336</span>                }</div>
<div class="line"><span class="lineno">  337</span>        }</div>
<div class="line"><span class="lineno">  338</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  339</span>}</div>
<div class="ttc" id="agroup__xwmm__common_html_ga5fda7561f71a27db613b7fe335ea3259"><div class="ttname"><a href="group__xwmm__common.html#ga5fda7561f71a27db613b7fe335ea3259">XWMM_ALIGNMENT</a></div><div class="ttdeci">#define XWMM_ALIGNMENT</div><div class="ttdef"><b>Definition</b> <a href="xwos_2mm_2common_8h_source.html#l00029">common.h:29</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_ga89fd1295e4575443671eb9ae21c34567"><div class="ttname"><a href="group__xwos__lib__type.html#ga89fd1295e4575443671eb9ae21c34567">xwssq_t</a></div><div class="ttdeci">signed long xwssq_t</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00461">type.h:461</a></div></div>
<div class="ttc" id="agroup__xwos__lib__xwbop_html_ga32ef40a92f3aa57b62af62cf69c06a75"><div class="ttname"><a href="group__xwos__lib__xwbop.html#ga32ef40a92f3aa57b62af62cf69c06a75">xwbop_fls</a></div><div class="ttdeci">#define xwbop_fls(type, data)</div><div class="ttdoc">XWOS BOPLIB：在数据中从最高位起查找第一个被置1的位</div><div class="ttdef"><b>Definition</b> <a href="xwbop_8h_source.html#l00169">xwbop.h:169</a></div></div>
<div class="ttc" id="agroup__xwos__lib__xwbop_html_ga9f63c663f101e3b76de2eba319247598"><div class="ttname"><a href="group__xwos__lib__xwbop.html#ga9f63c663f101e3b76de2eba319247598">XWBOP_ALIGN</a></div><div class="ttdeci">#define XWBOP_ALIGN(x, n)</div><div class="ttdef"><b>Definition</b> <a href="xwbop_8h_source.html#l00037">xwbop.h:37</a></div></div>
<div class="ttc" id="astructxwmm__mempool__i__allocator_html_a8338a06dc3dafd768e21d832868be524"><div class="ttname"><a href="structxwmm__mempool__i__allocator.html#a8338a06dc3dafd768e21d832868be524">xwmm_mempool_i_allocator::malloc</a></div><div class="ttdeci">xwer_t(* malloc)(void *, xwsz_t, void **)</div><div class="ttdef"><b>Definition</b> <a href="i__allocator_8h_source.html#l00029">i_allocator.h:29</a></div></div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_ga8b258eb1da7cce5a8bb34c600dd72c11_icgraph.png" border="0" usemap="#agroup__xwmm__mempool_ga8b258eb1da7cce5a8bb34c600dd72c11_icgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_ga8b258eb1da7cce5a8bb34c600dd72c11_icgraph" id="agroup__xwmm__mempool_ga8b258eb1da7cce5a8bb34c600dd72c11_icgraph">
<area shape="rect" title="XWMM API：从内存池中申请内存" alt="" coords="220,31,387,56"/>
<area shape="rect" href="group__xwmm__mempool.html#gaad8340a12043c383e489a786788e89af" title="XWMM API：初始化内存池" alt="" coords="16,5,161,31"/>
<area shape="poly" title=" " alt="" coords="206,34,161,29,162,24,206,29"/>
<area shape="rect" href="group__xwmm__mempool.html#gafbd8b2e5fb3f821b9e39cd234c41173b" title="XWMM API：调整内存大小" alt="" coords="5,55,172,80"/>
<area shape="poly" title=" " alt="" coords="206,57,173,61,172,55,206,52"/>
</map>
</div>

</div>
</div>
<a id="ga943844e993429eb0fdf7ccc1df080296" name="ga943844e993429eb0fdf7ccc1df080296"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga943844e993429eb0fdf7ccc1df080296">&#9670;&#160;</a></span>xwmm_mempool_memalign()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_memalign </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>alignment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>membuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：从内存池中申请对齐的内存 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>内存池的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">alignment</td><td>内存的起始地址对齐的字节数，只能是2的n次方 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>申请的大小 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">membuf</td><td>指向缓冲区的指针，通过此缓冲区返回申请到的内存的首地址 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-EFAULT</td><td>空指针 </td></tr>
    <tr><td class="paramname">-ENOMEM</td><td>内存不足 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>同步/异步：同步</li>
<li>上下文：中断、中断底半部、线程</li>
<li>重入性：可重入</li>
</ul>
</dd></dl>
<ul>
<li>此API类似于C标准中的 <code>memalign()</code> 函数：<ul>
<li><code>alignment</code> 如果比 <code>XWMM_ALIGNMENT</code> 小，会被扩大为 <code>XWMM_ALIGNMENT</code> ：</li>
<li><code>alignment</code> 只能是2的n次方：</li>
<li>若size小于 <code>alignment</code> ， <code>size</code> 会被扩大为 <code>alignment</code> ，</li>
<li>若size大于 <code>alignment</code> ， <code>size</code> 会向上对齐到2的n次方，此时也一定为 <code>alignment</code> 的整数倍。</li>
</ul>
</li>
<li>申请内存失败时，此函数不会修改 <code>*membuf</code> 的值。 </li>
</ul>
<p>&lt; 内存管理对齐的字节数</p>
<p>&lt; 内存管理对齐的字节数</p>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="allocator_8c_source.html">allocator.c</a> 第 <a class="el" href="allocator_8c_source.html#l00467">467</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  470</span>{</div>
<div class="line"><span class="lineno">  471</span>        <span class="keyword">interface </span><a class="code hl_struct" href="structxwmm__mempool__i__allocator.html">xwmm_mempool_i_allocator</a> * ia;</div>
<div class="line"><span class="lineno">  472</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga89fd1295e4575443671eb9ae21c34567">xwssq_t</a> p2;</div>
<div class="line"><span class="lineno">  473</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  474</span> </div>
<div class="line"><span class="lineno">  475</span>        <a class="code hl_define" href="group__xwos__standard.html#ga0c63a67f52b315298e2be98f79cd0c08">XWOS_VALIDATE</a>((mp), <span class="stringliteral">&quot;nullptr&quot;</span>, -<a class="code hl_define" href="group__xwos__lib__errno.html#ga3f317946e043623f9d6b93dbf60e6316">EFAULT</a>);</div>
<div class="line"><span class="lineno">  476</span>        <a class="code hl_define" href="group__xwos__standard.html#ga0c63a67f52b315298e2be98f79cd0c08">XWOS_VALIDATE</a>((membuf), <span class="stringliteral">&quot;nullptr&quot;</span>, -<a class="code hl_define" href="group__xwos__lib__errno.html#ga3f317946e043623f9d6b93dbf60e6316">EFAULT</a>);</div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>        <span class="keywordflow">if</span> (alignment &lt; <a class="code hl_define" href="group__xwmm__common.html#ga5fda7561f71a27db613b7fe335ea3259">XWMM_ALIGNMENT</a>) {</div>
<div class="line"><span class="lineno">  479</span>                alignment = <a class="code hl_define" href="group__xwmm__common.html#ga5fda7561f71a27db613b7fe335ea3259">XWMM_ALIGNMENT</a>;</div>
<div class="line"><span class="lineno">  480</span>        }</div>
<div class="line"><span class="lineno">  481</span>        p2 = <a class="code hl_define" href="group__xwos__lib__xwbop.html#ga32ef40a92f3aa57b62af62cf69c06a75">xwbop_fls</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, alignment);</div>
<div class="line"><span class="lineno">  482</span>        <span class="keywordflow">if</span> (((<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)1 &lt;&lt; (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)p2) != alignment) {</div>
<div class="line"><span class="lineno">  483</span>                rc = -<a class="code hl_define" href="group__xwos__lib__errno.html#ga2d1678d5a7cc8ce499643f3b8957def4">EINVAL</a>;</div>
<div class="line"><span class="lineno">  484</span>                <span class="keywordflow">goto</span> err_notp2;</div>
<div class="line"><span class="lineno">  485</span>        }</div>
<div class="line"><span class="lineno">  486</span>        <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)0 == size) {</div>
<div class="line"><span class="lineno">  487</span>                rc = <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  488</span>                *membuf = <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">  489</span>                <span class="keywordflow">goto</span> nothing;</div>
<div class="line"><span class="lineno">  490</span>        }</div>
<div class="line"><span class="lineno">  491</span>        <span class="keywordflow">if</span> (size &lt;= alignment) {</div>
<div class="line"><span class="lineno">  492</span>                size = alignment;</div>
<div class="line"><span class="lineno">  493</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  494</span>                p2 = <a class="code hl_define" href="group__xwos__lib__xwbop.html#ga32ef40a92f3aa57b62af62cf69c06a75">xwbop_fls</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, size);</div>
<div class="line"><span class="lineno">  495</span>                <span class="keywordflow">while</span> (((<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)1 &lt;&lt; (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)p2) &lt; size) {</div>
<div class="line"><span class="lineno">  496</span>                        p2++;</div>
<div class="line"><span class="lineno">  497</span>                }</div>
<div class="line"><span class="lineno">  498</span>                size = (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)1 &lt;&lt; (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)p2;</div>
<div class="line"><span class="lineno">  499</span>        }</div>
<div class="line"><span class="lineno">  500</span> </div>
<div class="line"><span class="lineno">  501</span>        <span class="keywordflow">switch</span> (size) {</div>
<div class="line"><span class="lineno">  502</span>        <span class="keywordflow">case</span> 8:</div>
<div class="line"><span class="lineno">  503</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a95faf8f0948c43576b3dd0c555d12661">oc_8</a>;</div>
<div class="line"><span class="lineno">  504</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  505</span>        <span class="keywordflow">case</span> 16:</div>
<div class="line"><span class="lineno">  506</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#af94673c956897aa54efda5550fb9dfab">oc_16</a>;</div>
<div class="line"><span class="lineno">  507</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  508</span>        <span class="keywordflow">case</span> 32:</div>
<div class="line"><span class="lineno">  509</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a3e7421868bd9e1bf0b438947f5911178">oc_32</a>;</div>
<div class="line"><span class="lineno">  510</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  511</span>        <span class="keywordflow">case</span> 64:</div>
<div class="line"><span class="lineno">  512</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#aeeba70716570172e17dbbfa6708f1254">oc_64</a>;</div>
<div class="line"><span class="lineno">  513</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  514</span>        <span class="keywordflow">case</span> 128:</div>
<div class="line"><span class="lineno">  515</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ad922ced416de3ef8539dd7f2cc818202">oc_128</a>;</div>
<div class="line"><span class="lineno">  516</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  517</span>        <span class="keywordflow">case</span> 256:</div>
<div class="line"><span class="lineno">  518</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#ab9056367df7cbe72dd07e3cd68f609b2">oc_256</a>;</div>
<div class="line"><span class="lineno">  519</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  520</span>        <span class="keywordflow">case</span> 512:</div>
<div class="line"><span class="lineno">  521</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a23363ae543f95164b3ef25bf77ad5263">oc_512</a>;</div>
<div class="line"><span class="lineno">  522</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  523</span>        <span class="keywordflow">case</span> 1024:</div>
<div class="line"><span class="lineno">  524</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a45dc2f129fa90ee4b52dd54ebba3ab2f">oc_1024</a>;</div>
<div class="line"><span class="lineno">  525</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  526</span>        <span class="keywordflow">case</span> 2048:</div>
<div class="line"><span class="lineno">  527</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#aacbadeb03056e73c0513fa3b373d1225">oc_2048</a>;</div>
<div class="line"><span class="lineno">  528</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  529</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  530</span>                ia = (<span class="keywordtype">void</span> *)&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a128e5c1b3f2a3d075de1708b9257bfa1">pa</a>;</div>
<div class="line"><span class="lineno">  531</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  532</span>        }</div>
<div class="line"><span class="lineno">  533</span>        rc = ia-&gt;<a class="code hl_variable" href="structxwmm__mempool__i__allocator.html#a8338a06dc3dafd768e21d832868be524">malloc</a>(ia, size, membuf);</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>nothing:</div>
<div class="line"><span class="lineno">  536</span>err_notp2:</div>
<div class="line"><span class="lineno">  537</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  538</span>}</div>
<div class="ttc" id="agroup__xwos__lib__errno_html_ga2d1678d5a7cc8ce499643f3b8957def4"><div class="ttname"><a href="group__xwos__lib__errno.html#ga2d1678d5a7cc8ce499643f3b8957def4">EINVAL</a></div><div class="ttdeci">#define EINVAL</div><div class="ttdoc">Invalid argument</div><div class="ttdef"><b>Definition</b> <a href="errno_8h_source.html#l00052">errno.h:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga86e445faf7ecf95130e042fa9b96a41b" name="ga86e445faf7ecf95130e042fa9b96a41b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga86e445faf7ecf95130e042fa9b96a41b">&#9670;&#160;</a></span>xwmm_mempool_objcache_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_objcache_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *&#160;</td>
          <td class="paramname"><em>oc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>objbuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：从对象缓存中申请一个对象 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">oc</td><td>对象缓存的指针 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">objbuf</td><td>指向缓冲区的指针，此缓冲区被用于返回对象的指针 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-ENOMEM</td><td>内存不足 </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; 报告BUG</p>
<p>&lt; 当条件x成立时报告BUG</p>
<p>&lt; 报告BUG</p>
<p>&lt; 当条件x成立时报告BUG</p>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="objcache_8c_source.html">objcache.c</a> 第 <a class="el" href="objcache_8c_source.html#l00263">263</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  264</span>{</div>
<div class="line"><span class="lineno">  265</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> * pg;</div>
<div class="line"><span class="lineno">  266</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga862eb6a46e40b94681ec41a99f4fcb7e">xwlfq_t</a> * obj;</div>
<div class="line"><span class="lineno">  267</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#gad21f70aa6f1364b63b1165784448bc16">xwreg_t</a> flag;</div>
<div class="line"><span class="lineno">  268</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  269</span> </div>
<div class="line"><span class="lineno">  270</span>        rc = <a class="code hl_function" href="objcache_8c.html#a23e4915feeaf7a05d46ec2affe504642">xwmm_mempool_objcache_page_get</a>(oc, &amp;pg);</div>
<div class="line"><span class="lineno">  271</span>        <span class="keywordflow">if</span> (rc &lt; 0) {</div>
<div class="line"><span class="lineno">  272</span>                <span class="keywordflow">goto</span> err_page_get;</div>
<div class="line"><span class="lineno">  273</span>        }</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>        <a class="code hl_define" href="group__xwos__lib__xwaop.html#gae0b3f8bf7b0d30d78c73f24dbfde6273">xwaop_sub</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, &amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#aca5c7fbe77e4fc6836679fc6f4189c3d">idleness</a>, 1, <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">  276</span>        obj = <a class="code hl_function" href="group__xwos__lib__lfq.html#gacbe43c237a9c7c6f21baa98daaf49e68">xwlib_lfq_pop</a>(&amp;pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">objcache</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#ac3d78b8833f1da346fff3ead6ccc88ac">objhead</a>);</div>
<div class="line"><span class="lineno">  277</span>        <a class="code hl_define" href="group__xwos__standard.html#ga1bab891fe9a97ea85286bc6e44a88c17">XWOS_BUG_ON</a>(<a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> == obj);</div>
<div class="line"><span class="lineno">  278</span>        *obj = oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a2a35a6f0e7edd3a011291ae539af6206">backup</a>;</div>
<div class="line"><span class="lineno">  279</span>        *objbuf = (<span class="keywordtype">void</span> *)obj;</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>        <a class="code hl_function" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb">xwos_sqlk_wr_lock_cpuirqsv</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a6d27d017089b61643a2248a048b26ef8">lock</a>, &amp;flag);</div>
<div class="line"><span class="lineno">  282</span>        <a class="code hl_define" href="group__xwos__standard.html#ga1bab891fe9a97ea85286bc6e44a88c17">XWOS_BUG_ON</a>(pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">objcache</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#aa87dbecfaa4f9c859311f560c5bfdf28">refcnt</a> &gt;= oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a>);</div>
<div class="line"><span class="lineno">  283</span>        pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">objcache</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#aa87dbecfaa4f9c859311f560c5bfdf28">refcnt</a>++;</div>
<div class="line"><span class="lineno">  284</span>        <a class="code hl_function" href="group__xwos__lib__bclst.html#gab12f3ce1a4e53de3112b10c9ffb06cae">xwlib_bclst_del_init</a>(&amp;pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">objcache</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a12866c4340feabc2fade6a9d5a7dbb16">node</a>);</div>
<div class="line"><span class="lineno">  285</span>        <span class="keywordflow">if</span> (pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">objcache</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#aa87dbecfaa4f9c859311f560c5bfdf28">refcnt</a> == oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a>) {</div>
<div class="line"><span class="lineno">  286</span>                <a class="code hl_function" href="group__xwos__lib__bclst.html#ga2aa317fe5cea0989c273b3c69f69d795">xwlib_bclst_add_tail</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a05d16698a1572d3ad039e4f3d8e4a5ee">full</a>, &amp;pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">objcache</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a12866c4340feabc2fade6a9d5a7dbb16">node</a>);</div>
<div class="line"><span class="lineno">  287</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  288</span>                <a class="code hl_function" href="group__xwos__lib__bclst.html#ga942be8d64e19cb8efb4dd1cf10e6e706">xwlib_bclst_add_head</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#aa90dcd466fd2d2df7008925e664d277d">available</a>, &amp;pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">objcache</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a12866c4340feabc2fade6a9d5a7dbb16">node</a>);</div>
<div class="line"><span class="lineno">  289</span>        }</div>
<div class="line"><span class="lineno">  290</span>        <a class="code hl_function" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8">xwos_sqlk_wr_unlock_cpuirqrs</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a6d27d017089b61643a2248a048b26ef8">lock</a>, flag);</div>
<div class="line"><span class="lineno">  291</span> </div>
<div class="line"><span class="lineno">  292</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>err_page_get:</div>
<div class="line"><span class="lineno">  295</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  296</span>}</div>
<div class="ttc" id="agroup__xwos__lib__bclst_html_ga2aa317fe5cea0989c273b3c69f69d795"><div class="ttname"><a href="group__xwos__lib__bclst.html#ga2aa317fe5cea0989c273b3c69f69d795">xwlib_bclst_add_tail</a></div><div class="ttdeci">static void xwlib_bclst_add_tail(struct xwlib_bclst_node *head, struct xwlib_bclst_node *newn)</div><div class="ttdoc">将一个节点加入链表尾部（链表头的前面）</div><div class="ttdef"><b>Definition</b> <a href="bclst_8h_source.html#l00357">bclst.h:357</a></div></div>
<div class="ttc" id="agroup__xwos__lib__bclst_html_ga942be8d64e19cb8efb4dd1cf10e6e706"><div class="ttname"><a href="group__xwos__lib__bclst.html#ga942be8d64e19cb8efb4dd1cf10e6e706">xwlib_bclst_add_head</a></div><div class="ttdeci">static void xwlib_bclst_add_head(struct xwlib_bclst_node *head, struct xwlib_bclst_node *newn)</div><div class="ttdoc">将一个节点加入链表头部（链表头的后面）</div><div class="ttdef"><b>Definition</b> <a href="bclst_8h_source.html#l00345">bclst.h:345</a></div></div>
<div class="ttc" id="agroup__xwos__lib__bclst_html_gab12f3ce1a4e53de3112b10c9ffb06cae"><div class="ttname"><a href="group__xwos__lib__bclst.html#gab12f3ce1a4e53de3112b10c9ffb06cae">xwlib_bclst_del_init</a></div><div class="ttdeci">static void xwlib_bclst_del_init(struct xwlib_bclst_node *node)</div><div class="ttdoc">删除一个节点，并重新初始化它</div><div class="ttdef"><b>Definition</b> <a href="bclst_8h_source.html#l00391">bclst.h:391</a></div></div>
<div class="ttc" id="agroup__xwos__lib__lfq_html_gacbe43c237a9c7c6f21baa98daaf49e68"><div class="ttname"><a href="group__xwos__lib__lfq.html#gacbe43c237a9c7c6f21baa98daaf49e68">xwlib_lfq_pop</a></div><div class="ttdeci">static xwlfq_t * xwlib_lfq_pop(atomic_xwlfq_t *h)</div><div class="ttdoc">弹出无锁队列中的第一个节点（栈式队列）</div><div class="ttdef"><b>Definition</b> <a href="lfq_8h_source.html#l00053">lfq.h:53</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_ga862eb6a46e40b94681ec41a99f4fcb7e"><div class="ttname"><a href="group__xwos__lib__type.html#ga862eb6a46e40b94681ec41a99f4fcb7e">xwlfq_t</a></div><div class="ttdeci">xwptr_t xwlfq_t</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00591">type.h:591</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_gad21f70aa6f1364b63b1165784448bc16"><div class="ttname"><a href="group__xwos__lib__type.html#gad21f70aa6f1364b63b1165784448bc16">xwreg_t</a></div><div class="ttdeci">xwptr_t xwreg_t</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00409">type.h:409</a></div></div>
<div class="ttc" id="agroup__xwos__lib__xwaop_html_gae0b3f8bf7b0d30d78c73f24dbfde6273"><div class="ttname"><a href="group__xwos__lib__xwaop.html#gae0b3f8bf7b0d30d78c73f24dbfde6273">xwaop_sub</a></div><div class="ttdeci">#define xwaop_sub(type, a, v, nv, ov)</div><div class="ttdoc">对原子变量进行原子操作：读取－相减－回写</div><div class="ttdef"><b>Definition</b> <a href="xwaop_8h_source.html#l00598">xwaop.h:598</a></div></div>
<div class="ttc" id="agroup__xwos__lock__seqlock_html_gabc138d69277ba1017ade0f27c6c282cb"><div class="ttname"><a href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb">xwos_sqlk_wr_lock_cpuirqsv</a></div><div class="ttdeci">static void xwos_sqlk_wr_lock_cpuirqsv(struct xwos_sqlk *sql, xwreg_t *cpuirq)</div><div class="ttdoc">XWOS API：开启写临界区，保存本地CPU的中断标志并关闭</div><div class="ttdef"><b>Definition</b> <a href="lock_2seqlock_8h_source.html#l00575">seqlock.h:575</a></div></div>
<div class="ttc" id="agroup__xwos__lock__seqlock_html_gadcb38d5d6dad7969e1231c47c131f3c8"><div class="ttname"><a href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8">xwos_sqlk_wr_unlock_cpuirqrs</a></div><div class="ttdeci">static void xwos_sqlk_wr_unlock_cpuirqrs(struct xwos_sqlk *sql, xwreg_t cpuirq)</div><div class="ttdoc">XWOS API：关闭写临界区，恢复本地CPU的中断标志</div><div class="ttdef"><b>Definition</b> <a href="lock_2seqlock_8h_source.html#l00608">seqlock.h:608</a></div></div>
<div class="ttc" id="agroup__xwos__standard_html_ga1bab891fe9a97ea85286bc6e44a88c17"><div class="ttname"><a href="group__xwos__standard.html#ga1bab891fe9a97ea85286bc6e44a88c17">XWOS_BUG_ON</a></div><div class="ttdeci">#define XWOS_BUG_ON(x)</div><div class="ttdef"><b>Definition</b> <a href="xwos_2standard_8h_source.html#l00057">standard.h:57</a></div></div>
<div class="ttc" id="aobjcache_8c_html_a23e4915feeaf7a05d46ec2affe504642"><div class="ttname"><a href="objcache_8c.html#a23e4915feeaf7a05d46ec2affe504642">xwmm_mempool_objcache_page_get</a></div><div class="ttdeci">static xwer_t xwmm_mempool_objcache_page_get(struct xwmm_mempool_objcache *oc, struct xwmm_mempool_page **pgbuf)</div><div class="ttdoc">获取一页，准备从页内存中分配对象</div><div class="ttdef"><b>Definition</b> <a href="objcache_8c_source.html#l00225">objcache.c:225</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_a05d16698a1572d3ad039e4f3d8e4a5ee"><div class="ttname"><a href="structxwmm__mempool__objcache.html#a05d16698a1572d3ad039e4f3d8e4a5ee">xwmm_mempool_objcache::full</a></div><div class="ttdeci">struct xwlib_bclst_node full</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00055">objcache.h:55</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_a2a35a6f0e7edd3a011291ae539af6206"><div class="ttname"><a href="structxwmm__mempool__objcache.html#a2a35a6f0e7edd3a011291ae539af6206">xwmm_mempool_objcache::backup</a></div><div class="ttdeci">xwptr_t backup</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00042">objcache.h:42</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_a6d27d017089b61643a2248a048b26ef8"><div class="ttname"><a href="structxwmm__mempool__objcache.html#a6d27d017089b61643a2248a048b26ef8">xwmm_mempool_objcache::lock</a></div><div class="ttdeci">struct xwos_sqlk lock</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00058">objcache.h:58</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_aa90dcd466fd2d2df7008925e664d277d"><div class="ttname"><a href="structxwmm__mempool__objcache.html#aa90dcd466fd2d2df7008925e664d277d">xwmm_mempool_objcache::available</a></div><div class="ttdeci">struct xwlib_bclst_node available</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00056">objcache.h:56</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_abd4c454f4dd3f8389fd1ada1a2504d02"><div class="ttname"><a href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">xwmm_mempool_objcache::pg_objnr</a></div><div class="ttdeci">xwsz_t pg_objnr</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00041">objcache.h:41</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_aca5c7fbe77e4fc6836679fc6f4189c3d"><div class="ttname"><a href="structxwmm__mempool__objcache.html#aca5c7fbe77e4fc6836679fc6f4189c3d">xwmm_mempool_objcache::idleness</a></div><div class="ttdeci">atomic_xwsz_t idleness</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00051">objcache.h:51</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_af5710f3b100420dbdd54cfcb952877fc"><div class="ttname"><a href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">xwmm_mempool_objcache::page_list</a></div><div class="ttdeci">struct xwmm_mempool_objcache::@0 page_list</div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_a12866c4340feabc2fade6a9d5a7dbb16"><div class="ttname"><a href="structxwmm__mempool__page.html#a12866c4340feabc2fade6a9d5a7dbb16">xwmm_mempool_page::node</a></div><div class="ttdeci">struct xwlib_bclst_node node</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00051">page.h:51</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_a678e3535823e3eab676917331f622473"><div class="ttname"><a href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">xwmm_mempool_page::attr</a></div><div class="ttdeci">union xwmm_mempool_page::@1 attr</div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_aa87dbecfaa4f9c859311f560c5bfdf28"><div class="ttname"><a href="structxwmm__mempool__page.html#aa87dbecfaa4f9c859311f560c5bfdf28">xwmm_mempool_page::refcnt</a></div><div class="ttdeci">xwsq_t refcnt</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00053">page.h:53</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_ac3d78b8833f1da346fff3ead6ccc88ac"><div class="ttname"><a href="structxwmm__mempool__page.html#ac3d78b8833f1da346fff3ead6ccc88ac">xwmm_mempool_page::objhead</a></div><div class="ttdeci">atomic_xwlfq_t objhead</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00052">page.h:52</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_adc80ae7e64a16dfabb3c173ba80fcd5a"><div class="ttname"><a href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">xwmm_mempool_page::objcache</a></div><div class="ttdeci">struct xwmm_mempool_page::@1::@4 objcache</div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_ga86e445faf7ecf95130e042fa9b96a41b_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_ga86e445faf7ecf95130e042fa9b96a41b_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_ga86e445faf7ecf95130e042fa9b96a41b_cgraph" id="agroup__xwmm__mempool_ga86e445faf7ecf95130e042fa9b96a41b_cgraph">
<area shape="rect" title="XWMM API：从对象缓存中申请一个对象" alt="" coords="5,202,185,242"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga942be8d64e19cb8efb4dd1cf10e6e706" title="将一个节点加入链表头部（链表头的后面）" alt="" coords="248,9,399,35"/>
<area shape="poly" title=" " alt="" coords="106,200,154,128,190,86,232,50,255,38,258,42,235,55,194,90,158,131,110,203"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga2aa317fe5cea0989c273b3c69f69d795" title="将一个节点加入链表尾部（链表头的前面）" alt="" coords="254,65,393,91"/>
<area shape="poly" title=" " alt="" coords="120,200,171,161,232,120,280,94,282,99,235,124,174,165,123,204"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab12f3ce1a4e53de3112b10c9ffb06cae" title="删除一个节点，并重新初始化它" alt="" coords="498,55,633,80"/>
<area shape="poly" title=" " alt="" coords="146,199,287,146,461,89,491,81,492,86,462,94,288,152,148,204"/>
<area shape="rect" href="group__xwos__lib__lfq.html#gacbe43c237a9c7c6f21baa98daaf49e68" title="弹出无锁队列中的第一个节点（栈式队列）" alt="" coords="273,497,374,523"/>
<area shape="poly" title=" " alt="" coords="105,241,120,289,146,352,184,418,208,449,235,476,261,492,258,496,232,480,204,452,180,421,141,354,115,291,99,243"/>
<area shape="rect" href="objcache_8c.html#a23e4915feeaf7a05d46ec2affe504642" title="获取一页，准备从页内存中分配对象" alt="" coords="233,202,413,242"/>
<area shape="poly" title=" " alt="" coords="186,219,220,219,220,225,186,225"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb" title="XWOS API：开启写临界区，保存本地CPU的中断标志并关闭" alt="" coords="1284,173,1476,199"/>
<area shape="poly" title=" " alt="" coords="171,239,234,251,434,276,591,287,748,284,949,267,1051,254,1151,236,1316,199,1318,205,1152,241,1051,259,950,273,748,289,591,292,434,281,233,257,170,245"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8" title="XWOS API：关闭写临界区，恢复本地CPU的中断标志" alt="" coords="1305,490,1455,530"/>
<area shape="poly" title=" " alt="" coords="120,240,189,298,238,334,294,370,357,403,423,431,493,450,564,457,835,457,959,460,1084,470,1292,494,1291,499,1083,475,959,466,835,462,564,462,492,455,422,436,354,408,292,375,235,338,186,302,116,244"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga42c09bc0da5cac8327003314056f43b7" title="将一个新节点加入到prev与next之间" alt="" coords="480,5,651,31"/>
<area shape="poly" title=" " alt="" coords="399,18,466,17,466,22,399,23"/>
<area shape="poly" title=" " alt="" coords="371,63,461,39,495,31,496,36,462,45,373,68"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab7918962f86f86d5c7049922a5173e81" title="删除prev节点与next节点之间的节点" alt="" coords="750,33,917,59"/>
<area shape="poly" title=" " alt="" coords="633,59,736,51,737,56,633,65"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga3286c94ae92265dea90fd52bfdb85569" title="初始化一个链表节点。" alt="" coords="760,83,907,108"/>
<area shape="poly" title=" " alt="" coords="633,72,747,84,746,89,633,77"/>
<area shape="poly" title=" " alt="" coords="357,200,385,180,411,158,425,139,433,122,442,105,460,89,483,77,486,82,463,94,447,109,438,124,430,142,415,161,388,185,360,204"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga54d0d6c4a04b8f3c80891f7d0f5a1e62" title="测试链表是否为空。" alt="" coords="489,104,641,129"/>
<area shape="poly" title=" " alt="" coords="357,199,405,173,460,146,502,131,504,136,462,151,407,177,359,204"/>
<area shape="rect" href="objcache_8c.html#a75c1bbc6602c82f1cc906c65303ee59d" title="初始化新页" alt="" coords="475,205,655,245"/>
<area shape="poly" title=" " alt="" coords="413,220,462,221,462,226,413,226"/>
<area shape="rect" href="group__xwmm__mempool.html#ga7cbe7d0a7d7052c887dc7723c5010ec1" title="XWMM API：申请一页内存" alt="" coords="461,335,669,360"/>
<area shape="poly" title=" " alt="" coords="364,240,529,326,526,330,362,244"/>
<area shape="poly" title=" " alt="" coords="409,199,461,190,572,177,685,168,910,162,1112,166,1270,174,1270,180,1111,171,910,167,686,173,572,182,462,195,410,205"/>
<area shape="poly" title=" " alt="" coords="339,241,388,306,422,341,463,370,515,397,569,421,682,459,799,486,914,503,1025,513,1128,517,1291,514,1291,519,1127,522,1025,518,914,508,798,491,681,464,567,426,512,402,460,375,419,345,384,310,335,244"/>
<area shape="poly" title=" " alt="" coords="607,202,792,112,795,117,609,207"/>
<area shape="rect" href="group__xwos__lib__lfq.html#gac87b1137608605a80577abed410ddc1a" title="初始化无锁队列节点" alt="" coords="785,184,882,209"/>
<area shape="poly" title=" " alt="" coords="655,213,770,200,771,206,656,218"/>
<area shape="rect" href="group__xwos__lib__lfq.html#ga1cac1b49ec185ccb135f19401e286166" title="将一个节点推入无锁队列（栈式队列）" alt="" coords="779,233,887,259"/>
<area shape="poly" title=" " alt="" coords="656,229,766,238,765,243,655,234"/>
<area shape="rect" href="page_8c.html#a6385524c294a6af40c2ea0ff315d60fd" title="将大的页拆分成小的页" alt="" coords="717,335,949,360"/>
<area shape="poly" title=" " alt="" coords="670,345,704,345,704,350,670,350"/>
<area shape="rect" href="page_8c.html#ab54f23d0058e1bff33377fc2d7b0a48c" title="从阶红黑树中选择一页" alt="" coords="1011,382,1222,422"/>
<area shape="poly" title=" " alt="" coords="634,357,718,370,863,384,998,394,997,399,863,390,717,375,634,363"/>
<area shape="rect" href="page_8c.html#adc418491ba0dd770fa96b845e96722d9" title="增加页到阶红黑树中" alt="" coords="997,332,1236,357"/>
<area shape="poly" title=" " alt="" coords="950,344,983,343,983,349,950,349"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa09f90f7792b00240a3cecef84946d88" title="插入一个红色节点后修正红黑树的颜色" alt="" coords="1315,325,1445,365"/>
<area shape="poly" title=" " alt="" coords="1236,342,1301,342,1301,347,1236,347"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaef7f6608cd37a0fb765adb003428ec38" title="链接节点，并设置位置及颜色信息" alt="" coords="1557,156,1675,181"/>
<area shape="poly" title=" " alt="" coords="1189,329,1235,310,1249,298,1258,286,1267,273,1283,260,1333,236,1376,226,1421,220,1475,207,1523,190,1550,182,1551,187,1525,195,1477,213,1422,226,1377,232,1335,241,1285,264,1271,276,1262,289,1253,302,1237,315,1191,334"/>
<area shape="poly" title=" " alt="" coords="1199,330,1234,311,1252,288,1258,265,1264,240,1282,216,1304,202,1307,206,1286,220,1269,243,1263,266,1256,291,1238,315,1202,334"/>
<area shape="poly" title=" " alt="" coords="1209,355,1237,368,1254,381,1264,395,1286,426,1345,479,1342,483,1282,429,1260,398,1250,385,1235,372,1207,360"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga3d27937625dc93286c012da5e82945b8" title="反转节点的颜色" alt="" coords="1541,353,1691,379"/>
<area shape="poly" title=" " alt="" coords="1446,348,1527,355,1527,361,1445,353"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga8e9025d3e8bade2a627001fb58251047" title="返回节点的父节点指针" alt="" coords="1536,403,1696,428"/>
<area shape="poly" title=" " alt="" coords="1441,362,1525,389,1552,397,1551,402,1523,394,1439,367"/>
<area shape="poly" title=" " alt="" coords="1223,418,1284,425,1380,428,1476,425,1522,422,1523,427,1476,430,1380,434,1284,430,1222,423"/>
<area shape="poly" title=" " alt="" coords="1217,380,1234,368,1253,343,1260,318,1266,291,1282,260,1312,229,1345,204,1348,208,1316,233,1286,264,1271,293,1266,319,1258,346,1238,372,1220,384"/>
<area shape="poly" title=" " alt="" coords="1190,420,1237,438,1262,453,1285,469,1313,482,1311,487,1283,474,1259,458,1235,443,1188,425"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7" title="初始化红黑树节点" alt="" coords="1305,389,1455,415"/>
<area shape="poly" title=" " alt="" coords="1222,399,1291,399,1291,405,1222,405"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gac57fdaeef6a9dc2ee2bedbf5ac885f96" title="删除一个节点，并修正红黑树的颜色" alt="" coords="1309,275,1451,300"/>
<area shape="poly" title=" " alt="" coords="1212,380,1234,368,1249,354,1258,340,1267,325,1282,310,1297,303,1299,307,1286,315,1271,328,1262,343,1253,358,1238,372,1214,384"/>
<area shape="poly" title=" " alt="" coords="1440,298,1477,310,1501,324,1525,338,1548,347,1546,352,1523,343,1499,329,1475,315,1438,303"/>
<area shape="poly" title=" " alt="" coords="1453,297,1478,311,1495,331,1502,351,1510,371,1526,389,1533,394,1530,399,1522,393,1505,374,1497,353,1490,333,1474,315,1450,302"/>
<area shape="poly" title=" " alt="" coords="1436,272,1474,253,1489,238,1497,222,1506,206,1522,190,1543,180,1545,185,1526,195,1510,209,1502,225,1494,241,1478,257,1438,277"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga2502fed0a895591911885bd8725de911" title="返回节点的后继节点" alt="" coords="1524,304,1708,329"/>
<area shape="poly" title=" " alt="" coords="1452,293,1511,301,1510,306,1451,299"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga692ff81d9c30fac79a823c5c2ff2357d" title="将节点设置为黑色" alt="" coords="1539,205,1693,231"/>
<area shape="poly" title=" " alt="" coords="1419,272,1523,239,1551,232,1552,237,1525,245,1421,277"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga7b281445f2079f235077400ee79f15ea" title="用新节点代替旧节点并继承它的链指针、颜色和位置信息， 但新节点并不接管旧节点的子节点" alt="" coords="1538,255,1694,280"/>
<area shape="poly" title=" " alt="" coords="1451,279,1524,272,1525,278,1452,284"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_ga86e445faf7ecf95130e042fa9b96a41b_icgraph.png" border="0" usemap="#agroup__xwmm__mempool_ga86e445faf7ecf95130e042fa9b96a41b_icgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_ga86e445faf7ecf95130e042fa9b96a41b_icgraph" id="agroup__xwmm__mempool_ga86e445faf7ecf95130e042fa9b96a41b_icgraph">
<area shape="rect" title="XWMM API：从对象缓存中申请一个对象" alt="" coords="909,5,1089,45"/>
<area shape="rect" href="objcache_8c.html#a27d6631115c7033bfb49d22d5d3d992d" title="i_allocator接口函数：申请内存" alt="" coords="681,5,861,45"/>
<area shape="poly" title=" " alt="" coords="895,28,861,28,861,23,895,23"/>
<area shape="rect" href="group__xwmm__mempool.html#ga15d8fc6d72d2ef920927bd6702174c3a" title="XWMM API：初始化对象缓存" alt="" coords="429,13,633,38"/>
<area shape="poly" title=" " alt="" coords="668,28,634,28,634,23,668,23"/>
<area shape="rect" href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d" title="构建内存池" alt="" coords="199,13,381,38"/>
<area shape="poly" title=" " alt="" coords="416,28,382,28,382,23,416,23"/>
<area shape="rect" href="group__xwmm__mempool.html#gaad8340a12043c383e489a786788e89af" title="XWMM API：初始化内存池" alt="" coords="5,13,151,38"/>
<area shape="poly" title=" " alt="" coords="184,28,151,28,151,23,184,23"/>
</map>
</div>

</div>
</div>
<a id="gae7d39e7ba00cc3926284e6ba8775121b" name="gae7d39e7ba00cc3926284e6ba8775121b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae7d39e7ba00cc3926284e6ba8775121b">&#9670;&#160;</a></span>xwmm_mempool_objcache_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_objcache_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *&#160;</td>
          <td class="paramname"><em>oc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：释放对象到对象缓存中 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">oc</td><td>对象缓存的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">obj</td><td>对象的指针 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-ERANGE</td><td>内存地址不在内存池的范围内 </td></tr>
  </table>
  </dd>
</dl>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="objcache_8c_source.html">objcache.c</a> 第 <a class="el" href="objcache_8c_source.html#l00299">299</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  300</span>{</div>
<div class="line"><span class="lineno">  301</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2225ca1f29b430d7c231a07487f1cc06">atomic_xwlfq_t</a> * lfq;</div>
<div class="line"><span class="lineno">  302</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> * pg;</div>
<div class="line"><span class="lineno">  303</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> reserved;</div>
<div class="line"><span class="lineno">  304</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> idleness;</div>
<div class="line"><span class="lineno">  305</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a> offset;</div>
<div class="line"><span class="lineno">  306</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a> origin;</div>
<div class="line"><span class="lineno">  307</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>        rc = <a class="code hl_function" href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967">xwmm_mempool_page_find</a>(oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a053bc33ff6399770874b14c65bdb5390">pa</a>, obj, &amp;pg);</div>
<div class="line"><span class="lineno">  310</span>        <span class="keywordflow">if</span> (rc &lt; 0) {</div>
<div class="line"><span class="lineno">  311</span>                <span class="keywordflow">goto</span> err_pg_find;</div>
<div class="line"><span class="lineno">  312</span>        }</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>        offset = ((<a class="code hl_typedef" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a>)obj - pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a86aa875179e54032edc2152789309c19">mapping</a>) % oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a05389bc2c128416b3fa0b43671168b40">objsize</a>;</div>
<div class="line"><span class="lineno">  315</span>        origin = (<a class="code hl_typedef" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a>)obj - offset;</div>
<div class="line"><span class="lineno">  316</span>        obj = (<span class="keywordtype">void</span> *)origin;</div>
<div class="line"><span class="lineno">  317</span> </div>
<div class="line"><span class="lineno">  318</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> != oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a15ae123a3f28aeb8f2786e235f17beff">dtor</a>) {</div>
<div class="line"><span class="lineno">  319</span>                oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a15ae123a3f28aeb8f2786e235f17beff">dtor</a>(obj);</div>
<div class="line"><span class="lineno">  320</span>        }</div>
<div class="line"><span class="lineno">  321</span> </div>
<div class="line"><span class="lineno">  322</span>        lfq = (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2225ca1f29b430d7c231a07487f1cc06">atomic_xwlfq_t</a> *)obj;</div>
<div class="line"><span class="lineno">  323</span>        <a class="code hl_function" href="group__xwos__lib__lfq.html#ga1cac1b49ec185ccb135f19401e286166">xwlib_lfq_push</a>(&amp;pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">objcache</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#ac3d78b8833f1da346fff3ead6ccc88ac">objhead</a>, lfq);</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>        <a class="code hl_function" href="objcache_8c.html#a6523b89f414d275f4c4548a684b21092">xwmm_mempool_objcache_page_put</a>(oc, pg);</div>
<div class="line"><span class="lineno">  326</span>        <a class="code hl_define" href="group__xwos__lib__xwaop.html#gadd1ff1c64048de270aac44c35a8519e7">xwaop_add</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, &amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#aca5c7fbe77e4fc6836679fc6f4189c3d">idleness</a>, 1, &amp;idleness, <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">  327</span>        reserved = <a class="code hl_define" href="group__xwos__lib__xwaop.html#ga9a53ba42b71093821567101c3ebcbe77">xwaop_load</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, &amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#ac54752393665135700c995010d23a6be">reserved</a>, <a class="code hl_enumvalue" href="group__xwos__lib__type.html#gga33d957600264a16ede92db2e6e42f830acdb5a6e088c69ee770c24d3612d12adc">xwaop_mo_relaxed</a>);</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>        <span class="keywordflow">if</span> ((reserved + oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a>) &lt;= idleness) {</div>
<div class="line"><span class="lineno">  330</span>                <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> nr;</div>
<div class="line"><span class="lineno">  331</span> </div>
<div class="line"><span class="lineno">  332</span>                nr = (idleness - reserved) / oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a>;</div>
<div class="line"><span class="lineno">  333</span>                <span class="comment">// cppcheck-suppress [misra-c2012-17.7]</span></div>
<div class="line"><span class="lineno">  334</span>                <a class="code hl_function" href="objcache_8c.html#a21221e21cca4abbdfc36138c1cecb3f5">xwmm_mempool_objcache_free_idle_page</a>(oc, nr);</div>
<div class="line"><span class="lineno">  335</span>        }</div>
<div class="line"><span class="lineno">  336</span> </div>
<div class="line"><span class="lineno">  337</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>err_pg_find:</div>
<div class="line"><span class="lineno">  340</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  341</span>}</div>
<div class="ttc" id="agroup__xwos__lib__lfq_html_ga1cac1b49ec185ccb135f19401e286166"><div class="ttname"><a href="group__xwos__lib__lfq.html#ga1cac1b49ec185ccb135f19401e286166">xwlib_lfq_push</a></div><div class="ttdeci">static void xwlib_lfq_push(atomic_xwlfq_t *h, atomic_xwlfq_t *n)</div><div class="ttdoc">将一个节点推入无锁队列（栈式队列）</div><div class="ttdef"><b>Definition</b> <a href="lfq_8h_source.html#l00042">lfq.h:42</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_ga2225ca1f29b430d7c231a07487f1cc06"><div class="ttname"><a href="group__xwos__lib__type.html#ga2225ca1f29b430d7c231a07487f1cc06">atomic_xwlfq_t</a></div><div class="ttdeci">__xwcc_atomic xwlfq_t atomic_xwlfq_t</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00594">type.h:594</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_gga33d957600264a16ede92db2e6e42f830acdb5a6e088c69ee770c24d3612d12adc"><div class="ttname"><a href="group__xwos__lib__type.html#gga33d957600264a16ede92db2e6e42f830acdb5a6e088c69ee770c24d3612d12adc">xwaop_mo_relaxed</a></div><div class="ttdeci">@ xwaop_mo_relaxed</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00628">type.h:628</a></div></div>
<div class="ttc" id="agroup__xwos__lib__xwaop_html_ga9a53ba42b71093821567101c3ebcbe77"><div class="ttname"><a href="group__xwos__lib__xwaop.html#ga9a53ba42b71093821567101c3ebcbe77">xwaop_load</a></div><div class="ttdeci">#define xwaop_load(type, a, memorder)</div><div class="ttdoc">对原子变量进行原子操作：加载</div><div class="ttdef"><b>Definition</b> <a href="xwaop_8h_source.html#l00045">xwaop.h:45</a></div></div>
<div class="ttc" id="agroup__xwos__lib__xwaop_html_gadd1ff1c64048de270aac44c35a8519e7"><div class="ttname"><a href="group__xwos__lib__xwaop.html#gadd1ff1c64048de270aac44c35a8519e7">xwaop_add</a></div><div class="ttdeci">#define xwaop_add(type, a, v, nv, ov)</div><div class="ttdoc">对原子变量进行原子操作：读取－相加－回写</div><div class="ttdef"><b>Definition</b> <a href="xwaop_8h_source.html#l00330">xwaop.h:330</a></div></div>
<div class="ttc" id="aobjcache_8c_html_a21221e21cca4abbdfc36138c1cecb3f5"><div class="ttname"><a href="objcache_8c.html#a21221e21cca4abbdfc36138c1cecb3f5">xwmm_mempool_objcache_free_idle_page</a></div><div class="ttdeci">static xwsz_t xwmm_mempool_objcache_free_idle_page(struct xwmm_mempool_objcache *oc, xwsz_t nr)</div><div class="ttdoc">释放空闲页</div><div class="ttdef"><b>Definition</b> <a href="objcache_8c_source.html#l00160">objcache.c:160</a></div></div>
<div class="ttc" id="aobjcache_8c_html_a6523b89f414d275f4c4548a684b21092"><div class="ttname"><a href="objcache_8c.html#a6523b89f414d275f4c4548a684b21092">xwmm_mempool_objcache_page_put</a></div><div class="ttdeci">static void xwmm_mempool_objcache_page_put(struct xwmm_mempool_objcache *oc, struct xwmm_mempool_page *pg)</div><div class="ttdoc">减少页的引用计数</div><div class="ttdef"><b>Definition</b> <a href="objcache_8c_source.html#l00197">objcache.c:197</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_a05389bc2c128416b3fa0b43671168b40"><div class="ttname"><a href="structxwmm__mempool__objcache.html#a05389bc2c128416b3fa0b43671168b40">xwmm_mempool_objcache::objsize</a></div><div class="ttdeci">xwsz_t objsize</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00038">objcache.h:38</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_a053bc33ff6399770874b14c65bdb5390"><div class="ttname"><a href="structxwmm__mempool__objcache.html#a053bc33ff6399770874b14c65bdb5390">xwmm_mempool_objcache::pa</a></div><div class="ttdeci">struct xwmm_mempool_page_allocator * pa</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00036">objcache.h:36</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_a15ae123a3f28aeb8f2786e235f17beff"><div class="ttname"><a href="structxwmm__mempool__objcache.html#a15ae123a3f28aeb8f2786e235f17beff">xwmm_mempool_objcache::dtor</a></div><div class="ttdeci">dtor_f dtor</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00049">objcache.h:49</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_ac54752393665135700c995010d23a6be"><div class="ttname"><a href="structxwmm__mempool__objcache.html#ac54752393665135700c995010d23a6be">xwmm_mempool_objcache::reserved</a></div><div class="ttdeci">atomic_xwsz_t reserved</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00052">objcache.h:52</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_a86aa875179e54032edc2152789309c19"><div class="ttname"><a href="structxwmm__mempool__page.html#a86aa875179e54032edc2152789309c19">xwmm_mempool_page::mapping</a></div><div class="ttdeci">xwptr_t mapping</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00040">page.h:40</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gae7d39e7ba00cc3926284e6ba8775121b_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_gae7d39e7ba00cc3926284e6ba8775121b_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gae7d39e7ba00cc3926284e6ba8775121b_cgraph" id="agroup__xwmm__mempool_gae7d39e7ba00cc3926284e6ba8775121b_cgraph">
<area shape="rect" title="XWMM API：释放对象到对象缓存中" alt="" coords="5,329,215,355"/>
<area shape="rect" href="group__xwos__lib__lfq.html#ga1cac1b49ec185ccb135f19401e286166" title="将一个节点推入无锁队列（栈式队列）" alt="" coords="301,196,409,221"/>
<area shape="poly" title=" " alt="" coords="124,327,182,281,220,255,262,232,286,222,288,227,264,236,223,259,185,285,127,331"/>
<area shape="rect" href="objcache_8c.html#a21221e21cca4abbdfc36138c1cecb3f5" title="释放空闲页" alt="" coords="265,246,445,286"/>
<area shape="poly" title=" " alt="" coords="151,327,276,288,277,293,153,332"/>
<area shape="rect" href="objcache_8c.html#a6523b89f414d275f4c4548a684b21092" title="减少页的引用计数" alt="" coords="265,397,445,437"/>
<area shape="poly" title=" " alt="" coords="154,352,276,390,274,395,152,357"/>
<area shape="rect" href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967" title="依据内存地址查找页" alt="" coords="263,508,447,533"/>
<area shape="poly" title=" " alt="" coords="130,353,327,498,323,502,127,357"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab12f3ce1a4e53de3112b10c9ffb06cae" title="删除一个节点，并重新初始化它" alt="" coords="533,328,667,353"/>
<area shape="poly" title=" " alt="" coords="422,283,545,321,544,327,420,289"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga54d0d6c4a04b8f3c80891f7d0f5a1e62" title="测试链表是否为空。" alt="" coords="524,153,676,179"/>
<area shape="poly" title=" " alt="" coords="419,244,445,230,459,220,468,209,478,198,493,188,510,180,512,185,496,192,482,202,472,213,463,224,448,235,421,248"/>
<area shape="rect" href="group__xwmm__mempool.html#ga52f11e08dc37a0cc72717169b6ae4131" title="XWMM API：释放一页内存" alt="" coords="507,203,693,228"/>
<area shape="poly" title=" " alt="" coords="444,245,524,228,525,233,446,250"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb" title="XWOS API：开启写临界区，保存本地CPU的中断标志并关闭" alt="" coords="1300,359,1492,384"/>
<area shape="poly" title=" " alt="" coords="445,259,575,255,726,256,867,265,924,275,967,289,983,302,992,317,1000,331,1015,342,1081,367,1152,379,1222,384,1286,382,1286,387,1222,389,1152,385,1080,372,1012,347,996,334,987,319,979,305,964,294,923,280,866,271,726,261,575,260,445,264"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8" title="XWOS API：关闭写临界区，恢复本地CPU的中断标志" alt="" coords="1321,179,1471,219"/>
<area shape="poly" title=" " alt="" coords="426,244,445,231,455,219,461,208,466,184,473,160,481,148,493,138,523,125,560,115,650,104,759,105,877,113,999,127,1116,144,1308,179,1307,184,1115,149,998,132,877,118,758,110,651,110,561,120,525,130,496,143,485,152,478,162,471,185,466,210,459,222,448,235,429,248"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab7918962f86f86d5c7049922a5173e81" title="删除prev节点与next节点之间的节点" alt="" coords="776,353,943,379"/>
<area shape="poly" title=" " alt="" coords="668,345,763,354,762,359,667,350"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga3286c94ae92265dea90fd52bfdb85569" title="初始化一个链表节点。" alt="" coords="786,304,933,329"/>
<area shape="poly" title=" " alt="" coords="667,332,772,322,773,327,668,337"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7" title="初始化红黑树节点" alt="" coords="1321,29,1471,55"/>
<area shape="poly" title=" " alt="" coords="675,200,704,188,718,176,727,164,737,151,752,138,821,103,895,77,971,57,1047,44,1120,36,1190,32,1307,33,1307,38,1190,38,1121,41,1047,49,972,62,896,82,823,108,755,143,740,155,732,167,722,180,707,192,677,205"/>
<area shape="rect" href="page_8c.html#a8e9302d65eea335934b13f63caea64aa" title="合并空闲的伙伴页" alt="" coords="753,153,965,179"/>
<area shape="poly" title=" " alt="" coords="667,200,778,179,779,184,668,205"/>
<area shape="rect" href="page_8c.html#aeea41b96161d6bab8ed17f9df7dbb2f9" title="获取页的序列值" alt="" coords="755,203,964,228"/>
<area shape="poly" title=" " alt="" coords="693,213,741,213,741,218,693,218"/>
<area shape="rect" href="page_8c.html#aecba66f62c5f653b61e4dd01d92bcc6c" title="找到页的伙伴页" alt="" coords="1042,193,1223,233"/>
<area shape="poly" title=" " alt="" coords="935,176,1029,192,1028,198,934,181"/>
<area shape="rect" href="page_8c.html#adc418491ba0dd770fa96b845e96722d9" title="增加页到阶红黑树中" alt="" coords="1013,308,1252,333"/>
<area shape="poly" title=" " alt="" coords="942,176,967,188,983,201,993,214,1002,228,1015,243,1057,274,1097,299,1094,304,1053,278,1012,247,997,231,988,217,979,204,964,192,939,181"/>
<area shape="rect" href="page_8c.html#a0803eb38a9059618cf4c98136dc70033" title="从阶红黑树中删除页" alt="" coords="1027,78,1238,118"/>
<area shape="poly" title=" " alt="" coords="911,151,1038,119,1039,124,912,156"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa09f90f7792b00240a3cecef84946d88" title="插入一个红色节点后修正红黑树的颜色" alt="" coords="1331,243,1461,283"/>
<area shape="poly" title=" " alt="" coords="1191,305,1317,278,1318,283,1192,311"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaef7f6608cd37a0fb765adb003428ec38" title="链接节点，并设置位置及颜色信息" alt="" coords="1573,268,1691,293"/>
<area shape="poly" title=" " alt="" coords="1252,311,1492,293,1558,286,1559,291,1492,298,1252,316"/>
<area shape="poly" title=" " alt="" coords="1200,331,1316,353,1315,359,1199,336"/>
<area shape="poly" title=" " alt="" coords="1207,306,1251,286,1265,273,1274,259,1283,244,1298,229,1308,223,1311,228,1302,233,1287,247,1278,262,1270,276,1253,291,1209,310"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga3d27937625dc93286c012da5e82945b8" title="反转节点的颜色" alt="" coords="1557,153,1707,179"/>
<area shape="poly" title=" " alt="" coords="1460,243,1491,229,1505,219,1514,209,1524,198,1539,188,1554,181,1556,186,1541,192,1527,202,1518,212,1508,223,1493,234,1463,248"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga8e9025d3e8bade2a627001fb58251047" title="返回节点的父节点指针" alt="" coords="1552,203,1712,228"/>
<area shape="poly" title=" " alt="" coords="1461,247,1555,228,1556,233,1462,253"/>
<area shape="poly" title=" " alt="" coords="1227,75,1322,55,1323,60,1228,81"/>
<area shape="poly" title=" " alt="" coords="1239,109,1362,130,1493,165,1517,176,1541,188,1567,196,1566,201,1539,192,1515,181,1491,170,1360,136,1238,114"/>
<area shape="poly" title=" " alt="" coords="1175,116,1216,143,1254,179,1272,210,1279,237,1286,264,1302,294,1332,325,1364,349,1360,353,1328,329,1298,297,1281,266,1274,238,1267,212,1250,182,1213,147,1172,121"/>
<area shape="poly" title=" " alt="" coords="1202,116,1253,134,1301,158,1332,172,1330,176,1299,163,1251,139,1200,121"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gac57fdaeef6a9dc2ee2bedbf5ac885f96" title="删除一个节点，并修正红黑树的颜色" alt="" coords="1325,79,1467,104"/>
<area shape="poly" title=" " alt="" coords="1238,93,1311,91,1311,96,1238,98"/>
<area shape="poly" title=" " alt="" coords="1436,102,1493,121,1541,138,1570,147,1569,152,1539,143,1491,126,1435,107"/>
<area shape="poly" title=" " alt="" coords="1455,102,1494,121,1510,138,1518,156,1526,172,1542,188,1553,195,1551,199,1538,192,1522,175,1513,158,1505,141,1490,125,1453,106"/>
<area shape="poly" title=" " alt="" coords="1418,102,1455,129,1494,166,1509,186,1517,203,1526,220,1542,237,1579,260,1577,265,1538,241,1522,223,1512,206,1504,188,1490,169,1451,134,1415,106"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga2502fed0a895591911885bd8725de911" title="返回节点的后继节点" alt="" coords="1540,5,1724,31"/>
<area shape="poly" title=" " alt="" coords="1452,76,1491,64,1539,40,1562,32,1563,37,1541,44,1493,68,1453,81"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga692ff81d9c30fac79a823c5c2ff2357d" title="将节点设置为黑色" alt="" coords="1555,55,1709,80"/>
<area shape="poly" title=" " alt="" coords="1467,81,1541,74,1541,79,1468,87"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga7b281445f2079f235077400ee79f15ea" title="用新节点代替旧节点并继承它的链指针、颜色和位置信息， 但新节点并不接管旧节点的子节点" alt="" coords="1554,104,1710,129"/>
<area shape="poly" title=" " alt="" coords="1468,96,1541,104,1540,110,1467,102"/>
<area shape="poly" title=" " alt="" coords="420,394,544,355,546,360,421,399"/>
<area shape="poly" title=" " alt="" coords="445,428,495,433,627,441,730,444,833,441,965,433,1155,411,1316,384,1317,389,1156,416,966,438,833,446,730,449,627,446,494,438,445,433"/>
<area shape="poly" title=" " alt="" coords="445,421,577,427,729,428,803,424,869,417,924,405,964,388,975,378,982,367,988,343,993,318,1000,305,1012,293,1043,273,1071,261,1099,255,1125,253,1182,252,1215,249,1251,242,1322,221,1324,226,1253,247,1216,255,1183,258,1126,258,1099,260,1073,266,1045,278,1015,297,1004,308,998,320,993,344,987,369,979,382,967,392,926,410,870,422,803,429,729,433,577,433,445,426"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga942be8d64e19cb8efb4dd1cf10e6e706" title="将一个节点加入链表头部（链表头的后面）" alt="" coords="525,505,675,531"/>
<area shape="poly" title=" " alt="" coords="393,434,496,484,539,499,538,504,494,488,391,439"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga42c09bc0da5cac8327003314056f43b7" title="将一个新节点加入到prev与next之间" alt="" coords="774,505,945,531"/>
<area shape="poly" title=" " alt="" coords="676,515,760,515,760,521,676,521"/>
<area shape="rect" href="page_8c.html#a601e0e3ff8fc5ad5b7348046b545062e" title="从页内存地址获得其页控制块的指针" alt="" coords="495,555,705,580"/>
<area shape="poly" title=" " alt="" coords="423,531,520,549,519,555,422,536"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gae7d39e7ba00cc3926284e6ba8775121b_icgraph.png" border="0" usemap="#agroup__xwmm__mempool_gae7d39e7ba00cc3926284e6ba8775121b_icgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gae7d39e7ba00cc3926284e6ba8775121b_icgraph" id="agroup__xwmm__mempool_gae7d39e7ba00cc3926284e6ba8775121b_icgraph">
<area shape="rect" title="XWMM API：释放对象到对象缓存中" alt="" coords="909,13,1119,38"/>
<area shape="rect" href="objcache_8c.html#a7214f0b448c3680b68f84d3bb6d7155a" title="i_allocator接口函数：释放内存" alt="" coords="681,5,861,45"/>
<area shape="poly" title=" " alt="" coords="896,28,862,28,862,23,896,23"/>
<area shape="rect" href="group__xwmm__mempool.html#ga15d8fc6d72d2ef920927bd6702174c3a" title="XWMM API：初始化对象缓存" alt="" coords="429,13,633,38"/>
<area shape="poly" title=" " alt="" coords="668,28,634,28,634,23,668,23"/>
<area shape="rect" href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d" title="构建内存池" alt="" coords="199,13,381,38"/>
<area shape="poly" title=" " alt="" coords="416,28,382,28,382,23,416,23"/>
<area shape="rect" href="group__xwmm__mempool.html#gaad8340a12043c383e489a786788e89af" title="XWMM API：初始化内存池" alt="" coords="5,13,151,38"/>
<area shape="poly" title=" " alt="" coords="184,28,151,28,151,23,184,23"/>
</map>
</div>

</div>
</div>
<a id="gab664530444050735173f9bc44c32ab14" name="gab664530444050735173f9bc44c32ab14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab664530444050735173f9bc44c32ab14">&#9670;&#160;</a></span>xwmm_mempool_objcache_get_capacity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_objcache_get_capacity </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *&#160;</td>
          <td class="paramname"><em>oc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> *&#160;</td>
          <td class="paramname"><em>capacity</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：获取对象缓存的容量 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">oc</td><td>对象缓存的指针 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">capacity</td><td>指向缓冲区的指针，通过此缓冲区返回对象缓存的容量 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
  </table>
  </dd>
</dl>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="objcache_8c_source.html">objcache.c</a> 第 <a class="el" href="objcache_8c_source.html#l00383">383</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  385</span>{</div>
<div class="line"><span class="lineno">  386</span>        *capacity = <a class="code hl_define" href="group__xwos__lib__xwaop.html#ga9a53ba42b71093821567101c3ebcbe77">xwaop_load</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, &amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#afc8c3ae5d542f2a700f5b2ac17aed6d2">capacity</a>, <a class="code hl_enumvalue" href="group__xwos__lib__type.html#gga33d957600264a16ede92db2e6e42f830acdb5a6e088c69ee770c24d3612d12adc">xwaop_mo_relaxed</a>);</div>
<div class="line"><span class="lineno">  387</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  388</span>}</div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_afc8c3ae5d542f2a700f5b2ac17aed6d2"><div class="ttname"><a href="structxwmm__mempool__objcache.html#afc8c3ae5d542f2a700f5b2ac17aed6d2">xwmm_mempool_objcache::capacity</a></div><div class="ttdeci">atomic_xwsz_t capacity</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00050">objcache.h:50</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga15d8fc6d72d2ef920927bd6702174c3a" name="ga15d8fc6d72d2ef920927bd6702174c3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga15d8fc6d72d2ef920927bd6702174c3a">&#9670;&#160;</a></span>xwmm_mempool_objcache_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_objcache_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *&#160;</td>
          <td class="paramname"><em>oc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>objsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>alignment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga59fe68c80516b22de8dccb84275d23f2">xwsq_t</a>&#160;</td>
          <td class="paramname"><em>pg_order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#gaf7d6db44108764f9cbaea53c923d2736">ctor_f</a>&#160;</td>
          <td class="paramname"><em>ctor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#gafe80dfa42b558589ad7ebce2bea43946">dtor_f</a>&#160;</td>
          <td class="paramname"><em>dtor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：初始化对象缓存 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">oc</td><td>对象缓存的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pa</td><td>页分配器的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>名字 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">objsize</td><td>对象的大小 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">alignment</td><td>对齐的大小 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pg_order</td><td>每次预先申请页的数量的阶，几阶就是2的几次方 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ctor</td><td>构造函数 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dtor</td><td>析构函数 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-EALIGN</td><td>内存区域没有对齐 </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; 内存管理对齐的字节数</p>
<p>&lt; 内存管理对齐的字节数</p>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="objcache_8c_source.html">objcache.c</a> 第 <a class="el" href="objcache_8c_source.html#l00054">54</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">   59</span>{</div>
<div class="line"><span class="lineno">   60</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> nr;</div>
<div class="line"><span class="lineno">   61</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> pgsize;</div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span><span class="comment">/*</span></div>
<div class="line"><span class="lineno">   64</span><span class="comment"> * ----------------------------</span></div>
<div class="line"><span class="lineno">   65</span><span class="comment"> * | struct xwmm_mempool_page |</span></div>
<div class="line"><span class="lineno">   66</span><span class="comment"> * -----------------------------------------------------------------------------</span></div>
<div class="line"><span class="lineno">   67</span><span class="comment"> * |  attr.objcache.objhead   |-&gt;| obj | a | obj | a | obj | a | ...</span></div>
<div class="line"><span class="lineno">   68</span><span class="comment"> * |--------------------------|-------------------------------------------------</span></div>
<div class="line"><span class="lineno">   69</span><span class="comment"> * | ...                      |        |   ^     |   ^     |   ^</span></div>
<div class="line"><span class="lineno">   70</span><span class="comment"> * |--------------------------|        |___|     |___|     |___|</span></div>
<div class="line"><span class="lineno">   71</span><span class="comment"> * obj: object</span></div>
<div class="line"><span class="lineno">   72</span><span class="comment"> * a: alignment area</span></div>
<div class="line"><span class="lineno">   73</span><span class="comment"> */</span></div>
<div class="line"><span class="lineno">   74</span> </div>
<div class="line"><span class="lineno">   75</span>        alignment = <a class="code hl_define" href="group__xwos__lib__xwbop.html#ga9f63c663f101e3b76de2eba319247598">XWBOP_ALIGN</a>(alignment, (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)<a class="code hl_define" href="group__xwmm__common.html#ga5fda7561f71a27db613b7fe335ea3259">XWMM_ALIGNMENT</a>);</div>
<div class="line"><span class="lineno">   76</span>        objsize = <a class="code hl_define" href="group__xwos__lib__xwbop.html#ga9f63c663f101e3b76de2eba319247598">XWBOP_ALIGN</a>(objsize, (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)alignment);</div>
<div class="line"><span class="lineno">   77</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> != ctor) {</div>
<div class="line"><span class="lineno">   78</span>                <a class="code hl_typedef" href="group__xwos__lib__type.html#ga4433c8b2d64a72382ab333d11bfd0093">xwu8_t</a> obj[objsize];</div>
<div class="line"><span class="lineno">   79</span>                ctor((<span class="keywordtype">void</span> *)obj);</div>
<div class="line"><span class="lineno">   80</span>                oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a2a35a6f0e7edd3a011291ae539af6206">backup</a> = *((<a class="code hl_typedef" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a> *)obj);</div>
<div class="line"><span class="lineno">   81</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   82</span>                oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a2a35a6f0e7edd3a011291ae539af6206">backup</a> = 0;</div>
<div class="line"><span class="lineno">   83</span>        }</div>
<div class="line"><span class="lineno">   84</span> </div>
<div class="line"><span class="lineno">   85</span>        pgsize = pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a2216cfe5628f8cb83492d737e0495898">pgsize</a> &lt;&lt; pg_order;</div>
<div class="line"><span class="lineno">   86</span>        nr = pgsize / objsize;</div>
<div class="line"><span class="lineno">   87</span> </div>
<div class="line"><span class="lineno">   88</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#ae1ad35716f2e10b301250dcc03373f45">name</a> = name;</div>
<div class="line"><span class="lineno">   89</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a053bc33ff6399770874b14c65bdb5390">pa</a> = pa;</div>
<div class="line"><span class="lineno">   90</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a05389bc2c128416b3fa0b43671168b40">objsize</a> = objsize;</div>
<div class="line"><span class="lineno">   91</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a9f390ff2475ae7356d31d863a8de1352">alignment</a> = alignment;</div>
<div class="line"><span class="lineno">   92</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#ae62b80a7807877435a82a08b2e62cfbd">pg_order</a> = pg_order;</div>
<div class="line"><span class="lineno">   93</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a> = nr;</div>
<div class="line"><span class="lineno">   94</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#adba198ae35ae05763c41a9370a6dcf58">ctor</a> = ctor;</div>
<div class="line"><span class="lineno">   95</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a15ae123a3f28aeb8f2786e235f17beff">dtor</a> = dtor;</div>
<div class="line"><span class="lineno">   96</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#afc8c3ae5d542f2a700f5b2ac17aed6d2">capacity</a> = 0;</div>
<div class="line"><span class="lineno">   97</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#aca5c7fbe77e4fc6836679fc6f4189c3d">idleness</a> = 0;</div>
<div class="line"><span class="lineno">   98</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#ac54752393665135700c995010d23a6be">reserved</a> = 0;</div>
<div class="line"><span class="lineno">   99</span>        <a class="code hl_function" href="group__xwos__lib__bclst.html#ga08f9a7aec46aaeee30262e4bbdc65c0a">xwlib_bclst_init_head</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a05d16698a1572d3ad039e4f3d8e4a5ee">full</a>);</div>
<div class="line"><span class="lineno">  100</span>        <a class="code hl_function" href="group__xwos__lib__bclst.html#ga08f9a7aec46aaeee30262e4bbdc65c0a">xwlib_bclst_init_head</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#aa90dcd466fd2d2df7008925e664d277d">available</a>);</div>
<div class="line"><span class="lineno">  101</span>        <a class="code hl_function" href="group__xwos__lib__bclst.html#ga08f9a7aec46aaeee30262e4bbdc65c0a">xwlib_bclst_init_head</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a26d781cc1112808f876f0d2551da2d30">idle</a>);</div>
<div class="line"><span class="lineno">  102</span>        <a class="code hl_function" href="group__xwos__lock__seqlock.html#ga230119b86fd51047f83cbe1e74982892">xwos_sqlk_init</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a6d27d017089b61643a2248a048b26ef8">lock</a>);</div>
<div class="line"><span class="lineno">  103</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#ab876b978a4238f33b78443659e0fc38c">i_a</a>.<a class="code hl_variable" href="structxwmm__mempool__i__allocator.html#a8338a06dc3dafd768e21d832868be524">malloc</a> = <a class="code hl_function" href="objcache_8c.html#a27d6631115c7033bfb49d22d5d3d992d">xwmm_mempool_objcache_i_a_malloc</a>;</div>
<div class="line"><span class="lineno">  104</span>        oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#ab876b978a4238f33b78443659e0fc38c">i_a</a>.<a class="code hl_variable" href="structxwmm__mempool__i__allocator.html#a4f2e653d62ac1e58420fb623ee28ab23">free</a> = <a class="code hl_function" href="objcache_8c.html#a7214f0b448c3680b68f84d3bb6d7155a">xwmm_mempool_objcache_i_a_free</a>;</div>
<div class="line"><span class="lineno">  105</span> </div>
<div class="line"><span class="lineno">  106</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  107</span>}</div>
<div class="ttc" id="agroup__xwos__lib__bclst_html_ga08f9a7aec46aaeee30262e4bbdc65c0a"><div class="ttname"><a href="group__xwos__lib__bclst.html#ga08f9a7aec46aaeee30262e4bbdc65c0a">xwlib_bclst_init_head</a></div><div class="ttdeci">static void xwlib_bclst_init_head(struct xwlib_bclst_node *h)</div><div class="ttdoc">初始化一个链表头。</div><div class="ttdef"><b>Definition</b> <a href="bclst_8h_source.html#l00229">bclst.h:229</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_ga4433c8b2d64a72382ab333d11bfd0093"><div class="ttname"><a href="group__xwos__lib__type.html#ga4433c8b2d64a72382ab333d11bfd0093">xwu8_t</a></div><div class="ttdeci">uint8_t xwu8_t</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00194">type.h:194</a></div></div>
<div class="ttc" id="agroup__xwos__lock__seqlock_html_ga230119b86fd51047f83cbe1e74982892"><div class="ttname"><a href="group__xwos__lock__seqlock.html#ga230119b86fd51047f83cbe1e74982892">xwos_sqlk_init</a></div><div class="ttdeci">static void xwos_sqlk_init(struct xwos_sqlk *sql)</div><div class="ttdoc">XWOS API：初始化顺序锁</div><div class="ttdef"><b>Definition</b> <a href="lock_2seqlock_8h_source.html#l00128">seqlock.h:128</a></div></div>
<div class="ttc" id="aobjcache_8c_html_a27d6631115c7033bfb49d22d5d3d992d"><div class="ttname"><a href="objcache_8c.html#a27d6631115c7033bfb49d22d5d3d992d">xwmm_mempool_objcache_i_a_malloc</a></div><div class="ttdeci">static xwer_t xwmm_mempool_objcache_i_a_malloc(void *this, xwsz_t size, void **membuf)</div><div class="ttdoc">i_allocator接口函数：申请内存</div><div class="ttdef"><b>Definition</b> <a href="objcache_8c_source.html#l00400">objcache.c:400</a></div></div>
<div class="ttc" id="aobjcache_8c_html_a7214f0b448c3680b68f84d3bb6d7155a"><div class="ttname"><a href="objcache_8c.html#a7214f0b448c3680b68f84d3bb6d7155a">xwmm_mempool_objcache_i_a_free</a></div><div class="ttdeci">static xwer_t xwmm_mempool_objcache_i_a_free(void *this, void *mem)</div><div class="ttdoc">i_allocator接口函数：释放内存</div><div class="ttdef"><b>Definition</b> <a href="objcache_8c_source.html#l00430">objcache.c:430</a></div></div>
<div class="ttc" id="astructxwmm__mempool__i__allocator_html_a4f2e653d62ac1e58420fb623ee28ab23"><div class="ttname"><a href="structxwmm__mempool__i__allocator.html#a4f2e653d62ac1e58420fb623ee28ab23">xwmm_mempool_i_allocator::free</a></div><div class="ttdeci">xwer_t(* free)(void *, void *)</div><div class="ttdef"><b>Definition</b> <a href="i__allocator_8h_source.html#l00031">i_allocator.h:31</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_a26d781cc1112808f876f0d2551da2d30"><div class="ttname"><a href="structxwmm__mempool__objcache.html#a26d781cc1112808f876f0d2551da2d30">xwmm_mempool_objcache::idle</a></div><div class="ttdeci">struct xwlib_bclst_node idle</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00057">objcache.h:57</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_a9f390ff2475ae7356d31d863a8de1352"><div class="ttname"><a href="structxwmm__mempool__objcache.html#a9f390ff2475ae7356d31d863a8de1352">xwmm_mempool_objcache::alignment</a></div><div class="ttdeci">xwsz_t alignment</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00039">objcache.h:39</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_ab876b978a4238f33b78443659e0fc38c"><div class="ttname"><a href="structxwmm__mempool__objcache.html#ab876b978a4238f33b78443659e0fc38c">xwmm_mempool_objcache::i_a</a></div><div class="ttdeci">struct xwmm_mempool_i_allocator i_a</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00035">objcache.h:35</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_adba198ae35ae05763c41a9370a6dcf58"><div class="ttname"><a href="structxwmm__mempool__objcache.html#adba198ae35ae05763c41a9370a6dcf58">xwmm_mempool_objcache::ctor</a></div><div class="ttdeci">ctor_f ctor</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00048">objcache.h:48</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_ae1ad35716f2e10b301250dcc03373f45"><div class="ttname"><a href="structxwmm__mempool__objcache.html#ae1ad35716f2e10b301250dcc03373f45">xwmm_mempool_objcache::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00037">objcache.h:37</a></div></div>
<div class="ttc" id="astructxwmm__mempool__objcache_html_ae62b80a7807877435a82a08b2e62cfbd"><div class="ttname"><a href="structxwmm__mempool__objcache.html#ae62b80a7807877435a82a08b2e62cfbd">xwmm_mempool_objcache::pg_order</a></div><div class="ttdeci">xwsq_t pg_order</div><div class="ttdef"><b>Definition</b> <a href="objcache_8h_source.html#l00040">objcache.h:40</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__allocator_html_a2216cfe5628f8cb83492d737e0495898"><div class="ttname"><a href="structxwmm__mempool__page__allocator.html#a2216cfe5628f8cb83492d737e0495898">xwmm_mempool_page_allocator::pgsize</a></div><div class="ttdeci">xwsz_t pgsize</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00087">page.h:87</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_ga15d8fc6d72d2ef920927bd6702174c3a_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_ga15d8fc6d72d2ef920927bd6702174c3a_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_ga15d8fc6d72d2ef920927bd6702174c3a_cgraph" id="agroup__xwmm__mempool_ga15d8fc6d72d2ef920927bd6702174c3a_cgraph">
<area shape="rect" title="XWMM API：初始化对象缓存" alt="" coords="5,426,209,451"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga08f9a7aec46aaeee30262e4bbdc65c0a" title="初始化一个链表头。" alt="" coords="274,336,421,362"/>
<area shape="poly" title=" " alt="" coords="135,423,256,372,283,363,285,368,258,377,137,428"/>
<area shape="rect" href="objcache_8c.html#a7214f0b448c3680b68f84d3bb6d7155a" title="i_allocator接口函数：释放内存" alt="" coords="257,386,437,426"/>
<area shape="poly" title=" " alt="" coords="202,423,243,418,244,423,203,428"/>
<area shape="rect" href="objcache_8c.html#a27d6631115c7033bfb49d22d5d3d992d" title="i_allocator接口函数：申请内存" alt="" coords="257,450,437,490"/>
<area shape="poly" title=" " alt="" coords="203,449,244,454,243,459,202,454"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#ga230119b86fd51047f83cbe1e74982892" title="XWOS API：初始化顺序锁" alt="" coords="293,515,401,540"/>
<area shape="poly" title=" " alt="" coords="137,449,258,500,285,509,283,514,256,505,135,454"/>
<area shape="rect" href="group__xwmm__mempool.html#gae7d39e7ba00cc3926284e6ba8775121b" title="XWMM API：释放对象到对象缓存中" alt="" coords="485,319,695,344"/>
<area shape="poly" title=" " alt="" coords="412,384,534,346,536,351,414,389"/>
<area shape="rect" href="group__xwos__lib__lfq.html#ga1cac1b49ec185ccb135f19401e286166" title="将一个节点推入无锁队列（栈式队列）" alt="" coords="1295,278,1403,303"/>
<area shape="poly" title=" " alt="" coords="639,316,742,297,893,285,1043,281,1282,285,1281,290,1043,286,893,291,743,302,640,322"/>
<area shape="rect" href="objcache_8c.html#a21221e21cca4abbdfc36138c1cecb3f5" title="释放空闲页" alt="" coords="745,312,925,352"/>
<area shape="poly" title=" " alt="" coords="695,329,731,329,731,334,695,334"/>
<area shape="rect" href="objcache_8c.html#a6523b89f414d275f4c4548a684b21092" title="减少页的引用计数" alt="" coords="745,528,925,568"/>
<area shape="poly" title=" " alt="" coords="601,343,621,377,654,423,695,471,744,514,753,519,750,524,741,518,691,475,649,426,617,380,596,346"/>
<area shape="rect" href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967" title="依据内存地址查找页" alt="" coords="743,111,927,136"/>
<area shape="poly" title=" " alt="" coords="604,317,806,144,810,148,608,321"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab12f3ce1a4e53de3112b10c9ffb06cae" title="删除一个节点，并重新初始化它" alt="" coords="1013,414,1147,439"/>
<area shape="poly" title=" " alt="" coords="888,349,1034,406,1032,411,886,354"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga54d0d6c4a04b8f3c80891f7d0f5a1e62" title="测试链表是否为空。" alt="" coords="1004,312,1156,338"/>
<area shape="poly" title=" " alt="" coords="925,327,990,325,990,330,925,332"/>
<area shape="rect" href="group__xwmm__mempool.html#ga52f11e08dc37a0cc72717169b6ae4131" title="XWMM API：释放一页内存" alt="" coords="987,110,1173,135"/>
<area shape="poly" title=" " alt="" coords="858,310,1052,142,1055,146,861,314"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb" title="XWOS API：开启写临界区，保存本地CPU的中断标志并关闭" alt="" coords="1800,680,1992,706"/>
<area shape="poly" title=" " alt="" coords="857,350,893,394,929,451,939,475,943,499,945,540,951,577,960,595,976,614,1002,632,1035,648,1120,673,1225,689,1342,699,1464,703,1584,704,1786,697,1786,703,1584,709,1464,709,1342,704,1225,695,1119,678,1033,653,999,637,973,618,956,598,946,579,940,540,938,499,934,477,924,453,889,397,853,354"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8" title="XWOS API：关闭写临界区，恢复本地CPU的中断标志" alt="" coords="1821,385,1971,425"/>
<area shape="poly" title=" " alt="" coords="917,309,974,297,1103,275,1233,262,1384,248,1446,243,1504,241,1561,246,1620,259,1683,283,1753,320,1770,334,1779,349,1787,363,1802,376,1809,381,1807,385,1798,381,1783,366,1774,351,1766,337,1751,325,1681,288,1618,264,1561,251,1504,247,1447,248,1384,254,1234,268,1104,280,975,302,918,314"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab7918962f86f86d5c7049922a5173e81" title="删除prev节点与next节点之间的节点" alt="" coords="1266,379,1433,404"/>
<area shape="poly" title=" " alt="" coords="1147,415,1252,402,1253,407,1148,420"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga3286c94ae92265dea90fd52bfdb85569" title="初始化一个链表节点。" alt="" coords="1276,428,1423,454"/>
<area shape="poly" title=" " alt="" coords="1148,427,1263,434,1262,439,1147,433"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7" title="初始化红黑树节点" alt="" coords="1821,136,1971,162"/>
<area shape="poly" title=" " alt="" coords="1148,107,1184,95,1198,86,1207,78,1217,69,1232,61,1375,19,1435,8,1492,3,1549,5,1609,14,1676,29,1753,51,1788,65,1821,84,1873,125,1870,129,1818,89,1786,70,1751,56,1675,34,1608,19,1548,10,1492,8,1436,13,1376,24,1234,66,1220,73,1211,82,1201,91,1186,100,1150,112"/>
<area shape="rect" href="page_8c.html#a8e9302d65eea335934b13f63caea64aa" title="合并空闲的伙伴页" alt="" coords="1243,126,1455,151"/>
<area shape="poly" title=" " alt="" coords="1173,125,1229,129,1229,134,1173,131"/>
<area shape="rect" href="page_8c.html#aeea41b96161d6bab8ed17f9df7dbb2f9" title="获取页的序列值" alt="" coords="1245,76,1454,102"/>
<area shape="poly" title=" " alt="" coords="1172,108,1233,101,1233,106,1173,114"/>
<area shape="rect" href="page_8c.html#aecba66f62c5f653b61e4dd01d92bcc6c" title="找到页的伙伴页" alt="" coords="1542,65,1723,105"/>
<area shape="poly" title=" " alt="" coords="1417,123,1528,102,1529,107,1418,128"/>
<area shape="rect" href="page_8c.html#adc418491ba0dd770fa96b845e96722d9" title="增加页到阶红黑树中" alt="" coords="1513,564,1752,590"/>
<area shape="poly" title=" " alt="" coords="1369,149,1419,196,1446,228,1468,264,1482,306,1487,346,1480,417,1476,451,1479,483,1490,516,1515,550,1520,555,1517,559,1511,554,1486,519,1473,484,1471,451,1474,417,1481,346,1477,308,1463,266,1441,231,1415,199,1365,153"/>
<area shape="rect" href="page_8c.html#a0803eb38a9059618cf4c98136dc70033" title="从阶红黑树中删除页" alt="" coords="1527,129,1738,169"/>
<area shape="poly" title=" " alt="" coords="1456,140,1513,142,1513,147,1455,145"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa09f90f7792b00240a3cecef84946d88" title="插入一个红色节点后修正红黑树的颜色" alt="" coords="1831,500,1961,540"/>
<area shape="poly" title=" " alt="" coords="1693,562,1751,549,1816,535,1817,540,1753,554,1695,567"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaef7f6608cd37a0fb765adb003428ec38" title="链接节点，并设置位置及颜色信息" alt="" coords="2073,535,2191,560"/>
<area shape="poly" title=" " alt="" coords="1752,567,2059,549,2059,555,1752,573"/>
<area shape="poly" title=" " alt="" coords="1664,588,1855,672,1853,677,1662,592"/>
<area shape="poly" title=" " alt="" coords="1724,562,1751,550,1767,536,1776,521,1784,505,1798,486,1856,432,1860,436,1802,490,1789,507,1780,524,1771,539,1753,554,1727,567"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga3d27937625dc93286c012da5e82945b8" title="反转节点的颜色" alt="" coords="2057,387,2207,412"/>
<area shape="poly" title=" " alt="" coords="1924,497,1977,464,2039,429,2075,414,2077,419,2041,434,1979,468,1927,502"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga8e9025d3e8bade2a627001fb58251047" title="返回节点的父节点指针" alt="" coords="2052,444,2212,470"/>
<area shape="poly" title=" " alt="" coords="1961,500,2069,471,2071,476,1962,505"/>
<area shape="poly" title=" " alt="" coords="1738,146,1807,146,1807,152,1738,152"/>
<area shape="poly" title=" " alt="" coords="1727,167,1754,186,1767,203,1775,220,1778,255,1782,288,1789,304,1802,319,1825,336,1847,346,1892,350,1939,352,1966,358,1993,371,2009,384,2018,396,2027,409,2041,422,2072,437,2070,442,2039,426,2023,413,2014,400,2005,387,1991,375,1964,363,1939,357,1892,355,1846,351,1822,341,1798,323,1784,306,1777,289,1773,255,1769,222,1763,206,1750,190,1724,172"/>
<area shape="poly" title=" " alt="" coords="1643,169,1702,330,1749,440,1802,551,1842,615,1879,668,1875,671,1837,618,1798,553,1744,442,1697,332,1638,170"/>
<area shape="poly" title=" " alt="" coords="1729,167,1754,186,1770,209,1778,232,1779,276,1780,320,1787,342,1802,365,1815,376,1811,380,1798,368,1782,345,1775,321,1774,276,1773,233,1766,211,1750,190,1725,171"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gac57fdaeef6a9dc2ee2bedbf5ac885f96" title="删除一个节点，并修正红黑树的颜色" alt="" coords="1825,284,1967,310"/>
<area shape="poly" title=" " alt="" coords="1710,167,1753,185,1820,229,1873,273,1870,277,1817,234,1751,190,1708,172"/>
<area shape="poly" title=" " alt="" coords="1948,307,1993,327,2008,338,2018,348,2027,358,2041,368,2067,380,2065,385,2039,373,2024,362,2014,352,2005,342,1991,331,1946,312"/>
<area shape="poly" title=" " alt="" coords="1959,308,1994,327,2012,351,2019,376,2025,399,2042,422,2065,437,2062,441,2038,426,2020,401,2014,377,2007,354,1990,331,1957,312"/>
<area shape="poly" title=" " alt="" coords="1920,308,1957,335,1994,372,2011,401,2018,427,2026,452,2042,479,2068,505,2097,526,2094,530,2065,509,2038,483,2021,454,2013,428,2006,403,1990,375,1954,339,1917,312"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga2502fed0a895591911885bd8725de911" title="返回节点的后继节点" alt="" coords="2040,235,2224,260"/>
<area shape="poly" title=" " alt="" coords="1957,282,2056,261,2058,266,1958,287"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga692ff81d9c30fac79a823c5c2ff2357d" title="将节点设置为黑色" alt="" coords="2055,284,2209,310"/>
<area shape="poly" title=" " alt="" coords="1967,294,2041,294,2041,300,1967,300"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga7b281445f2079f235077400ee79f15ea" title="用新节点代替旧节点并继承它的链指针、颜色和位置信息， 但新节点并不接管旧节点的子节点" alt="" coords="2054,334,2210,359"/>
<area shape="poly" title=" " alt="" coords="1958,307,2058,328,2056,333,1957,312"/>
<area shape="poly" title=" " alt="" coords="905,525,925,514,940,498,948,482,957,465,973,450,998,437,1001,442,976,454,961,469,953,484,944,501,928,518,908,530"/>
<area shape="poly" title=" " alt="" coords="914,566,929,578,945,602,951,627,950,675,948,698,950,720,958,741,976,760,1005,778,1041,792,1083,802,1130,810,1236,816,1351,814,1468,805,1578,791,1751,760,1812,738,1863,711,1865,715,1814,743,1753,765,1579,796,1468,810,1352,819,1236,822,1130,815,1082,808,1040,797,1003,783,973,765,954,744,945,722,943,698,944,675,946,627,940,604,925,582,911,570"/>
<area shape="poly" title=" " alt="" coords="925,553,1036,557,1172,555,1319,542,1393,529,1464,512,1488,499,1512,485,1589,460,1667,440,1807,414,1808,419,1668,446,1590,465,1514,490,1491,504,1466,517,1394,535,1320,547,1172,561,1036,563,925,558"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga942be8d64e19cb8efb4dd1cf10e6e706" title="将一个节点加入链表头部（链表头的后面）" alt="" coords="1005,883,1155,908"/>
<area shape="poly" title=" " alt="" coords="915,566,929,578,949,608,958,637,960,665,959,693,956,750,962,780,977,812,1008,847,1043,873,1040,878,1004,851,972,815,957,781,951,750,953,692,955,665,953,638,944,610,925,582,911,570"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga42c09bc0da5cac8327003314056f43b7" title="将一个新节点加入到prev与next之间" alt="" coords="1264,908,1435,934"/>
<area shape="poly" title=" " alt="" coords="1156,900,1250,909,1250,914,1155,906"/>
<area shape="rect" href="page_8c.html#a601e0e3ff8fc5ad5b7348046b545062e" title="从页内存地址获得其页控制块的指针" alt="" coords="975,60,1185,86"/>
<area shape="poly" title=" " alt="" coords="897,108,1004,86,1005,91,898,114"/>
<area shape="rect" href="group__xwmm__mempool.html#ga86e445faf7ecf95130e042fa9b96a41b" title="XWMM API：从对象缓存中申请一个对象" alt="" coords="500,525,680,565"/>
<area shape="poly" title=" " alt="" coords="414,488,512,519,511,524,412,493"/>
<area shape="poly" title=" " alt="" coords="614,523,670,484,705,464,742,449,808,433,876,423,942,420,999,419,999,425,942,425,877,429,809,438,743,454,707,469,673,488,617,527"/>
<area shape="poly" title=" " alt="" coords="610,563,678,635,728,681,786,728,852,772,924,808,1000,833,1039,840,1079,842,1351,842,1466,846,1556,848,1599,846,1644,838,1694,825,1751,804,1787,785,1821,762,1872,714,1876,718,1824,766,1790,790,1753,809,1695,830,1645,843,1600,851,1556,854,1466,851,1351,848,1079,848,1038,845,999,838,922,813,849,777,783,733,724,685,674,639,606,567"/>
<area shape="poly" title=" " alt="" coords="600,523,674,395,714,332,741,298,772,280,800,270,827,265,853,264,907,267,974,264,1148,240,1259,227,1375,217,1490,212,1596,216,1644,223,1686,232,1723,246,1754,263,1767,276,1775,291,1780,320,1784,349,1790,363,1802,377,1810,383,1807,387,1798,380,1786,366,1779,351,1775,321,1770,292,1763,279,1750,267,1721,250,1685,237,1643,228,1596,222,1490,217,1376,222,1259,232,1149,245,975,269,907,272,853,269,827,270,802,275,775,285,744,302,718,335,678,398,605,526"/>
<area shape="poly" title=" " alt="" coords="597,565,609,625,635,707,654,751,678,793,708,830,744,862,772,878,802,891,867,906,931,910,991,907,991,912,931,915,866,911,801,896,770,883,741,866,704,834,674,796,649,753,630,709,604,626,591,566"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga2aa317fe5cea0989c273b3c69f69d795" title="将一个节点加入链表尾部（链表头的前面）" alt="" coords="765,934,904,959"/>
<area shape="poly" title=" " alt="" coords="596,565,608,631,634,724,653,775,678,824,708,871,744,912,764,926,760,930,741,916,704,874,673,827,649,777,629,726,603,632,591,566"/>
<area shape="rect" href="group__xwos__lib__lfq.html#gacbe43c237a9c7c6f21baa98daaf49e68" title="弹出无锁队列中的第一个节点（栈式队列）" alt="" coords="784,592,885,618"/>
<area shape="poly" title=" " alt="" coords="673,563,771,587,770,592,672,568"/>
<area shape="rect" href="objcache_8c.html#a23e4915feeaf7a05d46ec2affe504642" title="获取一页，准备从页内存中分配对象" alt="" coords="745,464,925,504"/>
<area shape="poly" title=" " alt="" coords="670,522,740,505,742,510,671,528"/>
<area shape="poly" title=" " alt="" coords="904,940,1250,923,1250,929,905,946"/>
<area shape="poly" title=" " alt="" coords="920,461,1011,440,1012,445,921,466"/>
<area shape="poly" title=" " alt="" coords="851,462,902,409,936,380,973,355,1007,340,1009,345,976,359,939,384,906,413,855,466"/>
<area shape="poly" title=" " alt="" coords="914,502,929,514,946,540,952,566,952,593,949,618,947,643,948,667,957,689,976,710,1004,726,1040,739,1082,749,1131,755,1241,761,1363,757,1489,748,1610,734,1809,705,1809,711,1611,739,1490,753,1364,763,1241,766,1130,761,1081,754,1038,744,1002,731,973,714,953,692,943,668,942,643,944,618,947,592,947,567,941,542,925,518,911,506"/>
<area shape="poly" title=" " alt="" coords="861,461,912,428,974,399,1086,367,1204,349,1322,341,1437,341,1547,347,1648,358,1808,383,1807,389,1647,363,1547,352,1437,346,1322,346,1204,354,1088,373,976,404,914,433,864,466"/>
<area shape="rect" href="objcache_8c.html#a75c1bbc6602c82f1cc906c65303ee59d" title="初始化新页" alt="" coords="990,464,1170,504"/>
<area shape="poly" title=" " alt="" coords="925,481,976,481,976,486,925,486"/>
<area shape="rect" href="group__xwmm__mempool.html#ga7cbe7d0a7d7052c887dc7723c5010ec1" title="XWMM API：申请一页内存" alt="" coords="976,579,1184,604"/>
<area shape="poly" title=" " alt="" coords="897,501,928,513,1044,570,1042,575,926,518,895,506"/>
<area shape="poly" title=" " alt="" coords="1163,461,1184,448,1201,429,1208,409,1216,388,1231,365,1269,332,1308,307,1311,312,1272,336,1235,368,1221,390,1213,411,1205,432,1187,452,1166,466"/>
<area shape="poly" title=" " alt="" coords="1170,467,1262,452,1263,457,1171,472"/>
<area shape="rect" href="group__xwos__lib__lfq.html#gac87b1137608605a80577abed410ddc1a" title="初始化无锁队列节点" alt="" coords="1301,478,1398,503"/>
<area shape="poly" title=" " alt="" coords="1170,483,1287,486,1287,492,1170,489"/>
<area shape="rect" href="page_8c.html#a6385524c294a6af40c2ea0ff315d60fd" title="将大的页拆分成小的页" alt="" coords="1233,630,1465,655"/>
<area shape="poly" title=" " alt="" coords="1149,602,1268,625,1267,630,1148,607"/>
<area shape="rect" href="page_8c.html#ab54f23d0058e1bff33377fc2d7b0a48c" title="从阶红黑树中选择一页" alt="" coords="1527,500,1738,540"/>
<area shape="poly" title=" " alt="" coords="1184,585,1318,575,1465,557,1545,541,1546,546,1466,562,1319,580,1184,590"/>
<area shape="poly" title=" " alt="" coords="1405,627,1563,590,1564,596,1406,632"/>
<area shape="poly" title=" " alt="" coords="1645,498,1709,399,1798,270,1874,171,1878,174,1802,273,1714,402,1649,501"/>
<area shape="poly" title=" " alt="" coords="1729,497,1800,485,1924,470,2038,461,2039,466,1925,476,1800,490,1730,502"/>
<area shape="poly" title=" " alt="" coords="1728,538,1753,549,1792,577,1827,609,1879,668,1875,671,1824,612,1789,581,1751,554,1726,542"/>
<area shape="poly" title=" " alt="" coords="1708,497,1751,479,1775,461,1799,442,1824,428,1827,433,1801,446,1778,465,1753,483,1710,502"/>
<area shape="poly" title=" " alt="" coords="1654,498,1798,371,1866,316,1869,320,1802,375,1658,502"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_ga15d8fc6d72d2ef920927bd6702174c3a_icgraph.png" border="0" usemap="#agroup__xwmm__mempool_ga15d8fc6d72d2ef920927bd6702174c3a_icgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_ga15d8fc6d72d2ef920927bd6702174c3a_icgraph" id="agroup__xwmm__mempool_ga15d8fc6d72d2ef920927bd6702174c3a_icgraph">
<area shape="rect" title="XWMM API：初始化对象缓存" alt="" coords="429,5,633,31"/>
<area shape="rect" href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d" title="构建内存池" alt="" coords="199,5,381,31"/>
<area shape="poly" title=" " alt="" coords="416,21,382,21,382,15,416,15"/>
<area shape="rect" href="group__xwmm__mempool.html#gaad8340a12043c383e489a786788e89af" title="XWMM API：初始化内存池" alt="" coords="5,5,151,31"/>
<area shape="poly" title=" " alt="" coords="184,21,151,21,151,15,184,15"/>
</map>
</div>

</div>
</div>
<a id="gaa72ed546dbddbbb8dd035c01c6334a24" name="gaa72ed546dbddbbb8dd035c01c6334a24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa72ed546dbddbbb8dd035c01c6334a24">&#9670;&#160;</a></span>xwmm_mempool_objcache_reserve()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_objcache_reserve </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__objcache.html">xwmm_mempool_objcache</a> *&#160;</td>
          <td class="paramname"><em>oc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>reserved</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：预留对象到对象缓存中 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">oc</td><td>对象缓存的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reserved</td><td>预留的数量 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-ENOMEM</td><td>内存不足 </td></tr>
  </table>
  </dd>
</dl>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="objcache_8c_source.html">objcache.c</a> 第 <a class="el" href="objcache_8c_source.html#l00344">344</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  346</span>{</div>
<div class="line"><span class="lineno">  347</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> * pg;</div>
<div class="line"><span class="lineno">  348</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> capacity;</div>
<div class="line"><span class="lineno">  349</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> idleness;</div>
<div class="line"><span class="lineno">  350</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#gad21f70aa6f1364b63b1165784448bc16">xwreg_t</a> flag;</div>
<div class="line"><span class="lineno">  351</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  352</span> </div>
<div class="line"><span class="lineno">  353</span>        reserved = <a class="code hl_define" href="group__xwos__lib__xwbop.html#ga1cc40fbe6c12b077b678ba7d7a13fe72">XWBOP_DIV_ROUND_UP</a>(reserved, oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a>);</div>
<div class="line"><span class="lineno">  354</span>        <a class="code hl_define" href="group__xwos__lib__xwaop.html#gab07c56319425fcf967780c8bd151bb91">xwaop_write</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, &amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#ac54752393665135700c995010d23a6be">reserved</a>, reserved, <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">  355</span>        capacity = <a class="code hl_define" href="group__xwos__lib__xwaop.html#ga9a53ba42b71093821567101c3ebcbe77">xwaop_load</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, &amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#afc8c3ae5d542f2a700f5b2ac17aed6d2">capacity</a>, <a class="code hl_enumvalue" href="group__xwos__lib__type.html#gga33d957600264a16ede92db2e6e42f830acdb5a6e088c69ee770c24d3612d12adc">xwaop_mo_relaxed</a>);</div>
<div class="line"><span class="lineno">  356</span>        idleness = <a class="code hl_define" href="group__xwos__lib__xwaop.html#ga9a53ba42b71093821567101c3ebcbe77">xwaop_load</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, &amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#aca5c7fbe77e4fc6836679fc6f4189c3d">idleness</a>, <a class="code hl_enumvalue" href="group__xwos__lib__type.html#gga33d957600264a16ede92db2e6e42f830acdb5a6e088c69ee770c24d3612d12adc">xwaop_mo_relaxed</a>);</div>
<div class="line"><span class="lineno">  357</span>        <span class="keywordflow">if</span> (capacity &lt; reserved) {</div>
<div class="line"><span class="lineno">  358</span>                rc = <a class="code hl_function" href="group__xwmm__mempool.html#ga7cbe7d0a7d7052c887dc7723c5010ec1">xwmm_mempool_page_allocate</a>(oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a053bc33ff6399770874b14c65bdb5390">pa</a>, oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#ae62b80a7807877435a82a08b2e62cfbd">pg_order</a>, &amp;pg);</div>
<div class="line"><span class="lineno">  359</span>                <span class="keywordflow">if</span> (rc &lt; 0) {</div>
<div class="line"><span class="lineno">  360</span>                        <span class="keywordflow">goto</span> err_pg_alloc;</div>
<div class="line"><span class="lineno">  361</span>                }</div>
<div class="line"><span class="lineno">  362</span>                <a class="code hl_define" href="group__xwos__lib__xwaop.html#gadd1ff1c64048de270aac44c35a8519e7">xwaop_add</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, &amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#afc8c3ae5d542f2a700f5b2ac17aed6d2">capacity</a>, oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a>, <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">  363</span>                <a class="code hl_define" href="group__xwos__lib__xwaop.html#gadd1ff1c64048de270aac44c35a8519e7">xwaop_add</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, &amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#aca5c7fbe77e4fc6836679fc6f4189c3d">idleness</a>, oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a>, <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">  364</span>                <a class="code hl_function" href="objcache_8c.html#a75c1bbc6602c82f1cc906c65303ee59d">xwmm_mempool_objcache_page_init</a>(oc, pg);</div>
<div class="line"><span class="lineno">  365</span>                <a class="code hl_function" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb">xwos_sqlk_wr_lock_cpuirqsv</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a6d27d017089b61643a2248a048b26ef8">lock</a>, &amp;flag);</div>
<div class="line"><span class="lineno">  366</span>                <a class="code hl_function" href="group__xwos__lib__bclst.html#ga2aa317fe5cea0989c273b3c69f69d795">xwlib_bclst_add_tail</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a26d781cc1112808f876f0d2551da2d30">idle</a>, &amp;pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adc80ae7e64a16dfabb3c173ba80fcd5a">objcache</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a12866c4340feabc2fade6a9d5a7dbb16">node</a>);</div>
<div class="line"><span class="lineno">  367</span>                <a class="code hl_function" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8">xwos_sqlk_wr_unlock_cpuirqrs</a>(&amp;oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#af5710f3b100420dbdd54cfcb952877fc">page_list</a>.<a class="code hl_variable" href="structxwmm__mempool__objcache.html#a6d27d017089b61643a2248a048b26ef8">lock</a>, flag);</div>
<div class="line"><span class="lineno">  368</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((reserved + oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a>) &lt; idleness) {</div>
<div class="line"><span class="lineno">  369</span>                <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> nr;</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span>                nr = (idleness - reserved) / oc-&gt;<a class="code hl_variable" href="structxwmm__mempool__objcache.html#abd4c454f4dd3f8389fd1ada1a2504d02">pg_objnr</a>;</div>
<div class="line"><span class="lineno">  372</span>                <span class="comment">// cppcheck-suppress [misra-c2012-17.7]</span></div>
<div class="line"><span class="lineno">  373</span>                <a class="code hl_function" href="objcache_8c.html#a21221e21cca4abbdfc36138c1cecb3f5">xwmm_mempool_objcache_free_idle_page</a>(oc, nr);</div>
<div class="line"><span class="lineno">  374</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  375</span>        }</div>
<div class="line"><span class="lineno">  376</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  377</span> </div>
<div class="line"><span class="lineno">  378</span>err_pg_alloc:</div>
<div class="line"><span class="lineno">  379</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  380</span>}</div>
<div class="ttc" id="agroup__xwmm__mempool_html_ga7cbe7d0a7d7052c887dc7723c5010ec1"><div class="ttname"><a href="group__xwmm__mempool.html#ga7cbe7d0a7d7052c887dc7723c5010ec1">xwmm_mempool_page_allocate</a></div><div class="ttdeci">xwer_t xwmm_mempool_page_allocate(struct xwmm_mempool_page_allocator *pa, xwsq_t order, struct xwmm_mempool_page **pgbuf)</div><div class="ttdoc">XWMM API：申请一页内存</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00159">page.c:159</a></div></div>
<div class="ttc" id="agroup__xwos__lib__xwaop_html_gab07c56319425fcf967780c8bd151bb91"><div class="ttname"><a href="group__xwos__lib__xwaop.html#gab07c56319425fcf967780c8bd151bb91">xwaop_write</a></div><div class="ttdeci">#define xwaop_write(type, a, v, ov)</div><div class="ttdoc">对原子变量进行原子操作：读取—写</div><div class="ttdef"><b>Definition</b> <a href="xwaop_8h_source.html#l00091">xwaop.h:91</a></div></div>
<div class="ttc" id="agroup__xwos__lib__xwbop_html_ga1cc40fbe6c12b077b678ba7d7a13fe72"><div class="ttname"><a href="group__xwos__lib__xwbop.html#ga1cc40fbe6c12b077b678ba7d7a13fe72">XWBOP_DIV_ROUND_UP</a></div><div class="ttdeci">#define XWBOP_DIV_ROUND_UP(n, d)</div><div class="ttdef"><b>Definition</b> <a href="xwbop_8h_source.html#l00031">xwbop.h:31</a></div></div>
<div class="ttc" id="aobjcache_8c_html_a75c1bbc6602c82f1cc906c65303ee59d"><div class="ttname"><a href="objcache_8c.html#a75c1bbc6602c82f1cc906c65303ee59d">xwmm_mempool_objcache_page_init</a></div><div class="ttdeci">static void xwmm_mempool_objcache_page_init(struct xwmm_mempool_objcache *oc, struct xwmm_mempool_page *pg)</div><div class="ttdoc">初始化新页</div><div class="ttdef"><b>Definition</b> <a href="objcache_8c_source.html#l00115">objcache.c:115</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gaa72ed546dbddbbb8dd035c01c6334a24_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_gaa72ed546dbddbbb8dd035c01c6334a24_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gaa72ed546dbddbbb8dd035c01c6334a24_cgraph" id="agroup__xwmm__mempool_gaa72ed546dbddbbb8dd035c01c6334a24_cgraph">
<area shape="rect" title="XWMM API：预留对象到对象缓存中" alt="" coords="5,295,185,335"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga2aa317fe5cea0989c273b3c69f69d795" title="将一个节点加入链表尾部（链表头的前面）" alt="" coords="254,29,393,55"/>
<area shape="poly" title=" " alt="" coords="105,294,155,210,191,159,231,111,260,84,290,61,293,65,264,88,235,114,195,163,160,213,110,296"/>
<area shape="rect" href="objcache_8c.html#a21221e21cca4abbdfc36138c1cecb3f5" title="释放空闲页" alt="" coords="233,381,413,421"/>
<area shape="poly" title=" " alt="" coords="150,333,257,373,256,378,149,338"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb" title="XWOS API：开启写临界区，保存本地CPU的中断标志并关闭" alt="" coords="1284,428,1476,453"/>
<area shape="poly" title=" " alt="" coords="185,298,360,277,462,269,564,266,835,266,951,268,1041,278,1129,301,1237,342,1271,359,1303,378,1355,417,1352,421,1300,383,1268,363,1235,347,1127,306,1040,283,950,274,835,271,564,271,462,274,361,282,186,304"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8" title="XWOS API：关闭写临界区，恢复本地CPU的中断标志" alt="" coords="1305,694,1455,734"/>
<area shape="poly" title=" " alt="" coords="110,334,166,428,211,489,266,553,329,614,401,664,439,684,479,699,521,708,564,711,835,711,1291,711,1291,717,835,717,564,717,520,713,478,704,437,688,398,669,326,618,262,557,207,493,162,431,105,337"/>
<area shape="rect" href="objcache_8c.html#a75c1bbc6602c82f1cc906c65303ee59d" title="初始化新页" alt="" coords="233,125,413,165"/>
<area shape="poly" title=" " alt="" coords="122,293,283,171,286,175,125,297"/>
<area shape="rect" href="group__xwmm__mempool.html#ga7cbe7d0a7d7052c887dc7723c5010ec1" title="XWMM API：申请一页内存" alt="" coords="461,543,669,568"/>
<area shape="poly" title=" " alt="" coords="118,334,168,381,200,407,235,430,303,466,374,495,501,536,499,541,372,500,301,470,232,435,197,412,165,385,114,338"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga42c09bc0da5cac8327003314056f43b7" title="将一个新节点加入到prev与next之间" alt="" coords="480,5,651,31"/>
<area shape="poly" title=" " alt="" coords="393,32,466,25,466,30,394,38"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab12f3ce1a4e53de3112b10c9ffb06cae" title="删除一个节点，并重新初始化它" alt="" coords="498,205,633,231"/>
<area shape="poly" title=" " alt="" coords="350,378,535,237,538,241,353,383"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga54d0d6c4a04b8f3c80891f7d0f5a1e62" title="测试链表是否为空。" alt="" coords="489,412,641,437"/>
<area shape="poly" title=" " alt="" coords="414,407,476,413,475,418,413,412"/>
<area shape="rect" href="group__xwmm__mempool.html#ga52f11e08dc37a0cc72717169b6ae4131" title="XWMM API：释放一页内存" alt="" coords="473,363,658,388"/>
<area shape="poly" title=" " alt="" coords="413,389,459,384,460,389,414,394"/>
<area shape="poly" title=" " alt="" coords="372,418,415,434,462,446,677,483,765,492,847,497,930,496,1018,491,1236,470,1320,454,1321,459,1236,475,1018,497,930,502,847,502,765,498,677,488,461,451,414,439,370,423"/>
<area shape="poly" title=" " alt="" coords="337,420,355,455,383,498,419,541,463,577,488,590,523,602,616,623,729,641,853,657,1088,679,1236,693,1291,700,1291,705,1236,698,1087,685,852,662,728,647,615,628,522,607,486,595,460,582,416,545,379,501,351,457,332,422"/>
<area shape="rect" href="group__xwos__lib__bclst.html#gab7918962f86f86d5c7049922a5173e81" title="删除prev节点与next节点之间的节点" alt="" coords="750,205,917,231"/>
<area shape="poly" title=" " alt="" coords="633,215,737,215,737,221,633,221"/>
<area shape="rect" href="group__xwos__lib__bclst.html#ga3286c94ae92265dea90fd52bfdb85569" title="初始化一个链表节点。" alt="" coords="760,155,907,180"/>
<area shape="poly" title=" " alt="" coords="632,203,752,180,753,185,633,208"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7" title="初始化红黑树节点" alt="" coords="1305,327,1455,352"/>
<area shape="poly" title=" " alt="" coords="629,360,717,347,875,337,1034,332,1291,334,1291,339,1034,338,876,342,718,353,630,365"/>
<area shape="rect" href="page_8c.html#a8e9302d65eea335934b13f63caea64aa" title="合并空闲的伙伴页" alt="" coords="727,423,939,448"/>
<area shape="poly" title=" " alt="" coords="624,385,763,417,762,422,622,391"/>
<area shape="rect" href="page_8c.html#aeea41b96161d6bab8ed17f9df7dbb2f9" title="获取页的序列值" alt="" coords="729,363,938,388"/>
<area shape="poly" title=" " alt="" coords="658,373,715,373,715,378,658,378"/>
<area shape="rect" href="page_8c.html#aecba66f62c5f653b61e4dd01d92bcc6c" title="找到页的伙伴页" alt="" coords="1026,357,1207,397"/>
<area shape="poly" title=" " alt="" coords="895,420,1012,396,1013,401,896,425"/>
<area shape="rect" href="page_8c.html#adc418491ba0dd770fa96b845e96722d9" title="增加页到阶红黑树中" alt="" coords="997,600,1236,625"/>
<area shape="poly" title=" " alt="" coords="846,447,906,514,949,553,999,585,1017,593,1015,598,996,590,946,557,902,517,842,450"/>
<area shape="rect" href="page_8c.html#a0803eb38a9059618cf4c98136dc70033" title="从阶红黑树中删除页" alt="" coords="1011,421,1222,461"/>
<area shape="poly" title=" " alt="" coords="940,435,997,436,997,441,940,440"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa09f90f7792b00240a3cecef84946d88" title="插入一个红色节点后修正红黑树的颜色" alt="" coords="1315,529,1445,569"/>
<area shape="poly" title=" " alt="" coords="1180,597,1235,585,1301,568,1302,573,1237,590,1181,602"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaef7f6608cd37a0fb765adb003428ec38" title="链接节点，并设置位置及颜色信息" alt="" coords="1557,725,1675,751"/>
<area shape="poly" title=" " alt="" coords="1205,623,1356,649,1427,664,1477,680,1502,695,1525,712,1545,719,1543,724,1523,716,1499,700,1475,684,1425,669,1355,654,1204,628"/>
<area shape="poly" title=" " alt="" coords="1210,598,1234,585,1251,570,1260,553,1268,535,1282,515,1314,485,1347,459,1350,464,1318,489,1286,518,1272,538,1265,556,1255,573,1238,590,1212,602"/>
<area shape="poly" title=" " alt="" coords="1179,623,1237,642,1262,657,1285,673,1313,686,1311,691,1283,678,1259,662,1235,647,1178,628"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga3d27937625dc93286c012da5e82945b8" title="反转节点的颜色" alt="" coords="1541,528,1691,553"/>
<area shape="poly" title=" " alt="" coords="1446,544,1527,541,1527,546,1446,549"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga8e9025d3e8bade2a627001fb58251047" title="返回节点的父节点指针" alt="" coords="1536,479,1696,504"/>
<area shape="poly" title=" " alt="" coords="1445,530,1549,505,1551,510,1446,535"/>
<area shape="poly" title=" " alt="" coords="1206,418,1235,406,1259,388,1283,369,1317,354,1319,359,1285,374,1262,392,1237,411,1208,423"/>
<area shape="poly" title=" " alt="" coords="1198,418,1259,407,1330,401,1404,401,1477,413,1508,423,1538,438,1588,468,1585,473,1536,442,1506,428,1475,418,1403,407,1330,406,1260,413,1199,423"/>
<area shape="poly" title=" " alt="" coords="1222,438,1271,438,1271,443,1222,443"/>
<area shape="poly" title=" " alt="" coords="1159,459,1200,486,1238,522,1256,550,1263,576,1271,601,1286,630,1312,659,1340,683,1337,687,1308,662,1282,633,1266,603,1258,577,1251,552,1234,525,1196,490,1156,463"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gac57fdaeef6a9dc2ee2bedbf5ac885f96" title="删除一个节点，并修正红黑树的颜色" alt="" coords="1309,593,1451,619"/>
<area shape="poly" title=" " alt="" coords="1153,459,1195,487,1238,521,1252,538,1261,552,1270,566,1285,578,1299,586,1297,591,1283,583,1266,569,1256,555,1248,541,1234,525,1192,491,1150,463"/>
<area shape="poly" title=" " alt="" coords="1430,591,1475,578,1523,562,1550,554,1552,560,1525,567,1477,583,1432,596"/>
<area shape="poly" title=" " alt="" coords="1450,591,1474,579,1490,563,1498,547,1506,530,1522,513,1532,507,1535,512,1526,517,1510,533,1502,549,1494,566,1478,583,1452,596"/>
<area shape="poly" title=" " alt="" coords="1441,616,1478,636,1495,656,1502,675,1510,694,1526,712,1545,723,1542,727,1522,716,1505,697,1497,677,1490,658,1474,640,1438,621"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga2502fed0a895591911885bd8725de911" title="返回节点的后继节点" alt="" coords="1524,676,1708,701"/>
<area shape="poly" title=" " alt="" coords="1425,616,1477,636,1501,649,1525,662,1546,670,1544,675,1523,667,1499,654,1475,640,1423,621"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga692ff81d9c30fac79a823c5c2ff2357d" title="将节点设置为黑色" alt="" coords="1539,577,1693,603"/>
<area shape="poly" title=" " alt="" coords="1451,599,1525,593,1525,599,1452,604"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga7b281445f2079f235077400ee79f15ea" title="用新节点代替旧节点并继承它的链指针、颜色和位置信息， 但新节点并不接管旧节点的子节点" alt="" coords="1538,627,1694,652"/>
<area shape="poly" title=" " alt="" coords="1452,613,1525,624,1524,629,1451,619"/>
<area shape="poly" title=" " alt="" coords="414,146,746,161,746,166,413,151"/>
<area shape="rect" href="group__xwos__lib__lfq.html#gac87b1137608605a80577abed410ddc1a" title="初始化无锁队列节点" alt="" coords="517,55,614,80"/>
<area shape="poly" title=" " alt="" coords="371,122,461,89,503,77,504,83,462,94,372,127"/>
<area shape="rect" href="group__xwos__lib__lfq.html#ga1cac1b49ec185ccb135f19401e286166" title="将一个节点推入无锁队列（栈式队列）" alt="" coords="511,104,619,129"/>
<area shape="poly" title=" " alt="" coords="413,132,497,122,498,127,414,137"/>
<area shape="rect" href="page_8c.html#a6385524c294a6af40c2ea0ff315d60fd" title="将大的页拆分成小的页" alt="" coords="717,597,949,623"/>
<area shape="poly" title=" " alt="" coords="629,565,757,592,756,597,628,571"/>
<area shape="rect" href="page_8c.html#ab54f23d0058e1bff33377fc2d7b0a48c" title="从阶红黑树中选择一页" alt="" coords="1011,535,1222,575"/>
<area shape="poly" title=" " alt="" coords="670,553,998,553,998,558,670,558"/>
<area shape="poly" title=" " alt="" coords="950,608,983,609,983,614,950,614"/>
<area shape="poly" title=" " alt="" coords="1150,533,1192,505,1234,471,1258,443,1282,413,1348,358,1351,362,1286,417,1262,446,1238,475,1195,509,1153,537"/>
<area shape="poly" title=" " alt="" coords="1193,533,1284,514,1408,500,1522,492,1523,497,1408,505,1284,519,1194,538"/>
<area shape="poly" title=" " alt="" coords="1194,533,1235,514,1249,504,1258,493,1268,482,1283,470,1314,455,1317,460,1285,475,1271,486,1262,496,1252,508,1237,519,1197,538"/>
<area shape="poly" title=" " alt="" coords="1211,573,1237,585,1263,605,1286,629,1347,683,1343,687,1282,633,1260,609,1235,590,1209,578"/>
<area shape="poly" title=" " alt="" coords="1222,573,1301,588,1300,593,1221,578"/>
</map>
</div>

</div>
</div>
<a id="ga7cbe7d0a7d7052c887dc7723c5010ec1" name="ga7cbe7d0a7d7052c887dc7723c5010ec1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7cbe7d0a7d7052c887dc7723c5010ec1">&#9670;&#160;</a></span>xwmm_mempool_page_allocate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_page_allocate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga59fe68c80516b22de8dccb84275d23f2">xwsq_t</a>&#160;</td>
          <td class="paramname"><em>order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> **&#160;</td>
          <td class="paramname"><em>pgbuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：申请一页内存 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pa</td><td>页分配器的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">order</td><td>页数量的阶，页内存大小： <code>((1 &lt;&lt; order) * pa-&gt;pgsize)</code> </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pgbuf</td><td>指向缓冲区的指针，通过此缓冲区返回申请到的页控制块的指针 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-ENOMEM</td><td>内存不足 </td></tr>
  </table>
  </dd>
</dl>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="page_8c_source.html">page.c</a> 第 <a class="el" href="page_8c_source.html#l00159">159</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  162</span>{</div>
<div class="line"><span class="lineno">  163</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga59fe68c80516b22de8dccb84275d23f2">xwsq_t</a> odr;</div>
<div class="line"><span class="lineno">  164</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page__odrbtree.html">xwmm_mempool_page_odrbtree</a> * ot;</div>
<div class="line"><span class="lineno">  165</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> * pg;</div>
<div class="line"><span class="lineno">  166</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a> origin;</div>
<div class="line"><span class="lineno">  167</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>        rc = -<a class="code hl_define" href="group__xwos__lib__errno.html#ga6a05c923dad0c1208043e9c20a58c8e5">ENOMEM</a>;</div>
<div class="line"><span class="lineno">  170</span>        <span class="keywordflow">for</span> (odr = <a class="code hl_variable" href="structxwmm__mempool__page.html#ae97f79ccf71d6cd73b65ba90441409f0">order</a>; odr &lt;= pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a42bc1ba281df4d37fd294216ebff0c53">max_order</a>; odr++) {</div>
<div class="line"><span class="lineno">  171</span>                ot = &amp;pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#adf963f2538beffc341d661ef096ecc8e">odrbtree</a>[odr];</div>
<div class="line"><span class="lineno">  172</span>                pg = <a class="code hl_function" href="page_8c.html#ab54f23d0058e1bff33377fc2d7b0a48c">xwmm_mempool_page_odrbtree_choose</a>(ot);</div>
<div class="line"><span class="lineno">  173</span>                <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> != pg) {</div>
<div class="line"><span class="lineno">  174</span>                        <a class="code hl_function" href="page_8c.html#a6385524c294a6af40c2ea0ff315d60fd">xwmm_mempool_page_divide_page</a>(pa, pg, <a class="code hl_variable" href="structxwmm__mempool__page.html#ae97f79ccf71d6cd73b65ba90441409f0">order</a>, ot);</div>
<div class="line"><span class="lineno">  175</span>                        origin = pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a15a39961136594aea37e708b24afd0c8">zone</a>.<a class="code hl_variable" href="structxwmm__zone.html#a6234f16a4f0b8787dfa3fcab0767d9e5">origin</a> + (pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adf36984f479567e8bd5e65946638312f">free</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a12e1e7cfaedb67767c7b06a0052883b2">seq</a> * pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a2216cfe5628f8cb83492d737e0495898">pgsize</a>);</div>
<div class="line"><span class="lineno">  176</span>                        pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a86aa875179e54032edc2152789309c19">mapping</a> = origin;</div>
<div class="line"><span class="lineno">  177</span>                        *pgbuf = pg;</div>
<div class="line"><span class="lineno">  178</span>                        rc = <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  179</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  180</span>                }</div>
<div class="line"><span class="lineno">  181</span>        }</div>
<div class="line"><span class="lineno">  182</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  183</span>}</div>
<div class="ttc" id="agroup__xwos__lib__errno_html_ga6a05c923dad0c1208043e9c20a58c8e5"><div class="ttname"><a href="group__xwos__lib__errno.html#ga6a05c923dad0c1208043e9c20a58c8e5">ENOMEM</a></div><div class="ttdeci">#define ENOMEM</div><div class="ttdoc">Not enough space</div><div class="ttdef"><b>Definition</b> <a href="errno_8h_source.html#l00042">errno.h:42</a></div></div>
<div class="ttc" id="agroup__xwos__lib__type_html_ga59fe68c80516b22de8dccb84275d23f2"><div class="ttname"><a href="group__xwos__lib__type.html#ga59fe68c80516b22de8dccb84275d23f2">xwsq_t</a></div><div class="ttdeci">unsigned long xwsq_t</div><div class="ttdef"><b>Definition</b> <a href="type_8h_source.html#l00445">type.h:445</a></div></div>
<div class="ttc" id="apage_8c_html_a6385524c294a6af40c2ea0ff315d60fd"><div class="ttname"><a href="page_8c.html#a6385524c294a6af40c2ea0ff315d60fd">xwmm_mempool_page_divide_page</a></div><div class="ttdeci">static void xwmm_mempool_page_divide_page(struct xwmm_mempool_page_allocator *pa, struct xwmm_mempool_page *pg, xwsq_t target_odr, struct xwmm_mempool_page_odrbtree *ot)</div><div class="ttdoc">将大的页拆分成小的页</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00222">page.c:222</a></div></div>
<div class="ttc" id="apage_8c_html_ab54f23d0058e1bff33377fc2d7b0a48c"><div class="ttname"><a href="page_8c.html#ab54f23d0058e1bff33377fc2d7b0a48c">xwmm_mempool_page_odrbtree_choose</a></div><div class="ttdeci">static struct xwmm_mempool_page * xwmm_mempool_page_odrbtree_choose(struct xwmm_mempool_page_odrbtree *ot)</div><div class="ttdoc">从阶红黑树中选择一页</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00416">page.c:416</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__allocator_html_a15a39961136594aea37e708b24afd0c8"><div class="ttname"><a href="structxwmm__mempool__page__allocator.html#a15a39961136594aea37e708b24afd0c8">xwmm_mempool_page_allocator::zone</a></div><div class="ttdeci">struct xwmm_zone zone</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00085">page.h:85</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__allocator_html_a42bc1ba281df4d37fd294216ebff0c53"><div class="ttname"><a href="structxwmm__mempool__page__allocator.html#a42bc1ba281df4d37fd294216ebff0c53">xwmm_mempool_page_allocator::max_order</a></div><div class="ttdeci">xwsq_t max_order</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00088">page.h:88</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__allocator_html_adf963f2538beffc341d661ef096ecc8e"><div class="ttname"><a href="structxwmm__mempool__page__allocator.html#adf963f2538beffc341d661ef096ecc8e">xwmm_mempool_page_allocator::odrbtree</a></div><div class="ttdeci">struct xwmm_mempool_page_odrbtree * odrbtree</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00089">page.h:89</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_a12e1e7cfaedb67767c7b06a0052883b2"><div class="ttname"><a href="structxwmm__mempool__page.html#a12e1e7cfaedb67767c7b06a0052883b2">xwmm_mempool_page::seq</a></div><div class="ttdeci">xwsq_t seq</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00048">page.h:48</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_adf36984f479567e8bd5e65946638312f"><div class="ttname"><a href="structxwmm__mempool__page.html#adf36984f479567e8bd5e65946638312f">xwmm_mempool_page::free</a></div><div class="ttdeci">struct xwmm_mempool_page::@1::@3 free</div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_ae97f79ccf71d6cd73b65ba90441409f0"><div class="ttname"><a href="structxwmm__mempool__page.html#ae97f79ccf71d6cd73b65ba90441409f0">xwmm_mempool_page::order</a></div><div class="ttdeci">xwsq_t order</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00038">page.h:38</a></div></div>
<div class="ttc" id="astructxwmm__zone_html_a6234f16a4f0b8787dfa3fcab0767d9e5"><div class="ttname"><a href="structxwmm__zone.html#a6234f16a4f0b8787dfa3fcab0767d9e5">xwmm_zone::origin</a></div><div class="ttdeci">xwptr_t origin</div><div class="ttdef"><b>Definition</b> <a href="xwos_2mm_2common_8h_source.html#l00041">common.h:41</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_ga7cbe7d0a7d7052c887dc7723c5010ec1_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_ga7cbe7d0a7d7052c887dc7723c5010ec1_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_ga7cbe7d0a7d7052c887dc7723c5010ec1_cgraph" id="agroup__xwmm__mempool_ga7cbe7d0a7d7052c887dc7723c5010ec1_cgraph">
<area shape="rect" title="XWMM API：申请一页内存" alt="" coords="5,259,213,284"/>
<area shape="rect" href="page_8c.html#a6385524c294a6af40c2ea0ff315d60fd" title="将大的页拆分成小的页" alt="" coords="261,284,493,309"/>
<area shape="poly" title=" " alt="" coords="214,279,248,282,248,287,213,284"/>
<area shape="rect" href="page_8c.html#ab54f23d0058e1bff33377fc2d7b0a48c" title="从阶红黑树中选择一页" alt="" coords="555,197,766,237"/>
<area shape="poly" title=" " alt="" coords="214,258,541,226,542,231,214,264"/>
<area shape="rect" href="page_8c.html#adc418491ba0dd770fa96b845e96722d9" title="增加页到阶红黑树中" alt="" coords="541,287,780,312"/>
<area shape="poly" title=" " alt="" coords="494,295,527,295,527,301,494,300"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa09f90f7792b00240a3cecef84946d88" title="插入一个红色节点后修正红黑树的颜色" alt="" coords="859,343,989,383"/>
<area shape="poly" title=" " alt="" coords="715,310,846,342,845,347,713,315"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaef7f6608cd37a0fb765adb003428ec38" title="链接节点，并设置位置及颜色信息" alt="" coords="1101,317,1219,343"/>
<area shape="poly" title=" " alt="" coords="679,310,742,354,784,376,829,393,881,405,924,408,966,404,1019,393,1077,373,1126,347,1129,352,1079,378,1021,398,967,409,924,413,881,410,827,398,782,381,739,358,676,314"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb" title="XWOS API：开启写临界区，保存本地CPU的中断标志并关闭" alt="" coords="828,229,1020,255"/>
<area shape="poly" title=" " alt="" coords="719,284,851,255,852,260,720,289"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8" title="XWOS API：关闭写临界区，恢复本地CPU的中断标志" alt="" coords="849,279,999,319"/>
<area shape="poly" title=" " alt="" coords="780,297,835,297,835,302,780,302"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga3d27937625dc93286c012da5e82945b8" title="反转节点的颜色" alt="" coords="1085,153,1235,179"/>
<area shape="poly" title=" " alt="" coords="988,348,1018,329,1031,312,1038,295,1041,260,1044,224,1052,206,1066,188,1071,184,1075,188,1070,192,1056,209,1049,225,1046,260,1043,296,1036,315,1022,333,991,353"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga8e9025d3e8bade2a627001fb58251047" title="返回节点的父节点指针" alt="" coords="1080,203,1240,228"/>
<area shape="poly" title=" " alt="" coords="988,343,1019,329,1053,307,1084,283,1135,236,1139,240,1088,287,1056,312,1021,334,990,348"/>
<area shape="poly" title=" " alt="" coords="766,214,1066,213,1066,218,766,219"/>
<area shape="poly" title=" " alt="" coords="766,224,815,229,814,234,766,229"/>
<area shape="poly" title=" " alt="" coords="726,234,847,273,846,278,724,239"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7" title="初始化红黑树节点" alt="" coords="849,128,999,153"/>
<area shape="poly" title=" " alt="" coords="730,194,865,155,867,160,732,199"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gac57fdaeef6a9dc2ee2bedbf5ac885f96" title="删除一个节点，并修正红黑树的颜色" alt="" coords="853,79,995,104"/>
<area shape="poly" title=" " alt="" coords="688,194,750,153,827,113,847,106,849,111,829,118,752,158,691,199"/>
<area shape="poly" title=" " alt="" coords="985,102,1021,113,1045,126,1069,138,1094,147,1092,152,1067,143,1043,130,1019,118,984,107"/>
<area shape="poly" title=" " alt="" coords="997,100,1022,113,1039,132,1047,152,1054,170,1070,188,1080,195,1077,199,1066,192,1049,173,1042,153,1034,135,1018,117,995,105"/>
<area shape="poly" title=" " alt="" coords="997,99,1022,113,1036,128,1044,143,1051,173,1056,204,1070,238,1101,276,1134,307,1130,311,1097,280,1066,241,1051,205,1046,174,1039,145,1031,131,1018,117,994,103"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga2502fed0a895591911885bd8725de911" title="返回节点的后继节点" alt="" coords="1068,5,1252,31"/>
<area shape="poly" title=" " alt="" coords="959,76,1067,39,1094,32,1096,37,1069,45,961,81"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga692ff81d9c30fac79a823c5c2ff2357d" title="将节点设置为黑色" alt="" coords="1083,55,1237,80"/>
<area shape="poly" title=" " alt="" coords="995,81,1069,74,1069,79,996,87"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga7b281445f2079f235077400ee79f15ea" title="用新节点代替旧节点并继承它的链指针、颜色和位置信息， 但新节点并不接管旧节点的子节点" alt="" coords="1082,104,1238,129"/>
<area shape="poly" title=" " alt="" coords="996,96,1069,104,1068,110,995,102"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_ga7cbe7d0a7d7052c887dc7723c5010ec1_icgraph.png" border="0" usemap="#agroup__xwmm__mempool_ga7cbe7d0a7d7052c887dc7723c5010ec1_icgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_ga7cbe7d0a7d7052c887dc7723c5010ec1_icgraph" id="agroup__xwmm__mempool_ga7cbe7d0a7d7052c887dc7723c5010ec1_icgraph">
<area shape="rect" title="XWMM API：申请一页内存" alt="" coords="1421,77,1629,102"/>
<area shape="rect" href="objcache_8c.html#a23e4915feeaf7a05d46ec2affe504642" title="获取一页，准备从页内存中分配对象" alt="" coords="1193,5,1373,45"/>
<area shape="poly" title=" " alt="" coords="1462,76,1359,48,1360,43,1464,70"/>
<area shape="rect" href="group__xwmm__mempool.html#gaa72ed546dbddbbb8dd035c01c6334a24" title="XWMM API：预留对象到对象缓存中" alt="" coords="1193,69,1373,109"/>
<area shape="poly" title=" " alt="" coords="1408,92,1374,92,1374,87,1408,87"/>
<area shape="rect" href="page_8c.html#a4b4868cc6b3b9570ba579c040c6d11a2" title="i_allocator接口函数：申请内存" alt="" coords="1200,133,1367,173"/>
<area shape="poly" title=" " alt="" coords="1464,108,1360,136,1359,131,1462,103"/>
<area shape="rect" href="group__xwmm__mempool.html#ga86e445faf7ecf95130e042fa9b96a41b" title="XWMM API：从对象缓存中申请一个对象" alt="" coords="965,11,1145,51"/>
<area shape="poly" title=" " alt="" coords="1179,30,1146,31,1145,26,1179,25"/>
<area shape="rect" href="objcache_8c.html#a27d6631115c7033bfb49d22d5d3d992d" title="i_allocator接口函数：申请内存" alt="" coords="709,15,889,55"/>
<area shape="poly" title=" " alt="" coords="952,35,889,36,889,31,952,30"/>
<area shape="rect" href="group__xwmm__mempool.html#ga15d8fc6d72d2ef920927bd6702174c3a" title="XWMM API：初始化对象缓存" alt="" coords="429,34,633,59"/>
<area shape="poly" title=" " alt="" coords="696,42,634,45,634,39,695,37"/>
<area shape="rect" href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d" title="构建内存池" alt="" coords="199,61,381,86"/>
<area shape="poly" title=" " alt="" coords="416,62,382,66,381,61,415,57"/>
<area shape="rect" href="group__xwmm__mempool.html#gaad8340a12043c383e489a786788e89af" title="XWMM API：初始化内存池" alt="" coords="5,61,151,86"/>
<area shape="poly" title=" " alt="" coords="184,76,151,76,151,71,184,71"/>
<area shape="rect" href="group__xwmm__mempool.html#gaeac7d28f7509e0c764b9f995ebd45f12" title="XWMM API：初始化页分配器" alt="" coords="681,89,917,114"/>
<area shape="poly" title=" " alt="" coords="1186,146,917,117,918,111,1187,140"/>
<area shape="poly" title=" " alt="" coords="667,97,381,81,382,76,668,91"/>
</map>
</div>

</div>
</div>
<a id="gaeac7d28f7509e0c764b9f995ebd45f12" name="gaeac7d28f7509e0c764b9f995ebd45f12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaeac7d28f7509e0c764b9f995ebd45f12">&#9670;&#160;</a></span>xwmm_mempool_page_allocator_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_page_allocator_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a>&#160;</td>
          <td class="paramname"><em>origin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>pgsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page__odrbtree.html">xwmm_mempool_page_odrbtree</a> *&#160;</td>
          <td class="paramname"><em>odrbtree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> *&#160;</td>
          <td class="paramname"><em>pgarray</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：初始化页分配器 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pa</td><td>页分配器的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>名字 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">origin</td><td>内存区域的起始地址 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>内存区域的总大小 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgsize</td><td>单位页的大小 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">odrbtree</td><td>阶红黑树数组的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgarray</td><td>页控制块数组的指针 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-E2SMALL</td><td>内存区域太小 </td></tr>
    <tr><td class="paramname">-EALIGN</td><td>内存区域没有对齐 </td></tr>
  </table>
  </dd>
</dl>
<p>&lt;Too small</p>
<p>&lt; 内存管理对齐的字节数</p>
<p>&lt; 内存管理未对齐掩码</p>
<p>&lt;Not aligned</p>
<p>&lt;Not aligned</p>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="page_8c_source.html">page.c</a> 第 <a class="el" href="page_8c_source.html#l00086">86</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">   91</span>{</div>
<div class="line"><span class="lineno">   92</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> i;</div>
<div class="line"><span class="lineno">   93</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga89fd1295e4575443671eb9ae21c34567">xwssq_t</a> order;</div>
<div class="line"><span class="lineno">   94</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a> nr;</div>
<div class="line"><span class="lineno">   95</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>        <span class="keywordflow">if</span> (size &lt; pgsize) {</div>
<div class="line"><span class="lineno">   98</span>                rc = -<a class="code hl_define" href="group__xwos__lib__errno.html#ga4cc6d572c620e6ea7c351d82fcb4ffbb">E2SMALL</a>;</div>
<div class="line"><span class="lineno">   99</span>                <span class="keywordflow">goto</span> err_mem2small;</div>
<div class="line"><span class="lineno">  100</span>        }</div>
<div class="line"><span class="lineno">  101</span>        <span class="comment">// cppcheck-suppress [misra-c2012-10.8]</span></div>
<div class="line"><span class="lineno">  102</span>        <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)0 != (pgsize &amp; (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)<a class="code hl_define" href="group__xwmm__common.html#gaef7956af43e867df24542bc90d1dcff1">XWMM_UNALIGNED_MASK</a>)) {</div>
<div class="line"><span class="lineno">  103</span>                rc = -<a class="code hl_define" href="group__xwos__lib__errno.html#ga65ababa7e81556351efc64e702a2b6e8">EALIGN</a>;</div>
<div class="line"><span class="lineno">  104</span>                <span class="keywordflow">goto</span> err_aligned;</div>
<div class="line"><span class="lineno">  105</span>        }</div>
<div class="line"><span class="lineno">  106</span>        nr = size / pgsize;</div>
<div class="line"><span class="lineno">  107</span>        order = <a class="code hl_define" href="group__xwos__lib__xwbop.html#ga32ef40a92f3aa57b62af62cf69c06a75">xwbop_fls</a>(<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>, nr);</div>
<div class="line"><span class="lineno">  108</span>        <span class="keywordflow">if</span> ((order &lt; 0) || (nr &amp; ((1U &lt;&lt; (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)order) - 1U))) {</div>
<div class="line"><span class="lineno">  109</span>                rc = -<a class="code hl_define" href="group__xwos__lib__errno.html#ga65ababa7e81556351efc64e702a2b6e8">EALIGN</a>;</div>
<div class="line"><span class="lineno">  110</span>                <span class="keywordflow">goto</span> err_aligned;</div>
<div class="line"><span class="lineno">  111</span>        }</div>
<div class="line"><span class="lineno">  112</span> </div>
<div class="line"><span class="lineno">  113</span>        pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a15a39961136594aea37e708b24afd0c8">zone</a>.<a class="code hl_variable" href="structxwmm__zone.html#a6234f16a4f0b8787dfa3fcab0767d9e5">origin</a> = origin;</div>
<div class="line"><span class="lineno">  114</span>        pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a15a39961136594aea37e708b24afd0c8">zone</a>.<a class="code hl_variable" href="structxwmm__zone.html#ae3584b179ee84eeb61c2497617ac877b">size</a> = size;</div>
<div class="line"><span class="lineno">  115</span>        pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a5180d9f2ba2eaab0f9b49f9834a568ed">name</a> = name;</div>
<div class="line"><span class="lineno">  116</span>        pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a2216cfe5628f8cb83492d737e0495898">pgsize</a> = pgsize;</div>
<div class="line"><span class="lineno">  117</span>        pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a42bc1ba281df4d37fd294216ebff0c53">max_order</a> = (<a class="code hl_typedef" href="group__xwos__lib__type.html#ga59fe68c80516b22de8dccb84275d23f2">xwsq_t</a>)order;</div>
<div class="line"><span class="lineno">  118</span>        pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#adf963f2538beffc341d661ef096ecc8e">odrbtree</a> = odrbtree;</div>
<div class="line"><span class="lineno">  119</span>        pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a14b5d8b9c229f18b0978ad64860bf174">pgarray</a> = pgarray;</div>
<div class="line"><span class="lineno">  120</span> </div>
<div class="line"><span class="lineno">  121</span>        <span class="keywordflow">for</span> (i = 0; i &lt;= pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a42bc1ba281df4d37fd294216ebff0c53">max_order</a>; i++) {</div>
<div class="line"><span class="lineno">  122</span>                <a class="code hl_function" href="group__xwos__lib__rbtree.html#gaa16ae22ddc5595638dd19df6154f4bb6">xwlib_rbtree_init</a>(&amp;pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#adf963f2538beffc341d661ef096ecc8e">odrbtree</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page__odrbtree.html#a0f603b7b629b78a85a9ea9c9b25a2ee9">tree</a>);</div>
<div class="line"><span class="lineno">  123</span>                pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#adf963f2538beffc341d661ef096ecc8e">odrbtree</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page__odrbtree.html#a46fff13bb3f3d58e6a7cf2431256fd61">leftmost</a> = <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">  124</span>                pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#adf963f2538beffc341d661ef096ecc8e">odrbtree</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page__odrbtree.html#a96691fbed1ce15e5aa57bc4b3c5dd0e0">owner</a> = pa;</div>
<div class="line"><span class="lineno">  125</span>                pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#adf963f2538beffc341d661ef096ecc8e">odrbtree</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page__odrbtree.html#ad0d536c31b1295485f4ff32b8f5eb0b5">order</a> = i;</div>
<div class="line"><span class="lineno">  126</span>                <a class="code hl_function" href="group__xwos__lock__seqlock.html#ga230119b86fd51047f83cbe1e74982892">xwos_sqlk_init</a>(&amp;pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#adf963f2538beffc341d661ef096ecc8e">odrbtree</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page__odrbtree.html#a4797caade8572be7f19f68f4086c6d8b">lock</a>);</div>
<div class="line"><span class="lineno">  127</span>        }</div>
<div class="line"><span class="lineno">  128</span>        <span class="keywordflow">for</span> (i = 0; i &lt; nr; i++) {</div>
<div class="line"><span class="lineno">  129</span>                pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a14b5d8b9c229f18b0978ad64860bf174">pgarray</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page.html#ae97f79ccf71d6cd73b65ba90441409f0">order</a> = <a class="code hl_define" href="group__xwmm__mempool.html#ga7744dc03cbec4ec5c2bf0d5122fbe7c2">XWMM_MEMPOOL_PAGE_ORDER_CMB</a>;</div>
<div class="line"><span class="lineno">  130</span>                pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a14b5d8b9c229f18b0978ad64860bf174">pgarray</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page.html#a86aa875179e54032edc2152789309c19">mapping</a> = <a class="code hl_define" href="group__xwmm__mempool.html#gabbdd8414a28105ff954a1b6d9203147b">XWMM_MEMPOOL_PAGE_MAPPING_INVAILD</a>;</div>
<div class="line"><span class="lineno">  131</span>                pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a14b5d8b9c229f18b0978ad64860bf174">pgarray</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adf36984f479567e8bd5e65946638312f">free</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a12e1e7cfaedb67767c7b06a0052883b2">seq</a> = i;</div>
<div class="line"><span class="lineno">  132</span>                <a class="code hl_function" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7">xwlib_rbtree_init_node</a>(&amp;pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a14b5d8b9c229f18b0978ad64860bf174">pgarray</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adf36984f479567e8bd5e65946638312f">free</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a5266e8aeae4628d189fe9e6e5cb08b2e">rbnode</a>);</div>
<div class="line"><span class="lineno">  133</span>                pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a14b5d8b9c229f18b0978ad64860bf174">pgarray</a>[i].<a class="code hl_variable" href="structxwmm__mempool__page.html#a92a86e9c7241aa8d80d586a6168062c4">data</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a4e0eea86b489b7969ef1d4a309f17056">value</a> = 0;</div>
<div class="line"><span class="lineno">  134</span>        }</div>
<div class="line"><span class="lineno">  135</span>        <span class="comment">// cppcheck-suppress [misra-c2012-17.7]</span></div>
<div class="line"><span class="lineno">  136</span>        <a class="code hl_function" href="page_8c.html#adc418491ba0dd770fa96b845e96722d9">xwmm_mempool_page_odrbtree_add</a>(&amp;pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#adf963f2538beffc341d661ef096ecc8e">odrbtree</a>[pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a42bc1ba281df4d37fd294216ebff0c53">max_order</a>],</div>
<div class="line"><span class="lineno">  137</span>                                       &amp;pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a14b5d8b9c229f18b0978ad64860bf174">pgarray</a>[0]);</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>        pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a143805207e804e61a3b0c746047826d8">i_a</a>.<a class="code hl_variable" href="structxwmm__mempool__i__allocator.html#a8338a06dc3dafd768e21d832868be524">malloc</a> = <a class="code hl_function" href="page_8c.html#a4b4868cc6b3b9570ba579c040c6d11a2">xwmm_mempool_page_i_a_malloc</a>;</div>
<div class="line"><span class="lineno">  140</span>        pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a143805207e804e61a3b0c746047826d8">i_a</a>.<a class="code hl_variable" href="structxwmm__mempool__i__allocator.html#a4f2e653d62ac1e58420fb623ee28ab23">free</a> = <a class="code hl_function" href="page_8c.html#a4fff326383599e57562dd2d1bd8dbc2b">xwmm_mempool_page_i_a_free</a>;</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>err_aligned:</div>
<div class="line"><span class="lineno">  145</span>err_mem2small:</div>
<div class="line"><span class="lineno">  146</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  147</span>}</div>
<div class="ttc" id="agroup__xwmm__common_html_gaef7956af43e867df24542bc90d1dcff1"><div class="ttname"><a href="group__xwmm__common.html#gaef7956af43e867df24542bc90d1dcff1">XWMM_UNALIGNED_MASK</a></div><div class="ttdeci">#define XWMM_UNALIGNED_MASK</div><div class="ttdef"><b>Definition</b> <a href="xwos_2mm_2common_8h_source.html#l00030">common.h:30</a></div></div>
<div class="ttc" id="agroup__xwmm__mempool_html_ga7744dc03cbec4ec5c2bf0d5122fbe7c2"><div class="ttname"><a href="group__xwmm__mempool.html#ga7744dc03cbec4ec5c2bf0d5122fbe7c2">XWMM_MEMPOOL_PAGE_ORDER_CMB</a></div><div class="ttdeci">#define XWMM_MEMPOOL_PAGE_ORDER_CMB</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00030">page.h:30</a></div></div>
<div class="ttc" id="agroup__xwmm__mempool_html_gabbdd8414a28105ff954a1b6d9203147b"><div class="ttname"><a href="group__xwmm__mempool.html#gabbdd8414a28105ff954a1b6d9203147b">XWMM_MEMPOOL_PAGE_MAPPING_INVAILD</a></div><div class="ttdeci">#define XWMM_MEMPOOL_PAGE_MAPPING_INVAILD</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00032">page.h:32</a></div></div>
<div class="ttc" id="agroup__xwos__lib__errno_html_ga4cc6d572c620e6ea7c351d82fcb4ffbb"><div class="ttname"><a href="group__xwos__lib__errno.html#ga4cc6d572c620e6ea7c351d82fcb4ffbb">E2SMALL</a></div><div class="ttdeci">#define E2SMALL</div><div class="ttdoc">Too small</div><div class="ttdef"><b>Definition</b> <a href="errno_8h_source.html#l00203">errno.h:203</a></div></div>
<div class="ttc" id="agroup__xwos__lib__errno_html_ga65ababa7e81556351efc64e702a2b6e8"><div class="ttname"><a href="group__xwos__lib__errno.html#ga65ababa7e81556351efc64e702a2b6e8">EALIGN</a></div><div class="ttdeci">#define EALIGN</div><div class="ttdoc">Not aligned</div><div class="ttdef"><b>Definition</b> <a href="errno_8h_source.html#l00204">errno.h:204</a></div></div>
<div class="ttc" id="agroup__xwos__lib__rbtree_html_ga528f2863f2774a2f948db55c73ce6ee7"><div class="ttname"><a href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7">xwlib_rbtree_init_node</a></div><div class="ttdeci">static void xwlib_rbtree_init_node(struct xwlib_rbtree_node *rbn)</div><div class="ttdoc">初始化红黑树节点</div><div class="ttdef"><b>Definition</b> <a href="rbtree_8h_source.html#l00114">rbtree.h:114</a></div></div>
<div class="ttc" id="agroup__xwos__lib__rbtree_html_gaa16ae22ddc5595638dd19df6154f4bb6"><div class="ttname"><a href="group__xwos__lib__rbtree.html#gaa16ae22ddc5595638dd19df6154f4bb6">xwlib_rbtree_init</a></div><div class="ttdeci">static void xwlib_rbtree_init(struct xwlib_rbtree *rbt)</div><div class="ttdoc">初始化红黑树</div><div class="ttdef"><b>Definition</b> <a href="rbtree_8h_source.html#l00104">rbtree.h:104</a></div></div>
<div class="ttc" id="apage_8c_html_a4b4868cc6b3b9570ba579c040c6d11a2"><div class="ttname"><a href="page_8c.html#a4b4868cc6b3b9570ba579c040c6d11a2">xwmm_mempool_page_i_a_malloc</a></div><div class="ttdeci">static xwer_t xwmm_mempool_page_i_a_malloc(void *this, xwsz_t size, void **membuf)</div><div class="ttdoc">i_allocator接口函数：申请内存</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00549">page.c:549</a></div></div>
<div class="ttc" id="apage_8c_html_a4fff326383599e57562dd2d1bd8dbc2b"><div class="ttname"><a href="page_8c.html#a4fff326383599e57562dd2d1bd8dbc2b">xwmm_mempool_page_i_a_free</a></div><div class="ttdeci">static xwer_t xwmm_mempool_page_i_a_free(void *this, void *mem)</div><div class="ttdoc">i_allocator接口函数：释放内存</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00580">page.c:580</a></div></div>
<div class="ttc" id="apage_8c_html_adc418491ba0dd770fa96b845e96722d9"><div class="ttname"><a href="page_8c.html#adc418491ba0dd770fa96b845e96722d9">xwmm_mempool_page_odrbtree_add</a></div><div class="ttdeci">static xwer_t xwmm_mempool_page_odrbtree_add(struct xwmm_mempool_page_odrbtree *ot, struct xwmm_mempool_page *pg)</div><div class="ttdoc">增加页到阶红黑树中</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00293">page.c:293</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__allocator_html_a143805207e804e61a3b0c746047826d8"><div class="ttname"><a href="structxwmm__mempool__page__allocator.html#a143805207e804e61a3b0c746047826d8">xwmm_mempool_page_allocator::i_a</a></div><div class="ttdeci">struct xwmm_mempool_i_allocator i_a</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00084">page.h:84</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__allocator_html_a14b5d8b9c229f18b0978ad64860bf174"><div class="ttname"><a href="structxwmm__mempool__page__allocator.html#a14b5d8b9c229f18b0978ad64860bf174">xwmm_mempool_page_allocator::pgarray</a></div><div class="ttdeci">struct xwmm_mempool_page * pgarray</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00090">page.h:90</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__allocator_html_a5180d9f2ba2eaab0f9b49f9834a568ed"><div class="ttname"><a href="structxwmm__mempool__page__allocator.html#a5180d9f2ba2eaab0f9b49f9834a568ed">xwmm_mempool_page_allocator::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00086">page.h:86</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__odrbtree_html_a0f603b7b629b78a85a9ea9c9b25a2ee9"><div class="ttname"><a href="structxwmm__mempool__page__odrbtree.html#a0f603b7b629b78a85a9ea9c9b25a2ee9">xwmm_mempool_page_odrbtree::tree</a></div><div class="ttdeci">struct xwlib_rbtree tree</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00073">page.h:73</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__odrbtree_html_a46fff13bb3f3d58e6a7cf2431256fd61"><div class="ttname"><a href="structxwmm__mempool__page__odrbtree.html#a46fff13bb3f3d58e6a7cf2431256fd61">xwmm_mempool_page_odrbtree::leftmost</a></div><div class="ttdeci">struct xwmm_mempool_page * leftmost</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00074">page.h:74</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__odrbtree_html_a4797caade8572be7f19f68f4086c6d8b"><div class="ttname"><a href="structxwmm__mempool__page__odrbtree.html#a4797caade8572be7f19f68f4086c6d8b">xwmm_mempool_page_odrbtree::lock</a></div><div class="ttdeci">struct xwos_sqlk lock</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00077">page.h:77</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__odrbtree_html_a96691fbed1ce15e5aa57bc4b3c5dd0e0"><div class="ttname"><a href="structxwmm__mempool__page__odrbtree.html#a96691fbed1ce15e5aa57bc4b3c5dd0e0">xwmm_mempool_page_odrbtree::owner</a></div><div class="ttdeci">struct xwmm_mempool_page_allocator * owner</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00076">page.h:76</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page__odrbtree_html_ad0d536c31b1295485f4ff32b8f5eb0b5"><div class="ttname"><a href="structxwmm__mempool__page__odrbtree.html#ad0d536c31b1295485f4ff32b8f5eb0b5">xwmm_mempool_page_odrbtree::order</a></div><div class="ttdeci">xwsq_t order</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00075">page.h:75</a></div></div>
<div class="ttc" id="astructxwmm__mempool__page_html_a5266e8aeae4628d189fe9e6e5cb08b2e"><div class="ttname"><a href="structxwmm__mempool__page.html#a5266e8aeae4628d189fe9e6e5cb08b2e">xwmm_mempool_page::rbnode</a></div><div class="ttdeci">struct xwlib_rbtree_node rbnode</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00047">page.h:47</a></div></div>
<div class="ttc" id="astructxwmm__zone_html_ae3584b179ee84eeb61c2497617ac877b"><div class="ttname"><a href="structxwmm__zone.html#ae3584b179ee84eeb61c2497617ac877b">xwmm_zone::size</a></div><div class="ttdeci">xwsz_t size</div><div class="ttdef"><b>Definition</b> <a href="xwos_2mm_2common_8h_source.html#l00042">common.h:42</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gaeac7d28f7509e0c764b9f995ebd45f12_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_gaeac7d28f7509e0c764b9f995ebd45f12_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gaeac7d28f7509e0c764b9f995ebd45f12_cgraph" id="agroup__xwmm__mempool_gaeac7d28f7509e0c764b9f995ebd45f12_cgraph">
<area shape="rect" title="XWMM API：初始化页分配器" alt="" coords="5,219,241,244"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa16ae22ddc5595638dd19df6154f4bb6" title="初始化红黑树" alt="" coords="315,5,431,31"/>
<area shape="poly" title=" " alt="" coords="131,217,191,139,236,91,288,48,314,34,316,38,291,52,240,95,195,142,135,220"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7" title="初始化红黑树节点" alt="" coords="1350,103,1501,128"/>
<area shape="poly" title=" " alt="" coords="145,216,218,177,330,127,396,103,465,84,537,71,608,66,880,66,1005,69,1129,78,1337,101,1336,106,1128,83,1004,75,880,71,608,71,537,76,467,89,398,109,332,132,221,181,147,221"/>
<area shape="rect" href="page_8c.html#a4fff326383599e57562dd2d1bd8dbc2b" title="i_allocator接口函数：释放内存" alt="" coords="289,162,456,202"/>
<area shape="poly" title=" " alt="" coords="188,216,275,199,276,204,189,221"/>
<area shape="rect" href="page_8c.html#adc418491ba0dd770fa96b845e96722d9" title="增加页到阶红黑树中" alt="" coords="1043,361,1281,387"/>
<area shape="poly" title=" " alt="" coords="152,242,214,268,290,293,388,314,489,331,691,355,877,367,1029,372,1029,377,877,373,690,360,489,337,387,319,289,298,213,273,150,247"/>
<area shape="rect" href="page_8c.html#a4b4868cc6b3b9570ba579c040c6d11a2" title="i_allocator接口函数：申请内存" alt="" coords="289,243,456,283"/>
<area shape="poly" title=" " alt="" coords="223,241,276,248,275,254,222,247"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#ga230119b86fd51047f83cbe1e74982892" title="XWOS API：初始化顺序锁" alt="" coords="319,412,427,437"/>
<area shape="poly" title=" " alt="" coords="137,243,198,312,242,353,291,390,318,405,315,409,288,395,238,357,194,315,133,246"/>
<area shape="rect" href="page_8c.html#a601e0e3ff8fc5ad5b7348046b545062e" title="从页内存地址获得其页控制块的指针" alt="" coords="504,120,715,145"/>
<area shape="poly" title=" " alt="" coords="456,162,534,146,535,151,457,167"/>
<area shape="rect" href="group__xwmm__mempool.html#ga52f11e08dc37a0cc72717169b6ae4131" title="XWMM API：释放一页内存" alt="" coords="517,169,702,195"/>
<area shape="poly" title=" " alt="" coords="456,179,503,179,503,185,456,185"/>
<area shape="poly" title=" " alt="" coords="661,167,762,145,920,128,1078,118,1336,112,1336,117,1078,123,921,133,763,150,662,172"/>
<area shape="rect" href="page_8c.html#a8e9302d65eea335934b13f63caea64aa" title="合并空闲的伙伴页" alt="" coords="773,209,985,235"/>
<area shape="poly" title=" " alt="" coords="696,192,780,205,779,210,695,197"/>
<area shape="rect" href="page_8c.html#aeea41b96161d6bab8ed17f9df7dbb2f9" title="获取页的序列值" alt="" coords="774,160,983,185"/>
<area shape="poly" title=" " alt="" coords="702,176,760,174,760,179,702,181"/>
<area shape="rect" href="page_8c.html#aecba66f62c5f653b61e4dd01d92bcc6c" title="找到页的伙伴页" alt="" coords="1071,157,1253,197"/>
<area shape="poly" title=" " alt="" coords="958,207,1057,191,1058,196,959,212"/>
<area shape="poly" title=" " alt="" coords="901,233,996,297,1020,317,1044,334,1095,355,1093,360,1041,339,1016,321,993,301,898,237"/>
<area shape="rect" href="page_8c.html#a0803eb38a9059618cf4c98136dc70033" title="从阶红黑树中删除页" alt="" coords="1057,221,1267,261"/>
<area shape="poly" title=" " alt="" coords="985,226,1043,230,1042,235,985,232"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa09f90f7792b00240a3cecef84946d88" title="插入一个红色节点后修正红黑树的颜色" alt="" coords="1360,418,1491,458"/>
<area shape="poly" title=" " alt="" coords="1216,384,1347,416,1346,422,1215,389"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaef7f6608cd37a0fb765adb003428ec38" title="链接节点，并设置位置及颜色信息" alt="" coords="1602,420,1721,445"/>
<area shape="poly" title=" " alt="" coords="1181,385,1243,428,1285,451,1330,467,1367,475,1405,478,1482,474,1552,462,1610,447,1611,452,1553,467,1482,480,1405,483,1366,480,1329,473,1283,456,1241,433,1177,389"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb" title="XWOS API：开启写临界区，保存本地CPU的中断标志并关闭" alt="" coords="1329,368,1521,393"/>
<area shape="poly" title=" " alt="" coords="1282,374,1316,375,1316,381,1281,380"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8" title="XWOS API：关闭写临界区，恢复本地CPU的中断标志" alt="" coords="1350,253,1501,293"/>
<area shape="poly" title=" " alt="" coords="1207,359,1280,334,1370,296,1372,301,1282,339,1209,364"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga3d27937625dc93286c012da5e82945b8" title="反转节点的颜色" alt="" coords="1586,259,1737,284"/>
<area shape="poly" title=" " alt="" coords="1490,422,1520,404,1531,392,1537,379,1543,353,1549,327,1556,313,1568,300,1586,287,1589,292,1571,304,1560,316,1554,329,1548,355,1542,381,1535,395,1523,408,1493,426"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga8e9025d3e8bade2a627001fb58251047" title="返回节点的父节点指针" alt="" coords="1581,313,1741,339"/>
<area shape="poly" title=" " alt="" coords="1490,416,1520,404,1578,374,1627,344,1630,349,1580,379,1522,408,1492,421"/>
<area shape="poly" title=" " alt="" coords="1259,218,1280,207,1295,190,1303,173,1311,155,1328,137,1337,131,1340,136,1331,141,1315,158,1308,175,1300,193,1283,211,1262,223"/>
<area shape="poly" title=" " alt="" coords="1253,218,1315,210,1384,209,1455,217,1489,226,1523,238,1540,251,1549,266,1557,281,1571,295,1592,306,1590,311,1568,299,1552,284,1544,268,1536,254,1520,243,1488,231,1454,222,1384,214,1315,216,1253,223"/>
<area shape="poly" title=" " alt="" coords="1253,258,1283,270,1338,308,1400,357,1396,361,1335,312,1280,275,1251,263"/>
<area shape="poly" title=" " alt="" coords="1268,251,1337,259,1336,265,1267,256"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gac57fdaeef6a9dc2ee2bedbf5ac885f96" title="删除一个节点，并修正红黑树的颜色" alt="" coords="1354,152,1497,177"/>
<area shape="poly" title=" " alt="" coords="1238,218,1281,206,1370,179,1372,184,1282,211,1240,223"/>
<area shape="poly" title=" " alt="" coords="1478,175,1523,194,1538,205,1547,216,1557,227,1571,237,1601,251,1599,256,1568,242,1553,231,1543,220,1534,209,1520,199,1475,180"/>
<area shape="poly" title=" " alt="" coords="1489,175,1523,195,1535,207,1542,221,1548,246,1554,271,1560,283,1571,295,1587,305,1584,310,1568,299,1556,286,1549,273,1543,247,1537,222,1530,211,1520,199,1487,180"/>
<area shape="poly" title=" " alt="" coords="1450,175,1487,202,1523,239,1541,269,1548,295,1556,321,1572,350,1601,383,1633,410,1629,414,1597,387,1567,353,1551,323,1543,296,1536,271,1519,242,1483,206,1446,180"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga2502fed0a895591911885bd8725de911" title="返回节点的后继节点" alt="" coords="1569,103,1753,128"/>
<area shape="poly" title=" " alt="" coords="1486,149,1586,128,1587,134,1487,155"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga692ff81d9c30fac79a823c5c2ff2357d" title="将节点设置为黑色" alt="" coords="1584,152,1739,177"/>
<area shape="poly" title=" " alt="" coords="1497,162,1571,162,1571,167,1497,167"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga7b281445f2079f235077400ee79f15ea" title="用新节点代替旧节点并继承它的链指针、颜色和位置信息， 但新节点并不接管旧节点的子节点" alt="" coords="1583,201,1739,227"/>
<area shape="poly" title=" " alt="" coords="1487,175,1587,196,1586,201,1486,180"/>
<area shape="rect" href="group__xwmm__mempool.html#ga7cbe7d0a7d7052c887dc7723c5010ec1" title="XWMM API：申请一页内存" alt="" coords="505,260,713,285"/>
<area shape="poly" title=" " alt="" coords="457,264,492,265,492,271,456,269"/>
<area shape="rect" href="page_8c.html#a6385524c294a6af40c2ea0ff315d60fd" title="将大的页拆分成小的页" alt="" coords="763,311,995,336"/>
<area shape="poly" title=" " alt="" coords="678,283,798,305,797,311,677,288"/>
<area shape="rect" href="page_8c.html#ab54f23d0058e1bff33377fc2d7b0a48c" title="从阶红黑树中选择一页" alt="" coords="1057,285,1267,325"/>
<area shape="poly" title=" " alt="" coords="714,276,1043,295,1043,300,713,281"/>
<area shape="poly" title=" " alt="" coords="951,333,1077,356,1076,361,950,339"/>
<area shape="poly" title=" " alt="" coords="1263,282,1280,271,1292,255,1299,239,1303,206,1306,171,1314,154,1327,137,1336,131,1339,135,1331,141,1318,157,1311,173,1308,206,1304,240,1297,258,1283,275,1266,287"/>
<area shape="poly" title=" " alt="" coords="1268,306,1568,319,1567,325,1267,312"/>
<area shape="poly" title=" " alt="" coords="1233,322,1368,362,1367,367,1231,327"/>
<area shape="poly" title=" " alt="" coords="1267,289,1336,281,1337,286,1268,295"/>
<area shape="poly" title=" " alt="" coords="1251,282,1280,270,1335,233,1396,184,1400,188,1338,237,1283,275,1253,287"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gaeac7d28f7509e0c764b9f995ebd45f12_icgraph.png" border="0" usemap="#agroup__xwmm__mempool_gaeac7d28f7509e0c764b9f995ebd45f12_icgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gaeac7d28f7509e0c764b9f995ebd45f12_icgraph" id="agroup__xwmm__mempool_gaeac7d28f7509e0c764b9f995ebd45f12_icgraph">
<area shape="rect" title="XWMM API：初始化页分配器" alt="" coords="429,5,665,31"/>
<area shape="rect" href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d" title="构建内存池" alt="" coords="199,5,381,31"/>
<area shape="poly" title=" " alt="" coords="416,21,382,21,382,15,416,15"/>
<area shape="rect" href="group__xwmm__mempool.html#gaad8340a12043c383e489a786788e89af" title="XWMM API：初始化内存池" alt="" coords="5,5,151,31"/>
<area shape="poly" title=" " alt="" coords="184,21,151,21,151,15,184,15"/>
</map>
</div>

</div>
</div>
<a id="gac5da9c9562774fdac8cda7f769d60967" name="gac5da9c9562774fdac8cda7f769d60967"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac5da9c9562774fdac8cda7f769d60967">&#9670;&#160;</a></span>xwmm_mempool_page_find()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_page_find </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>mem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> **&#160;</td>
          <td class="paramname"><em>pgbuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>依据内存地址查找页 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pa</td><td>页分配器的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mem</td><td>内存地址 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pgbuf</td><td>指向缓冲区的指针，通过此缓冲区返回申请到的页控制块的指针 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-ERANGE</td><td>内存地址不在内存池的范围内 </td></tr>
  </table>
  </dd>
</dl>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="page_8c_source.html">page.c</a> 第 <a class="el" href="page_8c_source.html#l00519">519</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  521</span>{</div>
<div class="line"><span class="lineno">  522</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  523</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> * pg;</div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>        <span class="keywordflow">if</span> (((<a class="code hl_typedef" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a>)mem &lt; pa-&gt;zone.origin) ||</div>
<div class="line"><span class="lineno">  526</span>            ((<a class="code hl_typedef" href="group__xwos__lib__type.html#gacef49946313c8d1985a8279bb40e31c4">xwptr_t</a>)mem &gt;= (pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a15a39961136594aea37e708b24afd0c8">zone</a>.<a class="code hl_variable" href="structxwmm__zone.html#a6234f16a4f0b8787dfa3fcab0767d9e5">origin</a> + pa-&gt;<a class="code hl_variable" href="structxwmm__mempool__page__allocator.html#a15a39961136594aea37e708b24afd0c8">zone</a>.<a class="code hl_variable" href="structxwmm__zone.html#ae3584b179ee84eeb61c2497617ac877b">size</a>))) {</div>
<div class="line"><span class="lineno">  527</span>                rc = -<a class="code hl_define" href="group__xwos__lib__errno.html#gaa1591a4f3a86360108de5b9ba34980ca">ERANGE</a>;</div>
<div class="line"><span class="lineno">  528</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  529</span>                pg = <a class="code hl_function" href="page_8c.html#a601e0e3ff8fc5ad5b7348046b545062e">xwmm_mempool_mem_to_page</a>(pa, mem);</div>
<div class="line"><span class="lineno">  530</span>                <span class="keywordflow">while</span> (<a class="code hl_define" href="group__xwmm__mempool.html#ga7744dc03cbec4ec5c2bf0d5122fbe7c2">XWMM_MEMPOOL_PAGE_ORDER_CMB</a> == pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#ae97f79ccf71d6cd73b65ba90441409f0">order</a>) {</div>
<div class="line"><span class="lineno">  531</span>                        pg--;</div>
<div class="line"><span class="lineno">  532</span>                }</div>
<div class="line"><span class="lineno">  533</span>                *pgbuf = pg;</div>
<div class="line"><span class="lineno">  534</span>                rc = <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  535</span>        }</div>
<div class="line"><span class="lineno">  536</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  537</span>}</div>
<div class="ttc" id="agroup__xwos__lib__errno_html_gaa1591a4f3a86360108de5b9ba34980ca"><div class="ttname"><a href="group__xwos__lib__errno.html#gaa1591a4f3a86360108de5b9ba34980ca">ERANGE</a></div><div class="ttdeci">#define ERANGE</div><div class="ttdoc">Result too large</div><div class="ttdef"><b>Definition</b> <a href="errno_8h_source.html#l00064">errno.h:64</a></div></div>
<div class="ttc" id="apage_8c_html_a601e0e3ff8fc5ad5b7348046b545062e"><div class="ttname"><a href="page_8c.html#a601e0e3ff8fc5ad5b7348046b545062e">xwmm_mempool_mem_to_page</a></div><div class="ttdeci">static struct xwmm_mempool_page * xwmm_mempool_mem_to_page(struct xwmm_mempool_page_allocator *pa, void *mem)</div><div class="ttdoc">从页内存地址获得其页控制块的指针</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00477">page.c:477</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gac5da9c9562774fdac8cda7f769d60967_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_gac5da9c9562774fdac8cda7f769d60967_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gac5da9c9562774fdac8cda7f769d60967_cgraph" id="agroup__xwmm__mempool_gac5da9c9562774fdac8cda7f769d60967_cgraph">
<area shape="rect" title="依据内存地址查找页" alt="" coords="5,5,189,31"/>
<area shape="rect" href="page_8c.html#a601e0e3ff8fc5ad5b7348046b545062e" title="从页内存地址获得其页控制块的指针" alt="" coords="237,5,448,31"/>
<area shape="poly" title=" " alt="" coords="189,15,224,15,224,21,189,21"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gac5da9c9562774fdac8cda7f769d60967_icgraph.png" border="0" usemap="#agroup__xwmm__mempool_gac5da9c9562774fdac8cda7f769d60967_icgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gac5da9c9562774fdac8cda7f769d60967_icgraph" id="agroup__xwmm__mempool_gac5da9c9562774fdac8cda7f769d60967_icgraph">
<area shape="rect" title="依据内存地址查找页" alt="" coords="1167,56,1351,81"/>
<area shape="rect" href="group__xwmm__mempool.html#gae8d0ab6282f0c050e0e6e37726d67e88" title="XWMM API：释放内存" alt="" coords="939,5,1089,31"/>
<area shape="poly" title=" " alt="" coords="1182,56,1075,33,1077,28,1183,50"/>
<area shape="rect" href="group__xwmm__mempool.html#gafbd8b2e5fb3f821b9e39cd234c41173b" title="XWMM API：调整内存大小" alt="" coords="688,28,855,53"/>
<area shape="poly" title=" " alt="" coords="1153,65,855,48,855,43,1153,60"/>
<area shape="rect" href="group__xwmm__mempool.html#gae7d39e7ba00cc3926284e6ba8775121b" title="XWMM API：释放对象到对象缓存中" alt="" coords="909,107,1119,132"/>
<area shape="poly" title=" " alt="" coords="1183,87,1077,109,1075,104,1182,82"/>
<area shape="poly" title=" " alt="" coords="924,29,855,36,855,30,924,24"/>
<area shape="rect" href="objcache_8c.html#a7214f0b448c3680b68f84d3bb6d7155a" title="i_allocator接口函数：释放内存" alt="" coords="681,99,861,139"/>
<area shape="poly" title=" " alt="" coords="896,122,862,122,862,117,896,117"/>
<area shape="rect" href="group__xwmm__mempool.html#ga15d8fc6d72d2ef920927bd6702174c3a" title="XWMM API：初始化对象缓存" alt="" coords="429,107,633,132"/>
<area shape="poly" title=" " alt="" coords="668,122,634,122,634,117,668,117"/>
<area shape="rect" href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d" title="构建内存池" alt="" coords="199,107,381,132"/>
<area shape="poly" title=" " alt="" coords="416,122,382,122,382,117,416,117"/>
<area shape="rect" href="group__xwmm__mempool.html#gaad8340a12043c383e489a786788e89af" title="XWMM API：初始化内存池" alt="" coords="5,107,151,132"/>
<area shape="poly" title=" " alt="" coords="184,122,151,122,151,117,184,117"/>
</map>
</div>

</div>
</div>
<a id="ga52f11e08dc37a0cc72717169b6ae4131" name="ga52f11e08dc37a0cc72717169b6ae4131"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga52f11e08dc37a0cc72717169b6ae4131">&#9670;&#160;</a></span>xwmm_mempool_page_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_page_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page__allocator.html">xwmm_mempool_page_allocator</a> *&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> *&#160;</td>
          <td class="paramname"><em>pg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：释放一页内存 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pa</td><td>页分配器的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pg</td><td>页控制块的指针 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-EALREADY</td><td>页内存已释放 </td></tr>
  </table>
  </dd>
</dl>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="page_8c_source.html">page.c</a> 第 <a class="el" href="page_8c_source.html#l00194">194</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  196</span>{</div>
<div class="line"><span class="lineno">  197</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  198</span> </div>
<div class="line"><span class="lineno">  199</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwmm__mempool.html#ga79a401ab2b3ed89693416cd9b770a4fe">XWMM_MEMPOOL_PAGE_MAPPING_FREE</a> == pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a86aa875179e54032edc2152789309c19">mapping</a>) {</div>
<div class="line"><span class="lineno">  200</span>                rc = -<a class="code hl_define" href="group__xwos__lib__errno.html#gaa4ccb54aa806de3e41a8515f06db85d4">EALREADY</a>;</div>
<div class="line"><span class="lineno">  201</span>                <span class="keywordflow">goto</span> err_already;</div>
<div class="line"><span class="lineno">  202</span>        }</div>
<div class="line"><span class="lineno">  203</span>        pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a86aa875179e54032edc2152789309c19">mapping</a> = <a class="code hl_define" href="group__xwmm__mempool.html#gabbdd8414a28105ff954a1b6d9203147b">XWMM_MEMPOOL_PAGE_MAPPING_INVAILD</a>;</div>
<div class="line"><span class="lineno">  204</span>        pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adf36984f479567e8bd5e65946638312f">free</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a12e1e7cfaedb67767c7b06a0052883b2">seq</a> = <a class="code hl_function" href="page_8c.html#aeea41b96161d6bab8ed17f9df7dbb2f9">xwmm_mempool_page_get_seq</a>(pa, pg);</div>
<div class="line"><span class="lineno">  205</span>        <a class="code hl_function" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7">xwlib_rbtree_init_node</a>(&amp;pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a678e3535823e3eab676917331f622473">attr</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#adf36984f479567e8bd5e65946638312f">free</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a5266e8aeae4628d189fe9e6e5cb08b2e">rbnode</a>);</div>
<div class="line"><span class="lineno">  206</span>        pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a92a86e9c7241aa8d80d586a6168062c4">data</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a4e0eea86b489b7969ef1d4a309f17056">value</a> = 0;</div>
<div class="line"><span class="lineno">  207</span>        <a class="code hl_function" href="page_8c.html#a8e9302d65eea335934b13f63caea64aa">xwmm_mempool_page_combine</a>(pa, pg);</div>
<div class="line"><span class="lineno">  208</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  209</span> </div>
<div class="line"><span class="lineno">  210</span>err_already:</div>
<div class="line"><span class="lineno">  211</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  212</span>}</div>
<div class="ttc" id="agroup__xwmm__mempool_html_ga79a401ab2b3ed89693416cd9b770a4fe"><div class="ttname"><a href="group__xwmm__mempool.html#ga79a401ab2b3ed89693416cd9b770a4fe">XWMM_MEMPOOL_PAGE_MAPPING_FREE</a></div><div class="ttdeci">#define XWMM_MEMPOOL_PAGE_MAPPING_FREE</div><div class="ttdef"><b>Definition</b> <a href="page_8h_source.html#l00031">page.h:31</a></div></div>
<div class="ttc" id="agroup__xwos__lib__errno_html_gaa4ccb54aa806de3e41a8515f06db85d4"><div class="ttname"><a href="group__xwos__lib__errno.html#gaa4ccb54aa806de3e41a8515f06db85d4">EALREADY</a></div><div class="ttdeci">#define EALREADY</div><div class="ttdoc">Socket already connected</div><div class="ttdef"><b>Definition</b> <a href="errno_8h_source.html#l00133">errno.h:133</a></div></div>
<div class="ttc" id="apage_8c_html_a8e9302d65eea335934b13f63caea64aa"><div class="ttname"><a href="page_8c.html#a8e9302d65eea335934b13f63caea64aa">xwmm_mempool_page_combine</a></div><div class="ttdeci">static void xwmm_mempool_page_combine(struct xwmm_mempool_page_allocator *pa, struct xwmm_mempool_page *pg)</div><div class="ttdoc">合并空闲的伙伴页</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00252">page.c:252</a></div></div>
<div class="ttc" id="apage_8c_html_aeea41b96161d6bab8ed17f9df7dbb2f9"><div class="ttname"><a href="page_8c.html#aeea41b96161d6bab8ed17f9df7dbb2f9">xwmm_mempool_page_get_seq</a></div><div class="ttdeci">static xwsq_t xwmm_mempool_page_get_seq(struct xwmm_mempool_page_allocator *pa, struct xwmm_mempool_page *pg)</div><div class="ttdoc">获取页的序列值</div><div class="ttdef"><b>Definition</b> <a href="page_8c_source.html#l00459">page.c:459</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_ga52f11e08dc37a0cc72717169b6ae4131_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_ga52f11e08dc37a0cc72717169b6ae4131_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_ga52f11e08dc37a0cc72717169b6ae4131_cgraph" id="agroup__xwmm__mempool_ga52f11e08dc37a0cc72717169b6ae4131_cgraph">
<area shape="rect" title="XWMM API：释放一页内存" alt="" coords="5,117,191,143"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga528f2863f2774a2f948db55c73ce6ee7" title="初始化红黑树节点" alt="" coords="806,5,957,31"/>
<area shape="poly" title=" " alt="" coords="166,115,238,102,543,57,792,26,793,31,543,62,239,107,167,120"/>
<area shape="rect" href="page_8c.html#a8e9302d65eea335934b13f63caea64aa" title="合并空闲的伙伴页" alt="" coords="239,117,451,143"/>
<area shape="poly" title=" " alt="" coords="191,127,225,127,225,133,191,133"/>
<area shape="rect" href="page_8c.html#aeea41b96161d6bab8ed17f9df7dbb2f9" title="获取页的序列值" alt="" coords="240,167,449,192"/>
<area shape="poly" title=" " alt="" coords="163,140,268,161,267,167,162,145"/>
<area shape="rect" href="page_8c.html#aecba66f62c5f653b61e4dd01d92bcc6c" title="找到页的伙伴页" alt="" coords="527,142,709,182"/>
<area shape="poly" title=" " alt="" coords="451,140,514,147,513,152,451,145"/>
<area shape="rect" href="page_8c.html#adc418491ba0dd770fa96b845e96722d9" title="增加页到阶红黑树中" alt="" coords="499,207,737,232"/>
<area shape="poly" title=" " alt="" coords="422,140,452,152,467,162,477,172,486,182,500,192,520,200,518,205,497,196,482,186,473,176,463,166,449,156,420,145"/>
<area shape="rect" href="page_8c.html#a0803eb38a9059618cf4c98136dc70033" title="从阶红黑树中删除页" alt="" coords="513,78,723,118"/>
<area shape="poly" title=" " alt="" coords="451,115,499,109,500,115,451,120"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaa09f90f7792b00240a3cecef84946d88" title="插入一个红色节点后修正红黑树的颜色" alt="" coords="816,221,947,261"/>
<area shape="poly" title=" " alt="" coords="738,226,802,232,802,237,737,232"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gaef7f6608cd37a0fb765adb003428ec38" title="链接节点，并设置位置及颜色信息" alt="" coords="1058,404,1177,429"/>
<area shape="poly" title=" " alt="" coords="638,230,701,274,743,299,786,321,851,347,904,361,1026,390,1055,398,1053,403,1025,395,903,366,850,352,784,326,740,304,699,278,635,234"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gabc138d69277ba1017ade0f27c6c282cb" title="XWOS API：开启写临界区，保存本地CPU的中断标志并关闭" alt="" coords="785,171,977,196"/>
<area shape="poly" title=" " alt="" coords="711,204,774,195,775,201,712,209"/>
<area shape="rect" href="group__xwos__lock__seqlock.html#gadcb38d5d6dad7969e1231c47c131f3c8" title="XWOS API：关闭写临界区，恢复本地CPU的中断标志" alt="" coords="806,106,957,146"/>
<area shape="poly" title=" " alt="" coords="701,204,736,192,760,174,784,156,798,149,800,154,787,160,763,179,739,196,702,209"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga3d27937625dc93286c012da5e82945b8" title="反转节点的颜色" alt="" coords="1042,207,1193,232"/>
<area shape="poly" title=" " alt="" coords="947,232,1028,225,1029,230,947,237"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga8e9025d3e8bade2a627001fb58251047" title="返回节点的父节点指针" alt="" coords="1037,157,1197,183"/>
<area shape="poly" title=" " alt="" coords="944,218,1025,193,1056,184,1057,189,1026,198,945,223"/>
<area shape="poly" title=" " alt="" coords="684,75,825,32,826,37,686,80"/>
<area shape="poly" title=" " alt="" coords="723,80,782,76,846,75,913,80,978,91,1009,102,1039,116,1089,147,1087,151,1037,121,1007,107,977,97,912,85,846,80,782,81,724,85"/>
<area shape="poly" title=" " alt="" coords="705,116,738,128,763,142,786,156,811,164,809,169,784,160,760,146,736,132,703,121"/>
<area shape="poly" title=" " alt="" coords="724,107,793,114,792,119,723,112"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#gac57fdaeef6a9dc2ee2bedbf5ac885f96" title="删除一个节点，并修正红黑树的颜色" alt="" coords="810,285,953,311"/>
<area shape="poly" title=" " alt="" coords="723,116,739,128,754,146,761,165,764,201,767,237,774,254,787,271,799,280,796,284,783,275,769,257,762,238,759,202,756,166,749,149,735,132,720,120"/>
<area shape="poly" title=" " alt="" coords="939,283,976,270,1000,256,1024,242,1047,234,1049,239,1026,247,1003,261,978,275,941,288"/>
<area shape="poly" title=" " alt="" coords="951,283,976,271,992,252,999,233,1006,213,1024,193,1035,186,1037,191,1027,197,1011,216,1004,235,996,255,979,275,954,288"/>
<area shape="poly" title=" " alt="" coords="908,308,979,352,1002,372,1027,390,1046,398,1044,403,1024,395,999,377,976,356,905,313"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga2502fed0a895591911885bd8725de911" title="返回节点的后继节点" alt="" coords="1025,256,1209,281"/>
<area shape="poly" title=" " alt="" coords="952,287,1011,279,1012,284,953,292"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga692ff81d9c30fac79a823c5c2ff2357d" title="将节点设置为黑色" alt="" coords="1040,305,1195,331"/>
<area shape="poly" title=" " alt="" coords="953,301,1027,308,1026,313,952,307"/>
<area shape="rect" href="group__xwos__lib__rbtree.html#ga7b281445f2079f235077400ee79f15ea" title="用新节点代替旧节点并继承它的链指针、颜色和位置信息， 但新节点并不接管旧节点的子节点" alt="" coords="1039,355,1195,380"/>
<area shape="poly" title=" " alt="" coords="922,308,1026,341,1053,348,1052,354,1025,346,920,313"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_ga52f11e08dc37a0cc72717169b6ae4131_icgraph.png" border="0" usemap="#agroup__xwmm__mempool_ga52f11e08dc37a0cc72717169b6ae4131_icgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_ga52f11e08dc37a0cc72717169b6ae4131_icgraph" id="agroup__xwmm__mempool_ga52f11e08dc37a0cc72717169b6ae4131_icgraph">
<area shape="rect" title="XWMM API：释放一页内存" alt="" coords="1451,88,1636,113"/>
<area shape="rect" href="objcache_8c.html#a21221e21cca4abbdfc36138c1cecb3f5" title="释放空闲页" alt="" coords="1223,49,1403,89"/>
<area shape="poly" title=" " alt="" coords="1437,89,1403,84,1403,79,1438,83"/>
<area shape="rect" href="page_8c.html#a4fff326383599e57562dd2d1bd8dbc2b" title="i_allocator接口函数：释放内存" alt="" coords="1229,113,1396,153"/>
<area shape="poly" title=" " alt="" coords="1438,118,1397,124,1396,118,1438,113"/>
<area shape="rect" href="group__xwmm__mempool.html#gae7d39e7ba00cc3926284e6ba8775121b" title="XWMM API：释放对象到对象缓存中" alt="" coords="965,5,1175,31"/>
<area shape="poly" title=" " alt="" coords="1209,50,1131,33,1132,28,1210,45"/>
<area shape="rect" href="group__xwmm__mempool.html#gaa72ed546dbddbbb8dd035c01c6334a24" title="XWMM API：预留对象到对象缓存中" alt="" coords="980,55,1160,95"/>
<area shape="poly" title=" " alt="" coords="1209,74,1160,76,1160,70,1209,69"/>
<area shape="rect" href="objcache_8c.html#a7214f0b448c3680b68f84d3bb6d7155a" title="i_allocator接口函数：释放内存" alt="" coords="709,13,889,53"/>
<area shape="poly" title=" " alt="" coords="952,27,890,30,889,25,951,22"/>
<area shape="rect" href="group__xwmm__mempool.html#ga15d8fc6d72d2ef920927bd6702174c3a" title="XWMM API：初始化对象缓存" alt="" coords="429,37,633,63"/>
<area shape="poly" title=" " alt="" coords="696,42,634,46,633,41,695,37"/>
<area shape="rect" href="allocator_8c.html#a6e1f6748cc378d09e931897b69231d0d" title="构建内存池" alt="" coords="199,64,381,89"/>
<area shape="poly" title=" " alt="" coords="416,65,382,69,381,64,415,60"/>
<area shape="rect" href="group__xwmm__mempool.html#gaad8340a12043c383e489a786788e89af" title="XWMM API：初始化内存池" alt="" coords="5,64,151,89"/>
<area shape="poly" title=" " alt="" coords="184,79,151,79,151,74,184,74"/>
<area shape="rect" href="group__xwmm__mempool.html#gaeac7d28f7509e0c764b9f995ebd45f12" title="XWMM API：初始化页分配器" alt="" coords="681,92,917,117"/>
<area shape="poly" title=" " alt="" coords="1215,130,918,114,918,108,1216,125"/>
<area shape="poly" title=" " alt="" coords="667,100,381,84,382,79,668,95"/>
</map>
</div>

</div>
</div>
<a id="gafbd8b2e5fb3f821b9e39cd234c41173b" name="gafbd8b2e5fb3f821b9e39cd234c41173b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafbd8b2e5fb3f821b9e39cd234c41173b">&#9670;&#160;</a></span>xwmm_mempool_realloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> xwmm_mempool_realloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structxwmm__mempool.html">xwmm_mempool</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>membuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>XWMM API：调整内存大小 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>内存池的指针 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>申请的大小，当size == 0，realloc等价于free </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">membuf</td><td>指向缓冲区的指针，此缓冲区<ul>
<li>(I) 作为输入时，当*membuf == NULL，realloc等价于malloc</li>
<li>(O) 作为输出时，通过此缓冲区返回申请到的内存的首地址 </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>错误码 </dd></dl>
<dl class="retval"><dt>返回值</dt><dd>
  <table class="retval">
    <tr><td class="paramname">XWOK</td><td>没有错误 </td></tr>
    <tr><td class="paramname">-EFAULT</td><td>空指针 </td></tr>
    <tr><td class="paramname">-ENOMEM</td><td>内存不足 </td></tr>
    <tr><td class="paramname">-ERANGE</td><td>内存地址不在内存池的范围内 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>同步/异步：同步</li>
<li>上下文：中断、中断底半部、线程</li>
<li>重入性：可重入</li>
</ul>
</dd></dl>
<ul>
<li>此API类似于C11标准中的 <code>realloc()</code> 函数：<ul>
<li>当 <code>*membuf</code> 为 <code>NULL</code> ，此函数等价于 <code>xwmm_mempool_mealloc(mp, size, membuf)</code> ；</li>
<li>当 <code>*membuf</code> 不为 <code>NULL</code> 且 <code>size</code> 为 <code>0</code> ， 此函数等价于 <code>xwmm_mempool_free(mp, *membuf)</code> ，并且通过 <code>*membuf</code> 返回 <code>NULL</code> ；</li>
<li>当 <code>*membuf</code> 不为 <code>NULL</code> 且 <code>size</code> 比之前的小 ，此函数不重新申请内存，直接返回原来的 <code>*membuf</code> 以及 <code>XWOK</code> ；</li>
<li>当 <code>*membuf</code> 不为 <code>NULL</code> 且 <code>size</code> 比之前的大 ，此函数会尝试重新申请内存：<ul>
<li>如果申请失败，原来的内存不会受影响，且通过 <code>*membuf</code> 返回 <code>NULL</code> 以及 错误码；</li>
<li>如果申请成功，会将旧内存空间的内容移动到新内存空间内，然后返回新的 <code>*membuf</code> 以及 <code>XWOK</code> 。 </li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&lt;No error</p>
<p>&lt;No error</p>
<p>&lt;No error</p>
<p>&lt;No error</p>
<p>&lt;No error</p>

<p class="definition">在文件 <a class="el" href="allocator_8c_source.html">allocator.c</a> 第 <a class="el" href="allocator_8c_source.html#l00418">418</a> 行定义.</p>
<div class="fragment"><div class="line"><span class="lineno">  419</span>{</div>
<div class="line"><span class="lineno">  420</span>        <a class="code hl_typedef" href="group__xwos__lib__type.html#ga06847ea8c7edb2b1f166288b230f251f">xwer_t</a> rc;</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>        <a class="code hl_define" href="group__xwos__standard.html#ga0c63a67f52b315298e2be98f79cd0c08">XWOS_VALIDATE</a>((mp), <span class="stringliteral">&quot;nullptr&quot;</span>, -<a class="code hl_define" href="group__xwos__lib__errno.html#ga3f317946e043623f9d6b93dbf60e6316">EFAULT</a>);</div>
<div class="line"><span class="lineno">  423</span>        <a class="code hl_define" href="group__xwos__standard.html#ga0c63a67f52b315298e2be98f79cd0c08">XWOS_VALIDATE</a>((membuf), <span class="stringliteral">&quot;nullptr&quot;</span>, -<a class="code hl_define" href="group__xwos__lib__errno.html#ga3f317946e043623f9d6b93dbf60e6316">EFAULT</a>);</div>
<div class="line"><span class="lineno">  424</span> </div>
<div class="line"><span class="lineno">  425</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> == *membuf) {</div>
<div class="line"><span class="lineno">  426</span>                rc = <a class="code hl_function" href="group__xwmm__mempool.html#ga8b258eb1da7cce5a8bb34c600dd72c11">xwmm_mempool_malloc</a>(mp, size, membuf);</div>
<div class="line"><span class="lineno">  427</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="group__xwos__lib__type.html#ga2d00153ecb0cdcc8ea0823c13ee59649">xwsz_t</a>)0 == size) {</div>
<div class="line"><span class="lineno">  428</span>                rc = <a class="code hl_function" href="group__xwmm__mempool.html#gae8d0ab6282f0c050e0e6e37726d67e88">xwmm_mempool_free</a>(mp, *membuf);</div>
<div class="line"><span class="lineno">  429</span>                <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a> == rc) {</div>
<div class="line"><span class="lineno">  430</span>                        *membuf = <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">  431</span>                }</div>
<div class="line"><span class="lineno">  432</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  433</span>                <span class="keyword">struct </span><a class="code hl_struct" href="structxwmm__mempool__page.html">xwmm_mempool_page</a> * pg;</div>
<div class="line"><span class="lineno">  434</span>                <span class="keywordtype">void</span> * oldmem;</div>
<div class="line"><span class="lineno">  435</span>                <span class="keywordtype">void</span> * newmem;</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>                oldmem = *membuf;</div>
<div class="line"><span class="lineno">  438</span>                rc = <a class="code hl_function" href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967">xwmm_mempool_page_find</a>(&amp;mp-&gt;<a class="code hl_variable" href="structxwmm__mempool.html#a128e5c1b3f2a3d075de1708b9257bfa1">pa</a>, oldmem, &amp;pg);</div>
<div class="line"><span class="lineno">  439</span>                <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a> == rc) {</div>
<div class="line"><span class="lineno">  440</span>                        <span class="keywordflow">if</span> (size &lt;= pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a92a86e9c7241aa8d80d586a6168062c4">data</a>.value) {</div>
<div class="line"><span class="lineno">  441</span>                                rc = <a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a>;</div>
<div class="line"><span class="lineno">  442</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  443</span>                                rc = <a class="code hl_function" href="group__xwmm__mempool.html#ga8b258eb1da7cce5a8bb34c600dd72c11">xwmm_mempool_malloc</a>(mp, size, &amp;newmem);</div>
<div class="line"><span class="lineno">  444</span>                                <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a> == rc) {</div>
<div class="line"><span class="lineno">  445</span>                                        <span class="comment">// cppcheck-suppress [misra-c2012-17.7]</span></div>
<div class="line"><span class="lineno">  446</span>                                        memcpy(newmem, oldmem, pg-&gt;<a class="code hl_variable" href="structxwmm__mempool__page.html#a92a86e9c7241aa8d80d586a6168062c4">data</a>.<a class="code hl_variable" href="structxwmm__mempool__page.html#a4e0eea86b489b7969ef1d4a309f17056">value</a>);</div>
<div class="line"><span class="lineno">  447</span>                                        rc = <a class="code hl_function" href="group__xwmm__mempool.html#gae8d0ab6282f0c050e0e6e37726d67e88">xwmm_mempool_free</a>(mp, oldmem);</div>
<div class="line"><span class="lineno">  448</span>                                        <span class="keywordflow">if</span> (<a class="code hl_define" href="group__xwos__lib__errno.html#ga6a72d49d869215a02342eb465166537b">XWOK</a> == rc) {</div>
<div class="line"><span class="lineno">  449</span>                                                *membuf = newmem;</div>
<div class="line"><span class="lineno">  450</span>                                        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  451</span>                                                <span class="comment">// cppcheck-suppress [misra-c2012-17.7]</span></div>
<div class="line"><span class="lineno">  452</span>                                                <a class="code hl_function" href="group__xwmm__mempool.html#gae8d0ab6282f0c050e0e6e37726d67e88">xwmm_mempool_free</a>(mp, newmem);</div>
<div class="line"><span class="lineno">  453</span>                                                *membuf = <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">  454</span>                                        }</div>
<div class="line"><span class="lineno">  455</span>                                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  456</span>                                        *membuf = <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">  457</span>                                }</div>
<div class="line"><span class="lineno">  458</span>                        }</div>
<div class="line"><span class="lineno">  459</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  460</span>                        *membuf = <a class="code hl_define" href="group__xwos__lib__type.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">  461</span>                }</div>
<div class="line"><span class="lineno">  462</span>        }</div>
<div class="line"><span class="lineno">  463</span>        <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  464</span>}</div>
<div class="ttc" id="agroup__xwmm__mempool_html_gae8d0ab6282f0c050e0e6e37726d67e88"><div class="ttname"><a href="group__xwmm__mempool.html#gae8d0ab6282f0c050e0e6e37726d67e88">xwmm_mempool_free</a></div><div class="ttdeci">xwer_t xwmm_mempool_free(struct xwmm_mempool *mp, void *mem)</div><div class="ttdoc">XWMM API：释放内存</div><div class="ttdef"><b>Definition</b> <a href="allocator_8c_source.html#l00342">allocator.c:342</a></div></div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwmm__mempool_gafbd8b2e5fb3f821b9e39cd234c41173b_cgraph.png" border="0" usemap="#agroup__xwmm__mempool_gafbd8b2e5fb3f821b9e39cd234c41173b_cgraph" alt=""/></div>
<map name="agroup__xwmm__mempool_gafbd8b2e5fb3f821b9e39cd234c41173b_cgraph" id="agroup__xwmm__mempool_gafbd8b2e5fb3f821b9e39cd234c41173b_cgraph">
<area shape="rect" title="XWMM API：调整内存大小" alt="" coords="5,56,172,81"/>
<area shape="rect" href="group__xwmm__mempool.html#gae8d0ab6282f0c050e0e6e37726d67e88" title="XWMM API：释放内存" alt="" coords="228,5,379,31"/>
<area shape="poly" title=" " alt="" coords="143,53,235,31,236,36,144,58"/>
<area shape="rect" href="group__xwmm__mempool.html#gac5da9c9562774fdac8cda7f769d60967" title="依据内存地址查找页" alt="" coords="435,31,619,56"/>
<area shape="poly" title=" " alt="" coords="172,61,421,47,421,52,173,67"/>
<area shape="rect" href="group__xwmm__mempool.html#ga8b258eb1da7cce5a8bb34c600dd72c11" title="XWMM API：从内存池中申请内存" alt="" coords="220,107,387,132"/>
<area shape="poly" title=" " alt="" coords="144,79,236,101,235,106,143,84"/>
<area shape="poly" title=" " alt="" coords="379,24,421,29,421,34,378,29"/>
<area shape="rect" href="page_8c.html#a601e0e3ff8fc5ad5b7348046b545062e" title="从页内存地址获得其页控制块的指针" alt="" coords="667,31,877,56"/>
<area shape="poly" title=" " alt="" coords="619,41,653,41,653,46,619,46"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
