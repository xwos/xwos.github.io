<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>XWOS API: 内存屏障</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<a href="/" class="github-corner" title="返回首页">
  <svg viewBox="0 0 250 250" style="position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <path
      d="M 0 0 L 250 250 L 250 0 L 0 0 z M 181.19336 6.25 A 18.281986 19.638775 0 0 1 192.79297 10.798828 L 241.54492 54.201172 A 6.0939954 6.5462585 0 0 1 237.64453 65.787109 L 233.13477 65.787109 A 3.0469979 3.2731292 0 0 0 230.08789 69.060547 L 230.08789 111.61133 A 18.281986 19.638775 0 0 1 211.80664 131.25 L 205.71289 131.25 A 12.187991 13.092517 0 0 1 193.52344 118.1582 L 193.52344 98.519531 A 12.187991 13.092517 0 0 0 181.33594 85.425781 A 12.187991 13.092517 0 0 0 169.14844 98.519531 L 169.14844 118.1582 A 12.187991 13.092517 0 0 1 156.95898 131.25 L 150.86523 131.25 A 18.281986 19.638775 0 0 1 132.58398 111.61133 L 132.58398 68.994141 A 3.0469979 3.2731292 0 0 0 129.29297 65.722656 L 124.7832 65.722656 A 6.0939954 6.5462585 0 0 1 120.88281 54.201172 L 169.39258 10.798828 A 18.281986 19.638775 0 0 1 181.19336 6.25 z "/>
  </svg>
</a>
<style>.github-corner:hover</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XWOS API
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">XWOS API参考手册</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__xwos__lib__mb.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">宏定义</a>  </div>
  <div class="headertitle"><div class="title">内存屏障<div class="ingroups"><a class="el" href="group__xwos.html">XWOS内核</a> &raquo; <a class="el" href="group__xwos__lib.html">XWOS的通用库</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
内存屏障 的协作图:</div>
<div class="dyncontent">
<div class="center"><img src="group__xwos__lib__mb.png" border="0" usemap="#agroup____xwos____lib____mb" alt=""/></div>
<map name="agroup____xwos____lib____mb" id="agroup____xwos____lib____mb">
<area shape="rect" href="group__xwos__lib.html" title=" " alt="" coords="5,5,120,31"/>
<area shape="rect" title=" " alt="" coords="168,5,243,31"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
宏定义</h2></td></tr>
<tr class="memitem:gaa0f17799e1136eef315be64f79b8184a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#gaa0f17799e1136eef315be64f79b8184a">xwmb_access</a>(t,  v)&#160;&#160;&#160;(*((volatile t *)&amp;(v)))</td></tr>
<tr class="memdesc:gaa0f17799e1136eef315be64f79b8184a"><td class="mdescLeft">&#160;</td><td class="mdescRight">: 强制从内存中访问指定类型的变量  <br /></td></tr>
<tr class="separator:gaa0f17799e1136eef315be64f79b8184a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab65ff46eaf1a756beb3308f7c1cbcea1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#gab65ff46eaf1a756beb3308f7c1cbcea1">xwmb_read</a>(t,  v,  p)&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#gaa0f17799e1136eef315be64f79b8184a">xwmb_access</a>(t, v) = (*(volatile t * )(p))</td></tr>
<tr class="memdesc:gab65ff46eaf1a756beb3308f7c1cbcea1"><td class="mdescLeft">&#160;</td><td class="mdescRight">: 读取地址中的指定类型的值  <br /></td></tr>
<tr class="separator:gab65ff46eaf1a756beb3308f7c1cbcea1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga22f44a0599d8761343a72dee387e23e2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#ga22f44a0599d8761343a72dee387e23e2">xwmb_write</a>(t,  p,  v)&#160;&#160;&#160;(*(volatile t * )(p)) = (v)</td></tr>
<tr class="memdesc:ga22f44a0599d8761343a72dee387e23e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">存储指定类型的值到地址中  <br /></td></tr>
<tr class="separator:ga22f44a0599d8761343a72dee387e23e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3e7560a0aca4f67d110a230764a59669"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#ga3e7560a0aca4f67d110a230764a59669">xwmb_compiler</a>()</td></tr>
<tr class="memdesc:ga3e7560a0aca4f67d110a230764a59669"><td class="mdescLeft">&#160;</td><td class="mdescRight">编译器内存屏障  <br /></td></tr>
<tr class="separator:ga3e7560a0aca4f67d110a230764a59669"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga35dc698ebb574f02dff634e94a7da7e8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#ga35dc698ebb574f02dff634e94a7da7e8">xwmb_mp_mb</a>()</td></tr>
<tr class="memdesc:ga35dc698ebb574f02dff634e94a7da7e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">多核系统内存屏障  <br /></td></tr>
<tr class="separator:ga35dc698ebb574f02dff634e94a7da7e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga57498c24c01ae5efa8466b23d29bda6a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#ga57498c24c01ae5efa8466b23d29bda6a">xwmb_mp_rmb</a>()</td></tr>
<tr class="memdesc:ga57498c24c01ae5efa8466b23d29bda6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">多核系统读内存屏障  <br /></td></tr>
<tr class="separator:ga57498c24c01ae5efa8466b23d29bda6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5e1fb357ecde09f5c9d6477a03afb3d9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#ga5e1fb357ecde09f5c9d6477a03afb3d9">xwmb_mp_wmb</a>()</td></tr>
<tr class="memdesc:ga5e1fb357ecde09f5c9d6477a03afb3d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">多核写内存屏障  <br /></td></tr>
<tr class="separator:ga5e1fb357ecde09f5c9d6477a03afb3d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa7f7b461571ae8940cf2cb160f4f3c31"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#gaa7f7b461571ae8940cf2cb160f4f3c31">xwmb_ddb</a>()&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#ga3e7560a0aca4f67d110a230764a59669">xwmb_compiler</a>()</td></tr>
<tr class="memdesc:gaa7f7b461571ae8940cf2cb160f4f3c31"><td class="mdescLeft">&#160;</td><td class="mdescRight">数据依赖屏障 @detail  <br /></td></tr>
<tr class="separator:gaa7f7b461571ae8940cf2cb160f4f3c31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga55e0b689d7b495c3dbfc497df0f690ba"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#ga55e0b689d7b495c3dbfc497df0f690ba">xwmb_mp_consume</a>()&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#gaa7f7b461571ae8940cf2cb160f4f3c31">xwmb_ddb</a>()</td></tr>
<tr class="memdesc:ga55e0b689d7b495c3dbfc497df0f690ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">多核系统 <b>消费</b> 屏障，数据依赖屏障  <br /></td></tr>
<tr class="separator:ga55e0b689d7b495c3dbfc497df0f690ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga40d70698501ca94c72a93ed83c64e5c5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#ga40d70698501ca94c72a93ed83c64e5c5">xwmb_mp_acquire</a>()&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#ga35dc698ebb574f02dff634e94a7da7e8">xwmb_mp_mb</a>()</td></tr>
<tr class="memdesc:ga40d70698501ca94c72a93ed83c64e5c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">多核系统 <b>获取</b> 屏障  <br /></td></tr>
<tr class="separator:ga40d70698501ca94c72a93ed83c64e5c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae1b2218d5a0e83aee4039f72025b3314"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#gae1b2218d5a0e83aee4039f72025b3314">xwmb_mp_release</a>()&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#ga35dc698ebb574f02dff634e94a7da7e8">xwmb_mp_mb</a>()</td></tr>
<tr class="memdesc:gae1b2218d5a0e83aee4039f72025b3314"><td class="mdescLeft">&#160;</td><td class="mdescRight">多核系统 <b>释放</b> 屏障  <br /></td></tr>
<tr class="separator:gae1b2218d5a0e83aee4039f72025b3314"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa328f6e6fdda8d00fb6d379f235379ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#gaa328f6e6fdda8d00fb6d379f235379ca">xwmb_mp_load_acquire</a>(t,  v,  p)</td></tr>
<tr class="memdesc:gaa328f6e6fdda8d00fb6d379f235379ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">: 读取地址中的指定类型的值，并保证此处的“读”操作一定发生在之后的“读写”操作之前  <br /></td></tr>
<tr class="separator:gaa328f6e6fdda8d00fb6d379f235379ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafd20fad9aba0ba8755dec125ace98bba"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xwos__lib__mb.html#gafd20fad9aba0ba8755dec125ace98bba">xwmb_mp_store_release</a>(t,  p,  v)</td></tr>
<tr class="memdesc:gafd20fad9aba0ba8755dec125ace98bba"><td class="mdescLeft">&#160;</td><td class="mdescRight">存储指定类型的值到地址中，并保证此处的“写”操作一定发生在之前的“读写”操作之后  <br /></td></tr>
<tr class="separator:gafd20fad9aba0ba8755dec125ace98bba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">详细描述</h2>
<h2 class="groupheader">宏定义说明</h2>
<a id="gaa0f17799e1136eef315be64f79b8184a" name="gaa0f17799e1136eef315be64f79b8184a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa0f17799e1136eef315be64f79b8184a">&#9670;&#160;</a></span>xwmb_access</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_access</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">t, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">v&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(*((volatile t *)&amp;(v)))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>: 强制从内存中访问指定类型的变量 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">t</td><td>类型，只能为基本类型 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>类型为t左值，读取的值放在这个左值中 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>类型t的位宽只能是8位、16位、32位、64位。 </li>
</ul>
</dd></dl>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00034">34</a> 行定义.</p>

</div>
</div>
<a id="ga3e7560a0aca4f67d110a230764a59669" name="ga3e7560a0aca4f67d110a230764a59669"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3e7560a0aca4f67d110a230764a59669">&#9670;&#160;</a></span>xwmb_compiler</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_compiler</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>编译器内存屏障 </p>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00062">62</a> 行定义.</p>

</div>
</div>
<a id="gaa7f7b461571ae8940cf2cb160f4f3c31" name="gaa7f7b461571ae8940cf2cb160f4f3c31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa7f7b461571ae8940cf2cb160f4f3c31">&#9670;&#160;</a></span>xwmb_ddb</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_ddb</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#ga3e7560a0aca4f67d110a230764a59669">xwmb_compiler</a>()</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>数据依赖屏障 @detail </p>
<ul>
<li>Flush all pending reads that subsequents reads depend on.</li>
<li><p class="startli">same as <code>mp_read_barrier_depends()</code> in Linux. (From Linux kernel): No data-dependent reads from memory-like regions are ever reordered over this barrier. All reads preceding this primitive are guaranteed to access memory (but not necessarily other CPUs' caches) before any reads following this primitive that depend on the data return by any of the preceding reads. This primitive is much lighter weight than <code>rmb()</code> on most CPUs, and is never heavier weight than is <code>rmb()</code> .</p>
<p class="startli">These ordering constraints are respected by both the local CPU and the compiler.</p>
<p class="startli">Ordering is not guaranteed by anything other than these primitives, not even by data dependencies. See the documentation for <code>memory_barrier()</code> for examples and URLs to more information.</p>
<p class="startli">For example, the following code would force ordering (the initial value of "a" is zero, "b" is one, and "p" is "&amp;a"):</p>
<div class="fragment"><div class="line">CPU 0                           CPU 1</div>
<div class="line"> </div>
<div class="line">b = 2;</div>
<div class="line">memory_barrier();</div>
<div class="line">p = &amp;b;                         q = p;</div>
<div class="line">                                read_barrier_depends();</div>
<div class="line">                                d = *q;</div>
</div><!-- fragment --><p class="startli">because the read of "*q" depends on the read of "p" and these two reads are separated by a read_barrier_depends(). However, the following code, with the same initial values for "a" and "b":</p>
<div class="fragment"><div class="line">CPU 0                           CPU 1</div>
<div class="line"> </div>
<div class="line">a = 2;</div>
<div class="line">memory_barrier();</div>
<div class="line">b = 3;                          y = b;</div>
<div class="line">                                read_barrier_depends();</div>
<div class="line">                                x = a;</div>
</div><!-- fragment --><p class="startli">does not enforce ordering, since there is no data dependency between the read of "a" and the read of "b". Therefore, on some CPUs, such as Alpha, "y" could be set to 3 and "x" to 0. Use rmb() in cases like this where there are no data dependencies.</p>
</li>
<li>上文描述简单理解就是两次读之间的依赖关系，比较常见的场景：<ul>
<li>通过 <b>指针</b> 访问 <b>变量</b> 时，若 <b>指针</b> 也是从内存中读取的， <b>指针</b> 的 <b>读</b> 和 <b>变量</b> 的 <b>读</b> 之间产生读依赖。 如果 <b>指针</b> 内存的 <b>写</b> 是在其他CPU完成的，就要考虑数据依赖屏障。</li>
<li>读数组中 <b>元素</b> 时，若数组 <b>指针</b> 是从内存中读取的， <b>指针</b> 的 <b>读</b> 和 <b>元素</b> 的 <b>读</b> 之间产生读依赖。 如果 <b>指针</b> 内存的 <b>写</b> 是在其他CPU完成的，就要考虑数据依赖屏障。</li>
</ul>
</li>
<li>C/C++中的内存顺序 —— 消费序( <code>memory_order_consume</code> )所表达的意思也即是读依赖屏障。<ul>
<li>X86/X86_64这种强内存模型的CPU，带有数据依赖(Data dependency)， 不需要任何读依赖屏障</li>
<li>ARM/PowerPC这种弱内存模型的CPU，带有数据依赖(Data dependency)， 不需要任何读依赖屏障</li>
<li>DEC Alpha这种弱内存模型的CPU，不带有数据依赖(Data dependency)， 需要使用读依赖屏障 </li>
</ul>
</li>
</ul>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00154">154</a> 行定义.</p>

</div>
</div>
<a id="ga40d70698501ca94c72a93ed83c64e5c5" name="ga40d70698501ca94c72a93ed83c64e5c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga40d70698501ca94c72a93ed83c64e5c5">&#9670;&#160;</a></span>xwmb_mp_acquire</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_mp_acquire</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#ga35dc698ebb574f02dff634e94a7da7e8">xwmb_mp_mb</a>()</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>多核系统 <b>获取</b> 屏障 </p>
<p>通常用于 <b>加载</b> 操作之后。 </p>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00170">170</a> 行定义.</p>

</div>
</div>
<a id="ga55e0b689d7b495c3dbfc497df0f690ba" name="ga55e0b689d7b495c3dbfc497df0f690ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga55e0b689d7b495c3dbfc497df0f690ba">&#9670;&#160;</a></span>xwmb_mp_consume</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_mp_consume</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#gaa7f7b461571ae8940cf2cb160f4f3c31">xwmb_ddb</a>()</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>多核系统 <b>消费</b> 屏障，数据依赖屏障 </p>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00161">161</a> 行定义.</p>

</div>
</div>
<a id="gaa328f6e6fdda8d00fb6d379f235379ca" name="gaa328f6e6fdda8d00fb6d379f235379ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa328f6e6fdda8d00fb6d379f235379ca">&#9670;&#160;</a></span>xwmb_mp_load_acquire</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_mp_load_acquire</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">t, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">v, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">p&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>值:</b><div class="fragment"><div class="line">        <span class="keywordflow">do</span> {                                    \</div>
<div class="line">                xwmb_read(t, (v), (p));         \</div>
<div class="line">                xwmb_mp_acquire();              \</div>
<div class="line">        } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
<p>: 读取地址中的指定类型的值，并保证此处的“读”操作一定发生在之后的“读写”操作之前 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">t</td><td>类型，只能为基本类型及其typedef后的类型 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>类型为t左值，读取的值放在这个左值中 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>类型为t *的指针，指向需要读取的地址 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>类型t的位宽只能是8位、16位、32位、64位。 </li>
</ul>
</dd></dl>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00191">191</a> 行定义.</p>

</div>
</div>
<a id="ga35dc698ebb574f02dff634e94a7da7e8" name="ga35dc698ebb574f02dff634e94a7da7e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga35dc698ebb574f02dff634e94a7da7e8">&#9670;&#160;</a></span>xwmb_mp_mb</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_mp_mb</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>多核系统内存屏障 </p>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00069">69</a> 行定义.</p>

</div>
</div>
<a id="gae1b2218d5a0e83aee4039f72025b3314" name="gae1b2218d5a0e83aee4039f72025b3314"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae1b2218d5a0e83aee4039f72025b3314">&#9670;&#160;</a></span>xwmb_mp_release</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_mp_release</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#ga35dc698ebb574f02dff634e94a7da7e8">xwmb_mp_mb</a>()</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>多核系统 <b>释放</b> 屏障 </p>
<p>通常用于 <b>存储</b> 操作之前。 </p>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00179">179</a> 行定义.</p>

</div>
</div>
<a id="ga57498c24c01ae5efa8466b23d29bda6a" name="ga57498c24c01ae5efa8466b23d29bda6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga57498c24c01ae5efa8466b23d29bda6a">&#9670;&#160;</a></span>xwmb_mp_rmb</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_mp_rmb</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>多核系统读内存屏障 </p>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00076">76</a> 行定义.</p>

</div>
</div>
<a id="gafd20fad9aba0ba8755dec125ace98bba" name="gafd20fad9aba0ba8755dec125ace98bba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafd20fad9aba0ba8755dec125ace98bba">&#9670;&#160;</a></span>xwmb_mp_store_release</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_mp_store_release</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">t, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">p, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">v&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>值:</b><div class="fragment"><div class="line">        <span class="keywordflow">do</span> {                                    \</div>
<div class="line">                xwmb_mp_release();              \</div>
<div class="line">                xwmb_write(t, (p), (v));        \</div>
<div class="line">        } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
<p>存储指定类型的值到地址中，并保证此处的“写”操作一定发生在之前的“读写”操作之后 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">t</td><td>类型，只能为基本类型及其typedef后的类型 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>类型为t *的指针，指向需要存储的地址 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>待存储的类型为t右值 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>类型t的位宽只能是8位、16位、32位、64位。 </li>
</ul>
</dd></dl>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00207">207</a> 行定义.</p>

</div>
</div>
<a id="ga5e1fb357ecde09f5c9d6477a03afb3d9" name="ga5e1fb357ecde09f5c9d6477a03afb3d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5e1fb357ecde09f5c9d6477a03afb3d9">&#9670;&#160;</a></span>xwmb_mp_wmb</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_mp_wmb</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>多核写内存屏障 </p>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00083">83</a> 行定义.</p>

</div>
</div>
<a id="gab65ff46eaf1a756beb3308f7c1cbcea1" name="gab65ff46eaf1a756beb3308f7c1cbcea1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab65ff46eaf1a756beb3308f7c1cbcea1">&#9670;&#160;</a></span>xwmb_read</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_read</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">t, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">v, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">p&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="group__xwos__lib__mb.html#gaa0f17799e1136eef315be64f79b8184a">xwmb_access</a>(t, v) = (*(volatile t * )(p))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>: 读取地址中的指定类型的值 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">t</td><td>类型，只能为基本类型及其typedef后的类型 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>类型为t左值，读取的值放在这个左值中 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>类型为t *的指针，指向需要读取的地址 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>类型t的位宽只能是8位、16位、32位、64位。 </li>
</ul>
</dd></dl>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00045">45</a> 行定义.</p>

</div>
</div>
<a id="ga22f44a0599d8761343a72dee387e23e2" name="ga22f44a0599d8761343a72dee387e23e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga22f44a0599d8761343a72dee387e23e2">&#9670;&#160;</a></span>xwmb_write</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define xwmb_write</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">t, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">p, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">v&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(*(volatile t * )(p)) = (v)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>存储指定类型的值到地址中 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">t</td><td>类型，只能为基本类型及其typedef后的类型 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>类型为t *的指针，指向需要存储的地址 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>待存储的类型为t右值 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注解</dt><dd><ul>
<li>类型t的位宽只能是8位、16位、32位、64位。 </li>
</ul>
</dd></dl>

<p class="definition">在文件 <a class="el" href="mb_8h_source.html">mb.h</a> 第 <a class="el" href="mb_8h_source.html#l00056">56</a> 行定义.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
